<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>深度学习完全指南：神经网络与实战应用</title>
    <url>/2026/01/20/deep-learning-guide/</url>
    <content><![CDATA[<h2 id="深度学习简介"><a href="#深度学习简介" class="headerlink" title="深度学习简介"></a>深度学习简介</h2><p>深度学习（Deep Learning）是机器学习的一个子集，使用多层神经网络来学习数据的复杂模式。它在图像识别、语音识别、自然语言处理等领域取得了突破性进展。</p>
<h3 id="为什么选择深度学习？"><a href="#为什么选择深度学习？" class="headerlink" title="为什么选择深度学习？"></a>为什么选择深度学习？</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 传统机器学习 vs 深度学习</span></span><br><span class="line">传统机器学习:</span><br><span class="line">    - 需要手动提取特征</span><br><span class="line">    - 适合结构化数据</span><br><span class="line">    - 解释性强</span><br><span class="line"></span><br><span class="line">深度学习:</span><br><span class="line">    - 自动学习特征表示</span><br><span class="line">    - 适合非结构化数据（图像、文本、音频）</span><br><span class="line">    - 需要大量数据和计算资源</span><br></pre></td></tr></table></figure>

<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="安装PyTorch"><a href="#安装PyTorch" class="headerlink" title="安装PyTorch"></a>安装PyTorch</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># CPU版本</span></span><br><span class="line">pip install torch torchvision torchaudio</span><br><span class="line"></span><br><span class="line"><span class="comment"># GPU版本（CUDA 11.8）</span></span><br><span class="line">pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">python -c <span class="string">&quot;import torch; print(torch.__version__)&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="安装TensorFlow（可选）"><a href="#安装TensorFlow（可选）" class="headerlink" title="安装TensorFlow（可选）"></a>安装TensorFlow（可选）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install tensorflow</span><br></pre></td></tr></table></figure>

<h2 id="神经网络基础"><a href="#神经网络基础" class="headerlink" title="神经网络基础"></a>神经网络基础</h2><h3 id="1-感知机-神经网络的基石"><a href="#1-感知机-神经网络的基石" class="headerlink" title="1. 感知机 - 神经网络的基石"></a>1. 感知机 - 神经网络的基石</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单的感知机</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Perceptron</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size</span>):</span><br><span class="line">        <span class="built_in">super</span>(Perceptron, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.linear = nn.Linear(input_size, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.sigmoid(<span class="variable language_">self</span>.linear(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">perceptron = Perceptron(input_size=<span class="number">2</span>)</span><br><span class="line">x = torch.tensor([[<span class="number">1.0</span>, <span class="number">2.0</span>]])</span><br><span class="line">output = perceptron(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;输出: <span class="subst">&#123;output.item():<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-多层感知机（MLP）"><a href="#2-多层感知机（MLP）" class="headerlink" title="2. 多层感知机（MLP）"></a>2. 多层感知机（MLP）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, output_size</span>):</span><br><span class="line">        <span class="built_in">super</span>(MLP, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.layer1 = nn.Linear(input_size, hidden_size)</span><br><span class="line">        <span class="variable language_">self</span>.relu = nn.ReLU()</span><br><span class="line">        <span class="variable language_">self</span>.layer2 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        <span class="variable language_">self</span>.layer3 = nn.Linear(hidden_size, output_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = <span class="variable language_">self</span>.relu(<span class="variable language_">self</span>.layer1(x))</span><br><span class="line">        x = <span class="variable language_">self</span>.relu(<span class="variable language_">self</span>.layer2(x))</span><br><span class="line">        x = <span class="variable language_">self</span>.layer3(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建模型</span></span><br><span class="line">model = MLP(input_size=<span class="number">784</span>, hidden_size=<span class="number">256</span>, output_size=<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(model)</span><br></pre></td></tr></table></figure>

<h2 id="激活函数详解"><a href="#激活函数详解" class="headerlink" title="激活函数详解"></a>激活函数详解</h2><p>激活函数引入非线性，使神经网络能够学习复杂模式。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.linspace(-<span class="number">5</span>, <span class="number">5</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用激活函数</span></span><br><span class="line">activations = &#123;</span><br><span class="line">    <span class="string">&#x27;ReLU&#x27;</span>: F.relu(x),</span><br><span class="line">    <span class="string">&#x27;Sigmoid&#x27;</span>: torch.sigmoid(x),</span><br><span class="line">    <span class="string">&#x27;Tanh&#x27;</span>: torch.tanh(x),</span><br><span class="line">    <span class="string">&#x27;LeakyReLU&#x27;</span>: F.leaky_relu(x, negative_slope=<span class="number">0.01</span>),</span><br><span class="line">    <span class="string">&#x27;GELU&#x27;</span>: F.gelu(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活函数选择指南</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">- ReLU: 默认选择，计算快速</span></span><br><span class="line"><span class="string">- LeakyReLU: 解决ReLU神经元死亡问题</span></span><br><span class="line"><span class="string">- Sigmoid: 输出概率（0-1之间）</span></span><br><span class="line"><span class="string">- Tanh: 输出范围-1到1</span></span><br><span class="line"><span class="string">- GELU: Transformer中常用，性能更好</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="卷积神经网络（CNN）"><a href="#卷积神经网络（CNN）" class="headerlink" title="卷积神经网络（CNN）"></a>卷积神经网络（CNN）</h2><p>CNN是处理图像的利器，通过卷积层自动提取图像特征。</p>
<h3 id="CNN架构示例"><a href="#CNN架构示例" class="headerlink" title="CNN架构示例"></a>CNN架构示例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CNN</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_classes=<span class="number">10</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CNN, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 卷积层</span></span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="number">1</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="number">64</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 池化层</span></span><br><span class="line">        <span class="variable language_">self</span>.pool = nn.MaxPool2d(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全连接层</span></span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(<span class="number">128</span> * <span class="number">3</span> * <span class="number">3</span>, <span class="number">512</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc2 = nn.Linear(<span class="number">512</span>, num_classes)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Dropout防止过拟合</span></span><br><span class="line">        <span class="variable language_">self</span>.dropout = nn.Dropout(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># 卷积块1</span></span><br><span class="line">        x = <span class="variable language_">self</span>.pool(F.relu(<span class="variable language_">self</span>.conv1(x)))  <span class="comment"># 28x28 -&gt; 14x14</span></span><br><span class="line">        x = <span class="variable language_">self</span>.pool(F.relu(<span class="variable language_">self</span>.conv2(x)))  <span class="comment"># 14x14 -&gt; 7x7</span></span><br><span class="line">        x = <span class="variable language_">self</span>.pool(F.relu(<span class="variable language_">self</span>.conv3(x)))  <span class="comment"># 7x7 -&gt; 3x3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 展平</span></span><br><span class="line">        x = x.view(-<span class="number">1</span>, <span class="number">128</span> * <span class="number">3</span> * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全连接层</span></span><br><span class="line">        x = <span class="variable language_">self</span>.dropout(F.relu(<span class="variable language_">self</span>.fc1(x)))</span><br><span class="line">        x = <span class="variable language_">self</span>.fc2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建CNN模型</span></span><br><span class="line">cnn = CNN(num_classes=<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;CNN参数量: <span class="subst">&#123;<span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> cnn.parameters()):,&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="经典CNN架构"><a href="#经典CNN架构" class="headerlink" title="经典CNN架构"></a>经典CNN架构</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ResNet残差连接</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResidualBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_channels, out_channels, stride=<span class="number">1</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ResidualBlock, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(in_channels, out_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.bn1 = nn.BatchNorm2d(out_channels)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(out_channels, out_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.bn2 = nn.BatchNorm2d(out_channels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 残差连接</span></span><br><span class="line">        <span class="variable language_">self</span>.shortcut = nn.Sequential()</span><br><span class="line">        <span class="keyword">if</span> stride != <span class="number">1</span> <span class="keyword">or</span> in_channels != out_channels:</span><br><span class="line">            <span class="variable language_">self</span>.shortcut = nn.Sequential(</span><br><span class="line">                nn.Conv2d(in_channels, out_channels,</span><br><span class="line">                         kernel_size=<span class="number">1</span>, stride=stride),</span><br><span class="line">                nn.BatchNorm2d(out_channels)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = F.relu(<span class="variable language_">self</span>.bn1(<span class="variable language_">self</span>.conv1(x)))</span><br><span class="line">        out = <span class="variable language_">self</span>.bn2(<span class="variable language_">self</span>.conv2(out))</span><br><span class="line">        out += <span class="variable language_">self</span>.shortcut(x)  <span class="comment"># 残差连接</span></span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<h2 id="循环神经网络（RNN）与LSTM"><a href="#循环神经网络（RNN）与LSTM" class="headerlink" title="循环神经网络（RNN）与LSTM"></a>循环神经网络（RNN）与LSTM</h2><p>RNN适合处理序列数据，如文本、时间序列。</p>
<h3 id="LSTM模型"><a href="#LSTM模型" class="headerlink" title="LSTM模型"></a>LSTM模型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LSTMModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, embedding_dim, hidden_dim, output_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(LSTMModel, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 词嵌入层</span></span><br><span class="line">        <span class="variable language_">self</span>.embedding = nn.Embedding(vocab_size, embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># LSTM层</span></span><br><span class="line">        <span class="variable language_">self</span>.lstm = nn.LSTM(</span><br><span class="line">            embedding_dim,</span><br><span class="line">            hidden_dim,</span><br><span class="line">            num_layers=<span class="number">2</span>,</span><br><span class="line">            bidirectional=<span class="literal">True</span>,</span><br><span class="line">            dropout=<span class="number">0.5</span>,</span><br><span class="line">            batch_first=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全连接层</span></span><br><span class="line">        <span class="variable language_">self</span>.fc = nn.Linear(hidden_dim * <span class="number">2</span>, output_dim)</span><br><span class="line">        <span class="variable language_">self</span>.dropout = nn.Dropout(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="comment"># text: [batch_size, seq_len]</span></span><br><span class="line">        embedded = <span class="variable language_">self</span>.dropout(<span class="variable language_">self</span>.embedding(text))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># lstm: [batch_size, seq_len, hidden_dim * 2]</span></span><br><span class="line">        output, (hidden, cell) = <span class="variable language_">self</span>.lstm(embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 拼接双向LSTM的最后隐藏状态</span></span><br><span class="line">        hidden = torch.cat((hidden[-<span class="number">2</span>,:,:], hidden[-<span class="number">1</span>,:,:]), dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.fc(<span class="variable language_">self</span>.dropout(hidden))</span><br></pre></td></tr></table></figure>

<h2 id="Transformer架构"><a href="#Transformer架构" class="headerlink" title="Transformer架构"></a>Transformer架构</h2><p>Transformer是现代NLP的核心架构，用于GPT、BERT等模型。</p>
<h3 id="自注意力机制"><a href="#自注意力机制" class="headerlink" title="自注意力机制"></a>自注意力机制</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MultiHeadAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, d_model, num_heads</span>):</span><br><span class="line">        <span class="built_in">super</span>(MultiHeadAttention, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="keyword">assert</span> d_model % num_heads == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.d_model = d_model</span><br><span class="line">        <span class="variable language_">self</span>.num_heads = num_heads</span><br><span class="line">        <span class="variable language_">self</span>.d_k = d_model // num_heads</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Q, K, V线性变换</span></span><br><span class="line">        <span class="variable language_">self</span>.W_q = nn.Linear(d_model, d_model)</span><br><span class="line">        <span class="variable language_">self</span>.W_k = nn.Linear(d_model, d_model)</span><br><span class="line">        <span class="variable language_">self</span>.W_v = nn.Linear(d_model, d_model)</span><br><span class="line">        <span class="variable language_">self</span>.W_o = nn.Linear(d_model, d_model)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attention</span>(<span class="params">self, Q, K, V, mask=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># 计算注意力分数</span></span><br><span class="line">        scores = torch.matmul(Q, K.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) / math.sqrt(<span class="variable language_">self</span>.d_k)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            scores = scores.masked_fill(mask == <span class="number">0</span>, -<span class="number">1e9</span>)</span><br><span class="line"></span><br><span class="line">        attention_weights = F.softmax(scores, dim=-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> torch.matmul(attention_weights, V)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, query, key, value, mask=<span class="literal">None</span></span>):</span><br><span class="line">        batch_size = query.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 线性变换并分割成多个头</span></span><br><span class="line">        Q = <span class="variable language_">self</span>.W_q(query).view(batch_size, -<span class="number">1</span>, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        K = <span class="variable language_">self</span>.W_k(key).view(batch_size, -<span class="number">1</span>, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        V = <span class="variable language_">self</span>.W_v(value).view(batch_size, -<span class="number">1</span>, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算注意力</span></span><br><span class="line">        x = <span class="variable language_">self</span>.attention(Q, K, V, mask)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 拼接多个头</span></span><br><span class="line">        x = x.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(batch_size, -<span class="number">1</span>, <span class="variable language_">self</span>.d_model)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.W_o(x)</span><br></pre></td></tr></table></figure>

<h2 id="完整训练流程示例"><a href="#完整训练流程示例" class="headerlink" title="完整训练流程示例"></a>完整训练流程示例</h2><h3 id="MNIST手写数字识别"><a href="#MNIST手写数字识别" class="headerlink" title="MNIST手写数字识别"></a>MNIST手写数字识别</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> datasets, transforms</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据准备</span></span><br><span class="line">transform = transforms.Compose([</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    transforms.Normalize((<span class="number">0.1307</span>,), (<span class="number">0.3081</span>,))</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">train_dataset = datasets.MNIST(<span class="string">&#x27;./data&#x27;</span>, train=<span class="literal">True</span>,</span><br><span class="line">                                download=<span class="literal">True</span>, transform=transform)</span><br><span class="line">test_dataset = datasets.MNIST(<span class="string">&#x27;./data&#x27;</span>, train=<span class="literal">False</span>,</span><br><span class="line">                               transform=transform)</span><br><span class="line"></span><br><span class="line">train_loader = DataLoader(train_dataset, batch_size=<span class="number">64</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line">test_loader = DataLoader(test_dataset, batch_size=<span class="number">1000</span>, shuffle=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 定义模型</span></span><br><span class="line">model = CNN(num_classes=<span class="number">10</span>)</span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 定义损失函数和优化器</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line">scheduler = optim.lr_scheduler.ReduceLROnPlateau(</span><br><span class="line">    optimizer, mode=<span class="string">&#x27;min&#x27;</span>, factor=<span class="number">0.5</span>, patience=<span class="number">3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 训练函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">epoch</span>):</span><br><span class="line">    model.train()</span><br><span class="line">    train_loss = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> batch_idx, (data, target) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        data, target = data.to(device), target.to(device)</span><br><span class="line"></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        output = model(data)</span><br><span class="line">        loss = criterion(output, target)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        train_loss += loss.item()</span><br><span class="line">        pred = output.argmax(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        correct += pred.eq(target.view_as(pred)).<span class="built_in">sum</span>().item()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> batch_idx % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Train Epoch: <span class="subst">&#123;epoch&#125;</span> [<span class="subst">&#123;batch_idx * <span class="built_in">len</span>(data)&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(train_loader.dataset)&#125;</span> &#x27;</span></span><br><span class="line">                  <span class="string">f&#x27;(<span class="subst">&#123;<span class="number">100.</span> * batch_idx / <span class="built_in">len</span>(train_loader):<span class="number">.0</span>f&#125;</span>%)]\tLoss: <span class="subst">&#123;loss.item():<span class="number">.6</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    train_loss /= <span class="built_in">len</span>(train_loader)</span><br><span class="line">    accuracy = <span class="number">100.</span> * correct / <span class="built_in">len</span>(train_loader.dataset)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;\nTrain set: Average loss: <span class="subst">&#123;train_loss:<span class="number">.4</span>f&#125;</span>, Accuracy: <span class="subst">&#123;correct&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(train_loader.dataset)&#125;</span> (<span class="subst">&#123;accuracy:<span class="number">.2</span>f&#125;</span>%)\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> train_loss</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 测试函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    test_loss = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> data, target <span class="keyword">in</span> test_loader:</span><br><span class="line">            data, target = data.to(device), target.to(device)</span><br><span class="line">            output = model(data)</span><br><span class="line">            test_loss += criterion(output, target).item()</span><br><span class="line">            pred = output.argmax(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">            correct += pred.eq(target.view_as(pred)).<span class="built_in">sum</span>().item()</span><br><span class="line"></span><br><span class="line">    test_loss /= <span class="built_in">len</span>(test_loader)</span><br><span class="line">    accuracy = <span class="number">100.</span> * correct / <span class="built_in">len</span>(test_loader.dataset)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Test set: Average loss: <span class="subst">&#123;test_loss:<span class="number">.4</span>f&#125;</span>, Accuracy: <span class="subst">&#123;correct&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(test_loader.dataset)&#125;</span> (<span class="subst">&#123;accuracy:<span class="number">.2</span>f&#125;</span>%)\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> test_loss</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 训练循环</span></span><br><span class="line">best_loss = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    train_loss = train(epoch)</span><br><span class="line">    test_loss = test()</span><br><span class="line"></span><br><span class="line">    scheduler.step(test_loss)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存最佳模型</span></span><br><span class="line">    <span class="keyword">if</span> test_loss &lt; best_loss:</span><br><span class="line">        best_loss = test_loss</span><br><span class="line">        torch.save(model.state_dict(), <span class="string">&#x27;best_model.pth&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Saved best model with loss: <span class="subst">&#123;best_loss:<span class="number">.4</span>f&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Training completed! Best test loss: <span class="subst">&#123;best_loss:<span class="number">.4</span>f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="常用技巧"><a href="#常用技巧" class="headerlink" title="常用技巧"></a>常用技巧</h2><h3 id="1-数据增强"><a href="#1-数据增强" class="headerlink" title="1. 数据增强"></a>1. 数据增强</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"></span><br><span class="line">train_transform = transforms.Compose([</span><br><span class="line">    transforms.RandomHorizontalFlip(),</span><br><span class="line">    transforms.RandomRotation(<span class="number">10</span>),</span><br><span class="line">    transforms.ColorJitter(brightness=<span class="number">0.2</span>, contrast=<span class="number">0.2</span>),</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                        std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="2-学习率调度"><a href="#2-学习率调度" class="headerlink" title="2. 学习率调度"></a>2. 学习率调度</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 余弦退火</span></span><br><span class="line">scheduler = optim.lr_scheduler.CosineAnnealingLR(</span><br><span class="line">    optimizer, T_max=<span class="number">50</span>, eta_min=<span class="number">1e-6</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预训练模型微调</span></span><br><span class="line">scheduler = optim.lr_scheduler.CyclicLR(</span><br><span class="line">    optimizer, base_lr=<span class="number">1e-5</span>, max_lr=<span class="number">1e-3</span>,</span><br><span class="line">    cycle_momentum=<span class="literal">False</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3-早停法"><a href="#3-早停法" class="headerlink" title="3. 早停法"></a>3. 早停法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EarlyStopping</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, patience=<span class="number">7</span>, min_delta=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.patience = patience</span><br><span class="line">        <span class="variable language_">self</span>.min_delta = min_delta</span><br><span class="line">        <span class="variable language_">self</span>.counter = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.best_loss = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.early_stop = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, val_loss</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.best_loss <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="variable language_">self</span>.best_loss = val_loss</span><br><span class="line">        <span class="keyword">elif</span> val_loss &gt; <span class="variable language_">self</span>.best_loss - <span class="variable language_">self</span>.min_delta:</span><br><span class="line">            <span class="variable language_">self</span>.counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.counter &gt;= <span class="variable language_">self</span>.patience:</span><br><span class="line">                <span class="variable language_">self</span>.early_stop = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.best_loss = val_loss</span><br><span class="line">            <span class="variable language_">self</span>.counter = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="迁移学习实战"><a href="#迁移学习实战" class="headerlink" title="迁移学习实战"></a>迁移学习实战</h2><p>使用预训练模型加速训练：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载预训练ResNet</span></span><br><span class="line">resnet = models.resnet50(pretrained=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 冻结所有层</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> resnet.parameters():</span><br><span class="line">    param.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换最后的分类层</span></span><br><span class="line">num_features = resnet.fc.in_features</span><br><span class="line">resnet.fc = nn.Linear(num_features, <span class="number">10</span>)  <span class="comment"># 10个类别</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只训练最后一层</span></span><br><span class="line">optimizer = optim.SGD(resnet.fc.parameters(), lr=<span class="number">0.01</span>, momentum=<span class="number">0.9</span>)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>深度学习是一个快速发展的领域，掌握基础知识后，可以进一步探索：</p>
<ul>
<li><strong>计算机视觉</strong>: 目标检测、图像分割、风格迁移</li>
<li><strong>自然语言处理</strong>: GPT、BERT、机器翻译</li>
<li><strong>生成模型</strong>: GAN、VAE、Diffusion Models</li>
<li><strong>强化学习</strong>: 游戏AI、机器人控制</li>
</ul>
<p><strong>学习资源：</strong></p>
<ul>
<li>fast.ai - 实用深度学习课程</li>
<li>Stanford CS231n - 计算机视觉</li>
<li>Stanford CS224n - 自然语言处理</li>
</ul>
<p>持续学习和实践是掌握深度学习的关键！</p>
<hr>
<p><em>下一篇将介绍AI的实际应用场景和项目案例，敬请关注！</em></p>
]]></content>
      <categories>
        <category>全栈</category>
        <category>AI</category>
      </categories>
      <tags>
        <tag>深度学习</tag>
        <tag>神经网络</tag>
        <tag>PyTorch</tag>
        <tag>计算机视觉</tag>
      </tags>
  </entry>
  <entry>
    <title>人工智能入门：从零开始了解AI</title>
    <url>/2026/01/20/ai-introduction/</url>
    <content><![CDATA[<h2 id="什么是人工智能？"><a href="#什么是人工智能？" class="headerlink" title="什么是人工智能？"></a>什么是人工智能？</h2><p>人工智能（Artificial Intelligence，简称AI）是计算机科学的一个分支，致力于创建能够执行通常需要人类智能的任务的系统。这些任务包括：</p>
<ul>
<li><strong>学习</strong> - 从数据中获取信息和规则</li>
<li><strong>推理</strong> - 使用规则得出近似或确定的结论</li>
<li><strong>自我修正</strong> - 在过程中不断优化改进</li>
<li><strong>感知</strong> - 包括视觉、语音识别等</li>
</ul>
<h2 id="AI的发展历程"><a href="#AI的发展历程" class="headerlink" title="AI的发展历程"></a>AI的发展历程</h2><h3 id="第一代：符号主义AI（1956-1980s）"><a href="#第一代：符号主义AI（1956-1980s）" class="headerlink" title="第一代：符号主义AI（1956-1980s）"></a>第一代：符号主义AI（1956-1980s）</h3><p>基于逻辑和规则，代表系统包括专家系统。这类AI通过人工编写的规则来解决问题。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 简单的规则示例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diagnose_symptoms</span>(<span class="params">fever, cough, fatigue</span>):</span><br><span class="line">    <span class="keyword">if</span> fever <span class="keyword">and</span> cough:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;可能是感冒&quot;</span></span><br><span class="line">    <span class="keyword">if</span> fatigue <span class="keyword">and</span> <span class="keyword">not</span> fever:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;可能是疲劳&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;需要进一步检查&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二代：连接主义AI（1980s-2010s）"><a href="#第二代：连接主义AI（1980s-2010s）" class="headerlink" title="第二代：连接主义AI（1980s-2010s）"></a>第二代：连接主义AI（1980s-2010s）</h3><p>基于神经网络，模拟人脑神经元连接。深度学习就属于这一类。</p>
<h3 id="第三代：通用人工智能（2010s-至今）"><a href="#第三代：通用人工智能（2010s-至今）" class="headerlink" title="第三代：通用人工智能（2010s-至今）"></a>第三代：通用人工智能（2010s-至今）</h3><p>更接近人类智能，具备多领域学习和推理能力。</p>
<h2 id="AI的三大核心技术"><a href="#AI的三大核心技术" class="headerlink" title="AI的三大核心技术"></a>AI的三大核心技术</h2><h3 id="1-机器学习（Machine-Learning）"><a href="#1-机器学习（Machine-Learning）" class="headerlink" title="1. 机器学习（Machine Learning）"></a>1. 机器学习（Machine Learning）</h3><p>机器学习是AI的核心，让计算机从数据中学习规律，而不是显式编程。</p>
<p><strong>常见算法类型：</strong></p>
<ul>
<li>监督学习（Supervised Learning）</li>
<li>无监督学习（Unsupervised Learning）</li>
<li>强化学习（Reinforcement Learning）</li>
</ul>
<h3 id="2-深度学习（Deep-Learning）"><a href="#2-深度学习（Deep-Learning）" class="headerlink" title="2. 深度学习（Deep Learning）"></a>2. 深度学习（Deep Learning）</h3><p>基于多层神经网络的机器学习方法，在图像识别、自然语言处理等领域表现卓越。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 简单的神经网络示例（使用Keras）</span></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">model = keras.Sequential([</span><br><span class="line">    layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">784</span>,)),</span><br><span class="line">    layers.Dropout(<span class="number">0.2</span>),</span><br><span class="line">    layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="3-自然语言处理（NLP）"><a href="#3-自然语言处理（NLP）" class="headerlink" title="3. 自然语言处理（NLP）"></a>3. 自然语言处理（NLP）</h3><p>让计算机理解、生成和处理人类语言的技术。ChatGPT、BERT等都是NLP的杰出代表。</p>
<h2 id="AI的应用领域"><a href="#AI的应用领域" class="headerlink" title="AI的应用领域"></a>AI的应用领域</h2><table>
<thead>
<tr>
<th>领域</th>
<th>应用案例</th>
</tr>
</thead>
<tbody><tr>
<td>医疗健康</td>
<td>疾病诊断、药物研发</td>
</tr>
<tr>
<td>金融</td>
<td>风险评估、量化交易</td>
</tr>
<tr>
<td>交通</td>
<td>自动驾驶、交通优化</td>
</tr>
<tr>
<td>教育</td>
<td>个性化学习、智能辅导</td>
</tr>
<tr>
<td>娱乐</td>
<td>内容推荐、游戏AI</td>
</tr>
</tbody></table>
<h2 id="如何开始学习AI？"><a href="#如何开始学习AI？" class="headerlink" title="如何开始学习AI？"></a>如何开始学习AI？</h2><h3 id="1-数学基础"><a href="#1-数学基础" class="headerlink" title="1. 数学基础"></a>1. 数学基础</h3><ul>
<li>线性代数</li>
<li>概率论与数理统计</li>
<li>微积分</li>
</ul>
<h3 id="2-编程技能"><a href="#2-编程技能" class="headerlink" title="2. 编程技能"></a>2. 编程技能</h3><ul>
<li>Python（AI领域最流行的语言）</li>
<li>R语言</li>
<li>SQL（数据处理）</li>
</ul>
<h3 id="3-框架和工具"><a href="#3-框架和工具" class="headerlink" title="3. 框架和工具"></a>3. 框架和工具</h3><ul>
<li>TensorFlow &#x2F; PyTorch（深度学习框架）</li>
<li>Scikit-learn（机器学习库）</li>
<li>Jupyter Notebook（开发环境）</li>
</ul>
<h3 id="推荐学习资源"><a href="#推荐学习资源" class="headerlink" title="推荐学习资源"></a>推荐学习资源</h3><p><strong>在线课程：</strong></p>
<ul>
<li>Andrew Ng的Machine Learning课程（Coursera）</li>
<li>Fast.ai的深度学习课程</li>
<li>吴恩达深度学习专项课程</li>
</ul>
<p><strong>实践平台：</strong></p>
<ul>
<li>Kaggle（数据竞赛平台）</li>
<li>GitHub（开源项目）</li>
<li>Google Colab（免费GPU）</li>
</ul>
<h2 id="AI的未来展望"><a href="#AI的未来展望" class="headerlink" title="AI的未来展望"></a>AI的未来展望</h2><p>随着技术不断进步，AI正在向以下方向发展：</p>
<ol>
<li><strong>更智能的对话系统</strong> - 更自然的人机交互</li>
<li><strong>多模态AI</strong> - 同时处理文本、图像、音频、视频</li>
<li><strong>边缘AI</strong> - 在设备端运行，保护隐私</li>
<li><strong>可解释AI</strong> - 让AI决策过程更透明</li>
<li><strong>AI伦理</strong> - 确保AI的安全、公平和负责任</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>人工智能正在改变我们的世界，从日常应用到科学研究，AI的影响无处不在。作为技术人员，了解和掌握AI知识将成为未来竞争力的重要组成部分。</p>
<p>开始学习AI的最好方式是动手实践：选择一个小项目，使用开源数据集，训练你的第一个模型！</p>
<hr>
<p><em>欢迎在评论区分享你的AI学习心得！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>AI</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>人工智能</tag>
        <tag>入门</tag>
      </tags>
  </entry>
  <entry>
    <title>前端工程化实战：Webpack与Vite配置完全指南</title>
    <url>/2026/01/21/frontend-engineering-webpack-vite/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前端工程化是现代Web开发的基石。Webpack和Vite是目前最流行的构建工具，理解它们的工作原理和配置技巧，对提升开发效率和项目性能至关重要。</p>
<p>本文将深入讲解Webpack和Vite的配置与优化。</p>
<h2 id="一、Webpack-基础配置"><a href="#一、Webpack-基础配置" class="headerlink" title="一、Webpack 基础配置"></a>一、Webpack 基础配置</h2><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Webpack 工作流程:</span><br><span class="line">┌─────────────┐</span><br><span class="line">│   Entry     │ 入口文件</span><br><span class="line">└──────┬──────┘</span><br><span class="line">       │</span><br><span class="line">       ▼</span><br><span class="line">┌─────────────┐</span><br><span class="line">│   Loader    │ 转换非 JS 文件</span><br><span class="line">└──────┬──────┘</span><br><span class="line">       │</span><br><span class="line">       ▼</span><br><span class="line">┌─────────────┐</span><br><span class="line">│   Plugin    │ 扩展功能</span><br><span class="line">└──────┬──────┘</span><br><span class="line">       │</span><br><span class="line">       ▼</span><br><span class="line">┌─────────────┐</span><br><span class="line">│   Output    │ 输出文件</span><br><span class="line">└─────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].[contenthash:8].chunk.js&#x27;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;production&#x27;</span> : <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模块</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// JS/JSX</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(js|jsx|ts|tsx)$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">cacheDirectory</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">cacheCompression</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// CSS</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// SCSS/SASS</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(scss|sass)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;sass-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 图片</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10KB</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;images/[name].[hash:8][ext]&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 字体</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(woff2?|eot|ttf|otf)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;fonts/[name].[hash:8][ext]&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./public/index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">minify</span>: &#123;</span><br><span class="line">        <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解析</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>],</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;@components&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/components&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;@utils&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/utils&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开发服务器</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">static</span>: &#123;</span><br><span class="line">      <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Babel-配置"><a href="#Babel-配置" class="headerlink" title="Babel 配置"></a>Babel 配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// babel.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">      <span class="attr">corejs</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">targets</span>: &#123;</span><br><span class="line">        <span class="attr">browsers</span>: [<span class="string">&#x27;&gt; 1%&#x27;</span>, <span class="string">&#x27;last 2 versions&#x27;</span>, <span class="string">&#x27;not ie &lt;= 8&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-react&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">runtime</span>: <span class="string">&#x27;automatic&#x27;</span> <span class="comment">// React 17+ 不需要导入 React</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;@babel/preset-typescript&#x27;</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@babel/plugin-proposal-class-properties&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@babel/plugin-proposal-optional-chaining&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@babel/plugin-proposal-nullish-coalescing-operator&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .browserslistrc</span></span><br><span class="line">&gt; <span class="number">1</span>%</span><br><span class="line">last <span class="number">2</span> versions</span><br><span class="line">not dead</span><br><span class="line">not ie <span class="number">11</span></span><br></pre></td></tr></table></figure>

<h3 id="PostCSS-配置"><a href="#PostCSS-配置" class="headerlink" title="PostCSS 配置"></a>PostCSS 配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="string">&#x27;autoprefixer&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cssnano&#x27;</span>(&#123;</span><br><span class="line">      <span class="attr">preset</span>: <span class="string">&#x27;default&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;&gt; 1%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;last 2 versions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;not dead&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、Webpack-高级配置"><a href="#二、Webpack-高级配置" class="headerlink" title="二、Webpack 高级配置"></a>二、Webpack 高级配置</h2><h3 id="多入口配置"><a href="#多入口配置" class="headerlink" title="多入口配置"></a>多入口配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">    <span class="attr">vendor</span>: [<span class="string">&#x27;./src/react.js&#x27;</span>, <span class="string">&#x27;./src/react-dom.js&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].[contenthash:8].js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">vendors</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">10</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;vendors&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">default</span>: &#123;</span><br><span class="line">          <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">          <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;runtime&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(baseConfig, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;cheap-module-source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">devMiddleware</span>: &#123;</span><br><span class="line">      <span class="attr">stats</span>: <span class="string">&#x27;errors-warnings&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(baseConfig, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">drop_debugger</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (env.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;./webpack.prod.js&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;./webpack.dev.js&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --env production&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack serve --env development&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="性能优化配置"><a href="#性能优化配置" class="headerlink" title="性能优化配置"></a>性能优化配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">drop_debugger</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">output</span>: &#123;</span><br><span class="line">            <span class="attr">comments</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">extractComments</span>: <span class="literal">false</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>()</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">20000</span>,</span><br><span class="line">      <span class="attr">maxSize</span>: <span class="number">244000</span>,</span><br><span class="line">      <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">maxAsyncRequests</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">automaticNameDelimiter</span>: <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">react</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/](react|react-dom)[\\/]/</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;react&#x27;</span>,</span><br><span class="line">          <span class="attr">priority</span>: <span class="number">20</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">vue</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/](vue|@vue|vuex|vue-router)[\\/]/</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;vue&#x27;</span>,</span><br><span class="line">          <span class="attr">priority</span>: <span class="number">20</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">libs</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;libs&#x27;</span>,</span><br><span class="line">          <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">          <span class="attr">minChunks</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">moduleIds</span>: <span class="string">&#x27;deterministic&#x27;</span>,</span><br><span class="line">    <span class="attr">runtimeChunk</span>: <span class="string">&#x27;single&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// Gzip 压缩</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[path][base].gz&#x27;</span>,</span><br><span class="line">      <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|html|svg)$/</span>,</span><br><span class="line">      <span class="attr">threshold</span>: <span class="number">10240</span>,</span><br><span class="line">      <span class="attr">minRatio</span>: <span class="number">0.8</span></span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Brotli 压缩</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[path][base].br&#x27;</span>,</span><br><span class="line">      <span class="attr">algorithm</span>: <span class="string">&#x27;brotliCompress&#x27;</span>,</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|html|svg)$/</span>,</span><br><span class="line">      <span class="attr">compressionOptions</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: <span class="number">11</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 性能提示</span></span><br><span class="line">  <span class="attr">performance</span>: &#123;</span><br><span class="line">    <span class="attr">hints</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">    <span class="attr">maxEntrypointSize</span>: <span class="number">512000</span>,</span><br><span class="line">    <span class="attr">maxAssetSize</span>: <span class="number">512000</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">cache</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;filesystem&#x27;</span>,</span><br><span class="line">    <span class="attr">buildDependencies</span>: &#123;</span><br><span class="line">      <span class="attr">config</span>: [__filename]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].[contenthash:8].chunk.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./public/index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="三、Vite-完全指南"><a href="#三、Vite-完全指南" class="headerlink" title="三、Vite 完全指南"></a>三、Vite 完全指南</h2><h3 id="Vite-vs-Webpack"><a href="#Vite-vs-Webpack" class="headerlink" title="Vite vs Webpack"></a>Vite vs Webpack</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Vite 的优势:</span></span><br><span class="line"><span class="comment">✅ 开发服务器启动快（使用 esbuild）</span></span><br><span class="line"><span class="comment">✅ 热更新极快（原生 ESM）</span></span><br><span class="line"><span class="comment">✅ 开箱即用的 TypeScript 支持</span></span><br><span class="line"><span class="comment">✅ 更简洁的配置</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Webpack 的优势:</span></span><br><span class="line"><span class="comment">✅ 更成熟的生态系统</span></span><br><span class="line"><span class="comment">✅ 更强的定制能力</span></span><br><span class="line"><span class="comment">✅ 更好的生产环境优化</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="Vite-基础配置"><a href="#Vite-基础配置" class="headerlink" title="Vite 基础配置"></a>Vite 基础配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">react</span>()],</span><br><span class="line"></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;@components&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/components&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;@utils&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/utils&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">    <span class="attr">assetsDir</span>: <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">    <span class="attr">sourcemap</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">minify</span>: <span class="string">&#x27;terser&#x27;</span>,</span><br><span class="line">    <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">      <span class="attr">compress</span>: &#123;</span><br><span class="line">        <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">drop_debugger</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">manualChunks</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;react-vendor&#x27;</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>],</span><br><span class="line">          <span class="string">&#x27;vue-vendor&#x27;</span>: [<span class="string">&#x27;vue&#x27;</span>, <span class="string">&#x27;vue-router&#x27;</span>, <span class="string">&#x27;pinia&#x27;</span>],</span><br><span class="line">          <span class="string">&#x27;ui-library&#x27;</span>: [<span class="string">&#x27;antd&#x27;</span>, <span class="string">&#x27;element-plus&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">chunkFileNames</span>: <span class="string">&#x27;js/[name]-[hash].js&#x27;</span>,</span><br><span class="line">        <span class="attr">entryFileNames</span>: <span class="string">&#x27;js/[name]-[hash].js&#x27;</span>,</span><br><span class="line">        <span class="attr">assetFileNames</span>: <span class="string">&#x27;[ext]/[name]-[hash].[ext]&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">chunkSizeWarningLimit</span>: <span class="number">1000</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">      <span class="attr">localsConvention</span>: <span class="string">&#x27;camelCase&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">      <span class="attr">scss</span>: &#123;</span><br><span class="line">        <span class="attr">additionalData</span>: <span class="string">`@import &quot;@/styles/variables.scss&quot;;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">optimizeDeps</span>: &#123;</span><br><span class="line">    <span class="attr">include</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>],</span><br><span class="line">    <span class="attr">exclude</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Vite-环境变量"><a href="#Vite-环境变量" class="headerlink" title="Vite 环境变量"></a>Vite 环境变量</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .env</span></span><br><span class="line"><span class="variable constant_">VITE_APP_TITLE</span>=<span class="title class_">My</span> <span class="title class_">App</span></span><br><span class="line"><span class="variable constant_">VITE_API_BASE_URL</span>=<span class="attr">https</span>:<span class="comment">//api.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.development</span></span><br><span class="line"><span class="variable constant_">VITE_API_BASE_URL</span>=<span class="attr">http</span>:<span class="comment">//localhost:8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.production</span></span><br><span class="line"><span class="variable constant_">VITE_API_BASE_URL</span>=<span class="attr">https</span>:<span class="comment">//api.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_APP_TITLE</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_URL</span> = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_BASE_URL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型定义</span></span><br><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ImportMetaEnv</span> &#123;</span><br><span class="line">  readonly <span class="attr">VITE_APP_TITLE</span>: string;</span><br><span class="line">  readonly <span class="attr">VITE_API_BASE_URL</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ImportMeta</span> &#123;</span><br><span class="line">  readonly <span class="attr">env</span>: <span class="title class_">ImportMetaEnv</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Vite-插件开发"><a href="#Vite-插件开发" class="headerlink" title="Vite 插件开发"></a>Vite 插件开发</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// my-plugin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">myPlugin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;my-plugin&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 钩子函数</span></span><br><span class="line">    <span class="title function_">config</span>(<span class="params">config, &#123; command &#125;</span>) &#123;</span><br><span class="line">      <span class="comment">// 修改配置</span></span><br><span class="line">      <span class="keyword">if</span> (command === <span class="string">&#x27;serve&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">server</span>: &#123;</span><br><span class="line">            <span class="attr">port</span>: <span class="number">3000</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">configureServer</span>(<span class="params">server</span>) &#123;</span><br><span class="line">      <span class="comment">// 配置开发服务器</span></span><br><span class="line">      server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/hello&#x27;</span>) &#123;</span><br><span class="line">          res.<span class="title function_">end</span>(<span class="string">&#x27;Hello from Vite plugin!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">next</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">transform</span>(<span class="params">code, id</span>) &#123;</span><br><span class="line">      <span class="comment">// 转换代码</span></span><br><span class="line">      <span class="keyword">if</span> (id.<span class="title function_">endsWith</span>(<span class="string">&#x27;.special&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export default <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(code)&#125;</span>`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">buildStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 构建开始</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Build started&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">buildEnd</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 构建结束</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Build ended&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; myPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;./my-plugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">react</span>(),</span><br><span class="line">    <span class="title function_">myPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="四、构建优化实战"><a href="#四、构建优化实战" class="headerlink" title="四、构建优化实战"></a>四、构建优化实战</h2><h3 id="代码分割策略"><a href="#代码分割策略" class="headerlink" title="代码分割策略"></a>代码分割策略</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Webpack 代码分割</span></span><br><span class="line"><span class="comment">// 动态导入</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/About&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预加载</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">&#x27;./path/to/Login&#x27;</span>);</span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPreload: true */</span> <span class="string">&#x27;./path/to/HeavyComponent&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vite 代码分割</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">defineAsyncComponent</span>(&#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/About&#x27;</span>),</span><br><span class="line">  <span class="attr">loadingComponent</span>: <span class="title class_">Loading</span>,</span><br><span class="line">  <span class="attr">errorComponent</span>: <span class="title class_">Error</span>,</span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">sideEffects</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;*.css&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*.scss&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./src/polyfills.js&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 ES6 模块</span></span><br><span class="line"><span class="comment">// ✅ 正确 - 可以 tree-shaking</span></span><br><span class="line"><span class="keyword">export</span> &#123; fn1, fn2 &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fn1 &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误 - 无法 tree-shaking</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; fn1, fn2 &#125;;</span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;./utils&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="资源优化"><a href="#资源优化" class="headerlink" title="资源优化"></a>资源优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片优化</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;image-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">minimizer</span>: &#123;</span><br><span class="line">            <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">plugins</span>: [</span><br><span class="line">                [<span class="string">&#x27;gifsicle&#x27;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                [<span class="string">&#x27;jpegtran&#x27;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                [<span class="string">&#x27;optipng&#x27;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                [<span class="string">&#x27;svgo&#x27;</span>, &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&#x27;preset-default&#x27;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">overrides</span>: &#123;</span><br><span class="line">                          <span class="attr">removeViewBox</span>: <span class="literal">false</span>,</span><br><span class="line">                          <span class="attr">addAttributesToSVGElement</span>: &#123;</span><br><span class="line">                            <span class="attr">params</span>: &#123;</span><br><span class="line">                              <span class="attr">attributes</span>: [</span><br><span class="line">                                &#123; <span class="attr">xmlns</span>: <span class="string">&#x27;http://www.w3.org/2000/svg&#x27;</span> &#125;</span><br><span class="line">                              ]</span><br><span class="line">                            &#125;</span><br><span class="line">                          &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;]</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字体优化</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(woff2?|eot|ttf|otf)$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">limit</span>: <span class="number">10000</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">          <span class="attr">outputPath</span>: <span class="string">&#x27;fonts/&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;react&#x27;</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;react-dom&#x27;</span>: <span class="string">&#x27;ReactDOM&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;vue&#x27;</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;lodash&#x27;</span>: <span class="string">&#x27;_&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="五、CI-CD-集成"><a href="#五、CI-CD-集成" class="headerlink" title="五、CI&#x2F;CD 集成"></a>五、CI&#x2F;CD 集成</h2><h3 id="GitHub-Actions-配置"><a href="#GitHub-Actions-配置" class="headerlink" title="GitHub Actions 配置"></a>GitHub Actions 配置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/build.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [<span class="string">main</span>, <span class="string">develop</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">node-version:</span> [<span class="number">16.</span><span class="string">x</span>, <span class="number">18.</span><span class="string">x</span>]</span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node-version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node-version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">cache:</span> <span class="string">&#x27;npm&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">linter</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">project</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Upload</span> <span class="string">build</span> <span class="string">artifacts</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/upload-artifact@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">dist</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">dist/</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">matrix.node-version</span> <span class="string">==</span> <span class="string">&#x27;18.x&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">github.ref</span> <span class="string">==</span> <span class="string">&#x27;refs/heads/main&#x27;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./dist</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-部署"><a href="#Docker-部署" class="headerlink" title="Docker 部署"></a>Docker 部署</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="comment"># 构建阶段</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-alpine as builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm ci</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产阶段</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/dist /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> nginx.conf /etc/nginx/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// nginx.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen <span class="number">80</span>;</span><br><span class="line">  server_name localhost;</span><br><span class="line"></span><br><span class="line">  root /usr/share/nginx/html;</span><br><span class="line">  index index.<span class="property">html</span>;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    try_files $uri $uri/ /index.<span class="property">html</span>;</span><br><span class="line"></span><br><span class="line">    # 缓存策略</span><br><span class="line">    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ &#123;</span><br><span class="line">      expires 1y;</span><br><span class="line">      add_header <span class="title class_">Cache</span>-<span class="title class_">Control</span> <span class="string">&quot;public, immutable&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* \.(html)$ &#123;</span><br><span class="line">      expires -<span class="number">1</span>;</span><br><span class="line">      add_header <span class="title class_">Cache</span>-<span class="title class_">Control</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # <span class="title class_">Gzip</span> 压缩</span><br><span class="line">  gzip on;</span><br><span class="line">  gzip_types text/plain text/css application/json application/javascript text/xml application/xml text/javascript;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、性能监控"><a href="#六、性能监控" class="headerlink" title="六、性能监控"></a>六、性能监控</h2><h3 id="Bundle-分析"><a href="#Bundle-分析" class="headerlink" title="Bundle 分析"></a>Bundle 分析</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BundleAnalyzerPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">analyzerMode</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">      <span class="attr">openAnalyzer</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">reportFilename</span>: <span class="string">&#x27;bundle-report.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vite</span></span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-visualizer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">      <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;dist/stats.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="构建速度优化"><a href="#构建速度优化" class="headerlink" title="构建速度优化"></a>构建速度优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 cache-loader</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&#x27;cache-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用持久化缓存</span></span><br><span class="line">  <span class="attr">cache</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;filesystem&#x27;</span>,</span><br><span class="line">    <span class="attr">cacheDirectory</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;.temp_cache&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多线程构建</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="Webpack-vs-Vite-选择"><a href="#Webpack-vs-Vite-选择" class="headerlink" title="Webpack vs Vite 选择"></a>Webpack vs Vite 选择</h3><p><strong>选择 Webpack 如果你需要：</strong></p>
<ul>
<li>✅ 复杂的定制需求</li>
<li>✅ 成熟的插件生态</li>
<li>✅ 细粒度的配置控制</li>
</ul>
<p><strong>选择 Vite 如果你需要：</strong></p>
<ul>
<li>✅ 快速的开发体验</li>
<li>✅ 开箱即用的配置</li>
<li>✅ 现代化的构建工具</li>
</ul>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>代码分割</strong> - 按路由和供应商拆分代码</li>
<li><strong>缓存策略</strong> - contenthash + 长期缓存</li>
<li><strong>压缩优化</strong> - Gzip&#x2F;Brotli + 代码压缩</li>
<li><strong>CDN 加速</strong> - 静态资源 CDN 托管</li>
<li><strong>性能监控</strong> - 持续监测构建产物</li>
</ol>
<p><strong>学习路径</strong>：</p>
<ol>
<li>掌握基础配置</li>
<li>学习性能优化</li>
<li>实践 CI&#x2F;CD</li>
<li>监控和调优</li>
</ol>
<p>前端工程化是一个持续优化的过程，根据项目需求选择合适的工具和策略！</p>
<hr>
<p><em>下一篇将介绍 TypeScript 进阶，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>工程化</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Vite</tag>
        <tag>前端工程化</tag>
        <tag>构建工具</tag>
        <tag>性能优化</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2026/01/20/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>AI应用实战：从理论到生产环境的完整指南</title>
    <url>/2026/01/20/ai-applications/</url>
    <content><![CDATA[<h2 id="AI在生产环境中的应用"><a href="#AI在生产环境中的应用" class="headerlink" title="AI在生产环境中的应用"></a>AI在生产环境中的应用</h2><p>将AI模型从实验室带到生产环境需要考虑多个方面：性能优化、可扩展性、监控维护等。本文将带你了解如何构建完整的AI应用。</p>
<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><h3 id="1-智能客服系统"><a href="#1-智能客服系统" class="headerlink" title="1. 智能客服系统"></a>1. 智能客服系统</h3><p>基于自然语言处理的聊天机器人，可以处理用户咨询、自动回复。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用OpenAI API构建智能客服</span></span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">openai.api_key = <span class="string">&quot;your-api-key&quot;</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    content: <span class="built_in">str</span></span><br><span class="line">    conversation_history: <span class="built_in">list</span> = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/chat&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">message: Message</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 构建对话上下文</span></span><br><span class="line">        messages = [</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;你是一个专业的客服助手&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">        messages.extend(message.conversation_history)</span><br><span class="line">        messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: message.content&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用GPT API</span></span><br><span class="line">        response = openai.ChatCompletion.create(</span><br><span class="line">            model=<span class="string">&quot;gpt-4&quot;</span>,</span><br><span class="line">            messages=messages,</span><br><span class="line">            temperature=<span class="number">0.7</span>,</span><br><span class="line">            max_tokens=<span class="number">1000</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;reply&quot;</span>: response.choices[<span class="number">0</span>].message.content,</span><br><span class="line">            <span class="string">&quot;usage&quot;</span>: response.usage</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行：uvicorn chatbot:app --reload</span></span><br></pre></td></tr></table></figure>

<h3 id="2-图像分类API"><a href="#2-图像分类API" class="headerlink" title="2. 图像分类API"></a>2. 图像分类API</h3><p>使用FastAPI部署图像分类模型：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"></span><br><span class="line">app = FastAPI(title=<span class="string">&quot;图像分类API&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型</span></span><br><span class="line">model = torch.load(<span class="string">&#x27;models/resnet50.pth&#x27;</span>)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 图像预处理</span></span><br><span class="line">transform = transforms.Compose([</span><br><span class="line">    transforms.Resize(<span class="number">256</span>),</span><br><span class="line">    transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    transforms.Normalize(</span><br><span class="line">        mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">        std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]</span><br><span class="line">    )</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类别标签（ImageNet）</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;imagenet_classes.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    classes = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/predict&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">file: UploadFile = File(<span class="params">...</span>)</span>):</span><br><span class="line">    <span class="comment"># 读取图像</span></span><br><span class="line">    image_data = <span class="keyword">await</span> file.read()</span><br><span class="line">    image = Image.<span class="built_in">open</span>(io.BytesIO(image_data))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 预处理</span></span><br><span class="line">    image_tensor = transform(image).unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 预测</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        outputs = model(image_tensor)</span><br><span class="line">        _, predicted = torch.<span class="built_in">max</span>(outputs, <span class="number">1</span>)</span><br><span class="line">        probabilities = torch.nn.functional.softmax(outputs, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取Top-3预测</span></span><br><span class="line">    top3_prob, top3_indices = torch.topk(probabilities, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        results.append(&#123;</span><br><span class="line">            <span class="string">&quot;class&quot;</span>: classes[top3_indices[<span class="number">0</span>][i]],</span><br><span class="line">            <span class="string">&quot;confidence&quot;</span>: <span class="built_in">float</span>(top3_prob[<span class="number">0</span>][i])</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;filename&quot;</span>: file.filename,</span><br><span class="line">        <span class="string">&quot;predictions&quot;</span>: results</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-推荐系统"><a href="#3-推荐系统" class="headerlink" title="3. 推荐系统"></a>3. 推荐系统</h3><p>基于协同过滤的个性化推荐：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RecommenderSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.user_item_matrix = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.user_similarity = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">self, ratings</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;训练推荐模型</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            ratings: 用户-物品评分矩阵</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.user_item_matrix = ratings</span><br><span class="line">        <span class="comment"># 计算用户相似度</span></span><br><span class="line">        <span class="variable language_">self</span>.user_similarity = cosine_similarity(ratings)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recommend</span>(<span class="params">self, user_id, top_k=<span class="number">5</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;为用户推荐物品</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            user_id: 用户ID</span></span><br><span class="line"><span class="string">            top_k: 返回前K个推荐</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 找到相似用户</span></span><br><span class="line">        similar_users = <span class="variable language_">self</span>.user_similarity[user_id]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算推荐分数</span></span><br><span class="line">        scores = np.zeros(<span class="variable language_">self</span>.user_item_matrix.shape[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> item_id <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.user_item_matrix.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># 跳过已评分物品</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.user_item_matrix[user_id, item_id] &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 加权求和</span></span><br><span class="line">            numerator = <span class="number">0</span></span><br><span class="line">            denominator = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> other_user <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(similar_users)):</span><br><span class="line">                <span class="keyword">if</span> other_user == user_id:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                rating = <span class="variable language_">self</span>.user_item_matrix[other_user, item_id]</span><br><span class="line">                <span class="keyword">if</span> rating &gt; <span class="number">0</span>:</span><br><span class="line">                    numerator += similar_users[other_user] * rating</span><br><span class="line">                    denominator += <span class="built_in">abs</span>(similar_users[other_user])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> denominator &gt; <span class="number">0</span>:</span><br><span class="line">                scores[item_id] = numerator / denominator</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 返回Top-K推荐</span></span><br><span class="line">        top_items = np.argsort(scores)[::-<span class="number">1</span>][:top_k]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [(item, scores[item]) <span class="keyword">for</span> item <span class="keyword">in</span> top_items]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">ratings = np.array([</span><br><span class="line">    [<span class="number">5</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>],  <span class="comment"># 用户0</span></span><br><span class="line">    [<span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],  <span class="comment"># 用户1</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>],  <span class="comment"># 用户2</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>],  <span class="comment"># 用户3</span></span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">0</span>],  <span class="comment"># 用户4</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">recommender = RecommenderSystem()</span><br><span class="line">recommender.fit(ratings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为用户0推荐</span></span><br><span class="line">recommendations = recommender.recommend(<span class="number">0</span>, top_k=<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;推荐物品:&quot;</span>, recommendations)</span><br></pre></td></tr></table></figure>

<h2 id="模型部署策略"><a href="#模型部署策略" class="headerlink" title="模型部署策略"></a>模型部署策略</h2><h3 id="1-Docker容器化"><a href="#1-Docker容器化" class="headerlink" title="1. Docker容器化"></a>1. Docker容器化</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制模型和代码</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> models/ ./models/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.py .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;uvicorn&quot;</span>, <span class="string">&quot;app:app&quot;</span>, <span class="string">&quot;--host&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;8000&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MODEL_PATH=/app/models</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./models:/app/models</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">api</span></span><br></pre></td></tr></table></figure>

<h3 id="2-使用ONNX进行模型优化"><a href="#2-使用ONNX进行模型优化" class="headerlink" title="2. 使用ONNX进行模型优化"></a>2. 使用ONNX进行模型优化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将PyTorch模型转换为ONNX格式</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.onnx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型</span></span><br><span class="line">model = torch.load(<span class="string">&#x27;model.pth&#x27;</span>)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成示例输入</span></span><br><span class="line">dummy_input = torch.randn(<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出为ONNX</span></span><br><span class="line">torch.onnx.export(</span><br><span class="line">    model,</span><br><span class="line">    dummy_input,</span><br><span class="line">    <span class="string">&quot;model.onnx&quot;</span>,</span><br><span class="line">    export_params=<span class="literal">True</span>,</span><br><span class="line">    opset_version=<span class="number">12</span>,</span><br><span class="line">    do_constant_folding=<span class="literal">True</span>,</span><br><span class="line">    input_names=[<span class="string">&#x27;input&#x27;</span>],</span><br><span class="line">    output_names=[<span class="string">&#x27;output&#x27;</span>],</span><br><span class="line">    dynamic_axes=&#123;</span><br><span class="line">        <span class="string">&#x27;input&#x27;</span>: &#123;<span class="number">0</span>: <span class="string">&#x27;batch_size&#x27;</span>&#125;,</span><br><span class="line">        <span class="string">&#x27;output&#x27;</span>: &#123;<span class="number">0</span>: <span class="string">&#x27;batch_size&#x27;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ONNX Runtime进行推理</span></span><br><span class="line"><span class="keyword">import</span> onnxruntime <span class="keyword">as</span> ort</span><br><span class="line"></span><br><span class="line">session = ort.InferenceSession(<span class="string">&quot;model.onnx&quot;</span>)</span><br><span class="line">input_name = session.get_inputs()[<span class="number">0</span>].name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推理</span></span><br><span class="line">outputs = session.run(<span class="literal">None</span>, &#123;input_name: dummy_input.numpy()&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-模型量化与压缩"><a href="#3-模型量化与压缩" class="headerlink" title="3. 模型量化与压缩"></a>3. 模型量化与压缩</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.quantization</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态量化</span></span><br><span class="line">model_dynamic = torch.quantization.quantize_dynamic(</span><br><span class="line">    model, &#123;torch.nn.Linear&#125;, dtype=torch.qint8</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态量化（需要校准数据）</span></span><br><span class="line">model.qconfig = torch.quantization.get_default_qconfig(<span class="string">&#x27;fbgemm&#x27;</span>)</span><br><span class="line">model_prepared = torch.quantization.prepare(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用校准数据进行校准</span></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> calibration_dataset:</span><br><span class="line">        model_prepared(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为量化模型</span></span><br><span class="line">model_quantized = torch.quantization.convert(model_prepared)</span><br></pre></td></tr></table></figure>

<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><h3 id="1-批处理推理"><a href="#1-批处理推理" class="headerlink" title="1. 批处理推理"></a>1. 批处理推理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BatchInferenceEngine</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model, batch_size=<span class="number">32</span>, timeout=<span class="number">0.1</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = model</span><br><span class="line">        <span class="variable language_">self</span>.batch_size = batch_size</span><br><span class="line">        <span class="variable language_">self</span>.timeout = timeout</span><br><span class="line">        <span class="variable language_">self</span>.queue = queue.Queue()</span><br><span class="line">        <span class="variable language_">self</span>.executor = ThreadPoolExecutor(max_workers=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;异步预测接口&quot;&quot;&quot;</span></span><br><span class="line">        future = <span class="variable language_">self</span>.executor.submit(<span class="variable language_">self</span>._add_to_batch, input_data)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> asyncio.wrap_future(future)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_add_to_batch</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加到批次并等待结果&quot;&quot;&quot;</span></span><br><span class="line">        result_future = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.queue.put((input_data, result_future))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 等待批次完成</span></span><br><span class="line">        <span class="keyword">while</span> <span class="string">&#x27;result&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> result_future:</span><br><span class="line">            time.sleep(<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result_future[<span class="string">&#x27;result&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_batches</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;批量处理&quot;&quot;&quot;</span></span><br><span class="line">        batch = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 收集批次</span></span><br><span class="line">                item, result_future = <span class="variable language_">self</span>.queue.get(timeout=<span class="variable language_">self</span>.timeout)</span><br><span class="line">                batch.append((item, result_future))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(batch) &gt;= <span class="variable language_">self</span>.batch_size:</span><br><span class="line">                    <span class="variable language_">self</span>._execute_batch(batch)</span><br><span class="line">                    batch = []</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">if</span> batch:</span><br><span class="line">                    <span class="variable language_">self</span>._execute_batch(batch)</span><br><span class="line">                    batch = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_execute_batch</span>(<span class="params">self, batch</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行批量推理&quot;&quot;&quot;</span></span><br><span class="line">        inputs = [item[<span class="number">0</span>] <span class="keyword">for</span> item <span class="keyword">in</span> batch]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            outputs = <span class="variable language_">self</span>.model(inputs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (input_data, result_future), output <span class="keyword">in</span> <span class="built_in">zip</span>(batch, outputs):</span><br><span class="line">            result_future[<span class="string">&#x27;result&#x27;</span>] = output</span><br></pre></td></tr></table></figure>

<h3 id="2-缓存机制"><a href="#2-缓存机制" class="headerlink" title="2. 缓存机制"></a>2. 缓存机制</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model, cache_size=<span class="number">1000</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = model</span><br><span class="line">        <span class="variable language_">self</span>.cache_size = cache_size</span><br><span class="line"></span><br><span class="line"><span class="meta">    @lru_cache(<span class="params">maxsize=<span class="number">1000</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_hash_input</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成输入哈希&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(<span class="built_in">str</span>(input_data).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;带缓存的预测&quot;&quot;&quot;</span></span><br><span class="line">        input_hash = <span class="variable language_">self</span>._hash_input(input_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查缓存</span></span><br><span class="line">        <span class="keyword">if</span> input_hash <span class="keyword">in</span> <span class="variable language_">self</span>.cache:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.cache[input_hash]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 模型推理</span></span><br><span class="line">        result = <span class="variable language_">self</span>.model(input_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 缓存结果</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.cache) &lt; <span class="variable language_">self</span>.cache_size:</span><br><span class="line">            <span class="variable language_">self</span>.cache[input_hash] = result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="监控与日志"><a href="#监控与日志" class="headerlink" title="监控与日志"></a>监控与日志</h2><h3 id="1-模型性能监控"><a href="#1-模型性能监控" class="headerlink" title="1. 模型性能监控"></a>1. 模型性能监控</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> prometheus_client <span class="keyword">import</span> Counter, Histogram, Gauge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义指标</span></span><br><span class="line">prediction_counter = Counter(<span class="string">&#x27;model_predictions_total&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;Total predictions&#x27;</span>,</span><br><span class="line">                            [<span class="string">&#x27;model_version&#x27;</span>, <span class="string">&#x27;status&#x27;</span>])</span><br><span class="line"></span><br><span class="line">prediction_latency = Histogram(<span class="string">&#x27;model_prediction_latency_seconds&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;Prediction latency&#x27;</span>)</span><br><span class="line"></span><br><span class="line">model_accuracy = Gauge(<span class="string">&#x27;model_accuracy&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;Model accuracy&#x27;</span>,</span><br><span class="line">                      [<span class="string">&#x27;model_version&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelMonitor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = model</span><br><span class="line">        <span class="variable language_">self</span>.version = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @prediction_latency.time()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            start_time = time.time()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 模型推理</span></span><br><span class="line">            result = <span class="variable language_">self</span>.model(input_data)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 记录成功预测</span></span><br><span class="line">            prediction_counter.labels(</span><br><span class="line">                model_version=<span class="variable language_">self</span>.version,</span><br><span class="line">                status=<span class="string">&#x27;success&#x27;</span></span><br><span class="line">            ).inc()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 记录失败预测</span></span><br><span class="line">            prediction_counter.labels(</span><br><span class="line">                model_version=<span class="variable language_">self</span>.version,</span><br><span class="line">                status=<span class="string">&#x27;error&#x27;</span></span><br><span class="line">            ).inc()</span><br><span class="line">            <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_accuracy</span>(<span class="params">self, accuracy</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新准确率指标&quot;&quot;&quot;</span></span><br><span class="line">        model_accuracy.labels(model_version=<span class="variable language_">self</span>.version).<span class="built_in">set</span>(accuracy)</span><br></pre></td></tr></table></figure>

<h3 id="2-日志记录"><a href="#2-日志记录" class="headerlink" title="2. 日志记录"></a>2. 日志记录</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelLogger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model_name = model_name</span><br><span class="line">        <span class="variable language_">self</span>.logger = <span class="variable language_">self</span>._setup_logger()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_logger</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;配置日志&quot;&quot;&quot;</span></span><br><span class="line">        logger = logging.getLogger(<span class="variable language_">self</span>.model_name)</span><br><span class="line">        logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 文件处理器</span></span><br><span class="line">        fh = logging.FileHandler(<span class="string">f&#x27;<span class="subst">&#123;self.model_name&#125;</span>.log&#x27;</span>)</span><br><span class="line">        fh.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 控制台处理器</span></span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line">        ch.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 格式化</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">        logger.addHandler(fh)</span><br><span class="line">        logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_prediction</span>(<span class="params">self, input_data, output, latency</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录预测信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logger.info(&#123;</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&quot;input_shape&quot;</span>: input_data.shape,</span><br><span class="line">            <span class="string">&quot;output&quot;</span>: output.tolist() <span class="keyword">if</span> <span class="built_in">hasattr</span>(output, <span class="string">&#x27;tolist&#x27;</span>) <span class="keyword">else</span> output,</span><br><span class="line">            <span class="string">&quot;latency_ms&quot;</span>: latency * <span class="number">1000</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_error</span>(<span class="params">self, error</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录错误&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logger.error(<span class="string">f&quot;Prediction error: <span class="subst">&#123;<span class="built_in">str</span>(error)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="A-B测试框架"><a href="#A-B测试框架" class="headerlink" title="A&#x2F;B测试框架"></a>A&#x2F;B测试框架</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelABTest</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A/B测试基类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelA</span>(<span class="title class_ inherited__">ModelABTest</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = <span class="variable language_">self</span>._load_model(<span class="string">&#x27;model_a.pth&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.model(input_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelB</span>(<span class="title class_ inherited__">ModelABTest</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = <span class="variable language_">self</span>._load_model(<span class="string">&#x27;model_b.pth&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.model(input_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ABTestRouter</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A/B测试路由器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_a, model_b, traffic_ratio=<span class="number">0.5</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.model_a = model_a</span><br><span class="line">        <span class="variable language_">self</span>.model_b = model_b</span><br><span class="line">        <span class="variable language_">self</span>.traffic_ratio = traffic_ratio</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 统计指标</span></span><br><span class="line">        <span class="variable language_">self</span>.metrics = &#123;</span><br><span class="line">            <span class="string">&#x27;model_a&#x27;</span>: &#123;<span class="string">&#x27;count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;errors&#x27;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;model_b&#x27;</span>: &#123;<span class="string">&#x27;count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;errors&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">route</span>(<span class="params">self, user_id, input_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;根据用户ID路由到不同模型&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 使用用户ID进行哈希，确保同一用户总是使用同一模型</span></span><br><span class="line">        hash_val = <span class="built_in">hash</span>(user_id) % <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> hash_val &lt; <span class="variable language_">self</span>.traffic_ratio * <span class="number">100</span>:</span><br><span class="line">            model = <span class="variable language_">self</span>.model_a</span><br><span class="line">            model_name = <span class="string">&#x27;model_a&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            model = <span class="variable language_">self</span>.model_b</span><br><span class="line">            model_name = <span class="string">&#x27;model_b&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = model.predict(input_data)</span><br><span class="line">            <span class="variable language_">self</span>.metrics[model_name][<span class="string">&#x27;count&#x27;</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="variable language_">self</span>.metrics[model_name][<span class="string">&#x27;errors&#x27;</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_metrics</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取A/B测试指标&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.metrics</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>构建生产级AI应用需要综合考虑：</p>
<ol>
<li><strong>模型选择</strong> - 根据场景选择合适的算法</li>
<li><strong>性能优化</strong> - 量化、批处理、缓存</li>
<li><strong>可扩展性</strong> - Docker、Kubernetes部署</li>
<li><strong>监控运维</strong> - 日志、指标、A&#x2F;B测试</li>
<li><strong>安全隐私</strong> - 数据加密、模型保护</li>
</ol>
<p><strong>最佳实践：</strong></p>
<ul>
<li>使用容器化部署</li>
<li>实施完善的监控</li>
<li>建立CI&#x2F;CD流水线</li>
<li>定期重新训练模型</li>
<li>做好错误处理和降级</li>
</ul>
<p>AI的魅力在于应用，希望这些实战案例能帮助你构建自己的AI应用！</p>
<hr>
<p><em>系列文章完结，感谢阅读！欢迎在评论区分享你的AI项目经验。</em></p>
]]></content>
      <categories>
        <category>全栈</category>
        <category>AI</category>
      </categories>
      <tags>
        <tag>AI应用</tag>
        <tag>实战项目</tag>
        <tag>API开发</tag>
        <tag>模型部署</tag>
      </tags>
  </entry>
  <entry>
    <title>前端性能优化完全指南：从理论到实战</title>
    <url>/2026/01/20/frontend-performance-optimization/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前端性能直接影响用户体验和业务指标。据统计，页面加载时间每增加1秒，转化率可能下降7%。本文将从多个维度全面介绍前端性能优化的策略和实战技巧。</p>
<h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><h3 id="核心Web指标（Core-Web-Vitals）"><a href="#核心Web指标（Core-Web-Vitals）" class="headerlink" title="核心Web指标（Core Web Vitals）"></a>核心Web指标（Core Web Vitals）</h3><p>Google 的 Core Web Vitals 是衡量用户体验的核心指标：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────┐</span><br><span class="line">│           Core Web Vitals 核心指标               │</span><br><span class="line">├─────────────────────────────────────────────────┤</span><br><span class="line">│  LCP (Largest Contentful Paint)                │</span><br><span class="line">│  - 最大内容绘制                                  │</span><br><span class="line">│  - 目标: &lt; 2.5秒                                │</span><br><span class="line">│  - 测量: 主要内容加载速度                        │</span><br><span class="line">├─────────────────────────────────────────────────┤</span><br><span class="line">│  FID (First Input Delay)                        │</span><br><span class="line">│  - 首次输入延迟                                  │</span><br><span class="line">│  - 目标: &lt; 100毫秒                              │</span><br><span class="line">│  - 测量: 页面交互响应速度                        │</span><br><span class="line">├─────────────────────────────────────────────────┤</span><br><span class="line">│  CLS (Cumulative Layout Shift)                 │</span><br><span class="line">│  - 累积布局偏移                                  │</span><br><span class="line">│  - 目标: &lt; 0.1                                  │</span><br><span class="line">│  - 测量: 视觉稳定性                              │</span><br><span class="line">└─────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="其他重要指标"><a href="#其他重要指标" class="headerlink" title="其他重要指标"></a>其他重要指标</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 性能指标示例</span></span><br><span class="line"><span class="keyword">const</span> metrics = &#123;</span><br><span class="line">  <span class="comment">// 加载性能</span></span><br><span class="line">  <span class="attr">FCP</span>: <span class="string">&#x27;First Contentful Paint &lt; 1.8s&#x27;</span>,  <span class="comment">// 首次内容绘制</span></span><br><span class="line">  <span class="attr">TTI</span>: <span class="string">&#x27;Time to Interactive &lt; 3.8s&#x27;</span>,     <span class="comment">// 可交互时间</span></span><br><span class="line">  <span class="title class_">SpeedIndex</span>: <span class="string">&#x27;速度指数 &lt; 3.4s&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 运行时性能</span></span><br><span class="line">  <span class="attr">TBT</span>: <span class="string">&#x27;Total Blocking Time &lt; 200ms&#x27;</span>,   <span class="comment">// 总阻塞时间</span></span><br><span class="line">  <span class="title class_">LongTasks</span>: <span class="string">&#x27;长任务数量 &lt; 5个&#x27;</span>,         <span class="comment">// &gt;50ms的任务</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义业务指标</span></span><br><span class="line">  <span class="title class_">TimeToInteractive</span>: <span class="string">&#x27;可交互时间&#x27;</span>,</span><br><span class="line">  <span class="title class_">ConversionRate</span>: <span class="string">&#x27;转化率&#x27;</span>,</span><br><span class="line">  <span class="title class_">BounceRate</span>: <span class="string">&#x27;跳出率&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="加载性能优化"><a href="#加载性能优化" class="headerlink" title="加载性能优化"></a>加载性能优化</h2><h3 id="1-资源压缩与优化"><a href="#1-资源压缩与优化" class="headerlink" title="1. 资源压缩与优化"></a>1. 资源压缩与优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">drop_console</span>: <span class="literal">true</span>,  <span class="comment">// 移除 console</span></span><br><span class="line">            <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">performance</span>: &#123;</span><br><span class="line">    <span class="attr">maxEntrypointSize</span>: <span class="number">250000</span>,  <span class="comment">// 入口文件大小限制</span></span><br><span class="line">    <span class="attr">maxAssetSize</span>: <span class="number">250000</span>        <span class="comment">// 资源文件大小限制</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gzip 压缩</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|html|svg)$/</span>,</span><br><span class="line">      <span class="attr">threshold</span>: <span class="number">10240</span>,  <span class="comment">// 只压缩 &gt;10KB 的文件</span></span><br><span class="line">      <span class="attr">minRatio</span>: <span class="number">0.8</span>      <span class="comment">// 压缩率 &gt; 20% 才压缩</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Brotli 压缩（比 Gzip 更高效）</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[path][base].br&#x27;</span>,</span><br><span class="line">      <span class="attr">algorithm</span>: <span class="string">&#x27;brotliCompress&#x27;</span>,</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|html|svg)$/</span>,</span><br><span class="line">      <span class="attr">compressionOptions</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: <span class="number">11</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-代码分割（Code-Splitting）"><a href="#2-代码分割（Code-Splitting）" class="headerlink" title="2. 代码分割（Code Splitting）"></a>2. 代码分割（Code Splitting）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式1：路由级别分割</span></span><br><span class="line"><span class="keyword">import</span> &#123; lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/About&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Dashboard</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Dashboard&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">LoadingSpinner</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/dashboard&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Dashboard</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：组件级别分割</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HeavyChart</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./components/HeavyChart&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dashboard</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [showChart, setShowChart] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShowChart(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        显示图表</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;showChart &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>加载图表...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">HeavyChart</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式3：Webpack 动态导入</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadModule</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./utils/heavyModule&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">module</span>.<span class="title function_">doSomething</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;模块加载失败&#x27;</span>, error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式4：Named export（命名导出）</span></span><br><span class="line"><span class="keyword">const</span> &#123; utils1, utils2 &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./utils&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-Tree-Shaking"><a href="#3-Tree-Shaking" class="headerlink" title="3. Tree Shaking"></a>3. Tree Shaking</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ✅ 正确：使用 ES6 模块</span></span><br><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">func1</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">func2</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">func3</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js - 只导入需要的函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; func1 &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"><span class="title function_">func1</span>();</span><br><span class="line"><span class="comment">// func2 和 func3 会被 tree-shaking 删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误：使用 CommonJS</span></span><br><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">func1</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">func2</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">func3</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js - 即使只用 func1，整个模块都会被打包</span></span><br><span class="line"><span class="keyword">const</span> &#123; func1 &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./utils&#x27;</span>);</span><br><span class="line"><span class="title function_">func1</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json 配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;my-package&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 告诉 webpack 所有文件都是无副作用的</span></span><br><span class="line">  <span class="comment">// 或者明确指定有副作用的文件</span></span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;*.css&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./src/polyfills.js&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-资源加载优化"><a href="#4-资源加载优化" class="headerlink" title="4. 资源加载优化"></a>4. 资源加载优化</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 预加载关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/fonts/main.woff2&quot;</span> <span class="attr">as</span>=<span class="string">&quot;font&quot;</span> <span class="attr">type</span>=<span class="string">&quot;font/woff2&quot;</span> <span class="attr">crossorigin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/styles/main.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. 预连接到跨域资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preconnect&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://api.example.com&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;dns-prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.example.com&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3. 预获取下一页资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/next-page.js&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prerender&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/next-page.html&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4. 延迟加载非关键CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/styles/critical.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;this.onload=null;this.rel=&#x27;stylesheet&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/styles/critical.css&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 5. 异步加载JavaScript --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/analytics.js&quot;</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  <span class="comment">&lt;!-- 异步加载，不保证顺序 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/main.js&quot;</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>      <span class="comment">&lt;!-- 延迟到HTML解析完成后加载 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 6. 响应式图片 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;small.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">&quot;small.jpg 500w,</span></span></span><br><span class="line"><span class="string"><span class="tag">          medium.jpg 1000w,</span></span></span><br><span class="line"><span class="string"><span class="tag">          large.jpg 1500w&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">&quot;(max-width: 600px) 500px,</span></span></span><br><span class="line"><span class="string"><span class="tag">         (max-width: 1200px) 1000px,</span></span></span><br><span class="line"><span class="string"><span class="tag">         1500px&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;响应式图片&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 7. 现代图片格式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;image.avif&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/avif&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;image.webp&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/webp&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;降级图片&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="运行时性能优化"><a href="#运行时性能优化" class="headerlink" title="运行时性能优化"></a>运行时性能优化</h2><h3 id="1-虚拟列表和虚拟滚动"><a href="#1-虚拟列表和虚拟滚动" class="headerlink" title="1. 虚拟列表和虚拟滚动"></a>1. 虚拟列表和虚拟滚动</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 react-window</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FixedSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">VirtualizedList</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; index, style &#125;</span>) =&gt; (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span> <span class="attr">className</span>=<span class="string">&quot;list-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items[index].name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">FixedSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;600&#125;</span>           // <span class="attr">可视区域高度</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemCount</span>=<span class="string">&#123;items.length&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemSize</span>=<span class="string">&#123;50&#125;</span>          // <span class="attr">每项高度</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">FixedSizeList</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态高度的虚拟列表</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VariableSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">VariableList</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getItemSize</span> = (<span class="params">index</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 根据内容动态计算高度</span></span><br><span class="line">    <span class="keyword">return</span> items[index].<span class="property">height</span> || <span class="number">50</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; index, style &#125;</span>) =&gt; (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items[index].content&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">VariableSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemCount</span>=<span class="string">&#123;items.length&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemSize</span>=<span class="string">&#123;getItemSize&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">VariableSizeList</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-防抖和节流"><a href="#2-防抖和节流" class="headerlink" title="2. 防抖和节流"></a>2. 防抖和节流</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 防抖（Debounce）：延迟执行，只在最后一次触发后执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">executedFunction</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">later</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">      <span class="title function_">func</span>(...args);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="built_in">setTimeout</span>(later, wait);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用场景：搜索输入</span></span><br><span class="line"><span class="keyword">const</span> debouncedSearch = <span class="title function_">debounce</span>(<span class="function">(<span class="params">query</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">performSearch</span>(query);</span><br><span class="line">&#125;, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> debouncedSearch(e.target.value)&#125; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流（Throttle）：固定时间间隔执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, limit</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> inThrottle;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">executedFunction</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!inThrottle) &#123;</span><br><span class="line">      <span class="title function_">func</span>(...args);</span><br><span class="line">      inThrottle = <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> inThrottle = <span class="literal">false</span>, limit);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用场景：滚动事件</span></span><br><span class="line"><span class="keyword">const</span> throttledScroll = <span class="title function_">throttle</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">handleScroll</span>();</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, throttledScroll);</span><br><span class="line"></span><br><span class="line"><span class="comment">// requestAnimationFrame 优化</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rafThrottle</span>(<span class="params">func</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> rafId = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">executedFunction</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rafId === <span class="literal">null</span>) &#123;</span><br><span class="line">      rafId = <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">func</span>(...args);</span><br><span class="line">        rafId = <span class="literal">null</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="title function_">rafThrottle</span>(handleScroll));</span><br></pre></td></tr></table></figure>

<h3 id="3-Memo-和-useCallback"><a href="#3-Memo-和-useCallback" class="headerlink" title="3. Memo 和 useCallback"></a>3. Memo 和 useCallback</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; memo, useMemo, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// React.memo：避免不必要的重渲染</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ExpensiveComponent</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">ExpensiveComponent</span>(<span class="params">&#123; data &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 复杂计算</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">expensiveCalculation</span>(item));</span><br><span class="line">  &#125;, [data]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;result&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义比较函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserCard</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">UserCard</span>(<span class="params">&#123; user &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;, <span class="function">(<span class="params">prevProps, nextProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 只比较 ID</span></span><br><span class="line">  <span class="keyword">return</span> prevProps.<span class="property">user</span>.<span class="property">id</span> === nextProps.<span class="property">user</span>.<span class="property">id</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// useCallback：缓存回调函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ParentComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 使用 useCallback</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">  &#125;, []); <span class="comment">// 空依赖，函数永远不会改变</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ❌ 不使用 useCallback，每次都创建新函数</span></span><br><span class="line">  <span class="comment">// const handleClick = () =&gt; setCount(count + 1);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际示例：列表优化</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserList</span>(<span class="params">&#123; users, onSelect &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> handleSelect = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">userId</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onSelect</span>(userId);</span><br><span class="line">  &#125;, [onSelect]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;users.map(user =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserItem</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">key</span>=<span class="string">&#123;user.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">user</span>=<span class="string">&#123;user&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onSelect</span>=<span class="string">&#123;handleSelect&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserItem</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">UserItem</span>(<span class="params">&#123; user, onSelect &#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;渲染 UserItem:&#x27;</span>, user.<span class="property">id</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onSelect(user.id)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;user.name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-长任务优化"><a href="#4-长任务优化" class="headerlink" title="4. 长任务优化"></a>4. 长任务优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 分割长任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">splitTask</span>(<span class="params">tasks, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">BATCH_SIZE</span> = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">processBatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> batch = tasks.<span class="title function_">slice</span>(index, index + <span class="variable constant_">BATCH_SIZE</span>);</span><br><span class="line">    batch.<span class="title function_">forEach</span>(<span class="function"><span class="params">task</span> =&gt;</span> <span class="title function_">callback</span>(task));</span><br><span class="line">    index += <span class="variable constant_">BATCH_SIZE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; tasks.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// 使用 setTimeout 让出主线程</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(processBatch, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">processBatch</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> largeDataSet = <span class="title class_">Array</span>(<span class="number">10000</span>).<span class="title function_">fill</span>(<span class="number">0</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> i);</span><br><span class="line"></span><br><span class="line"><span class="title function_">splitTask</span>(largeDataSet, <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">processData</span>(item);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 requestIdleCallback</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processTasks</span>(<span class="params">tasks</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">BATCH_SIZE</span> = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">processBatch</span>(<span class="params">deadline</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (index &lt; tasks.<span class="property">length</span> &amp;&amp; deadline.<span class="title function_">timeRemaining</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">processTask</span>(tasks[index]);</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; tasks.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="title function_">requestIdleCallback</span>(processBatch);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestIdleCallback</span>(processBatch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Web Worker 处理密集计算</span></span><br><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">heavyComputation</span>(e.<span class="property">data</span>);</span><br><span class="line">  self.<span class="title function_">postMessage</span>(result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&#x27;worker.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line">worker.<span class="property">onmessage</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = e.<span class="property">data</span>;</span><br><span class="line">  <span class="title function_">updateUI</span>(result);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">worker.<span class="title function_">postMessage</span>(largeDataSet);</span><br></pre></td></tr></table></figure>

<h2 id="渲染性能优化"><a href="#渲染性能优化" class="headerlink" title="渲染性能优化"></a>渲染性能优化</h2><h3 id="1-CSS-优化"><a href="#1-CSS-优化" class="headerlink" title="1. CSS 优化"></a>1. CSS 优化</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1. 减少重排和重绘 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ❌ 会触发重排 */</span></span><br><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ✅ 使用 transform 代替 position */</span></span><br><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">20px</span>);</span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 使用 contain 属性 */</span></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  <span class="attribute">contain</span>: layout style paint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. GPU 加速 */</span></span><br><span class="line"><span class="selector-class">.animated-element</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateZ</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">  <span class="attribute">backface-visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4. 优化动画 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> slideIn &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.slide-in</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: slideIn <span class="number">0.3s</span> ease-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 5. 避免 CSS 表达式 */</span></span><br><span class="line"><span class="comment">/* ❌ 糟糕的性能 */</span></span><br><span class="line"><span class="selector-class">.bad</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">expression</span>(document.body.clientWidth &gt; <span class="number">800</span> ? <span class="string">&#x27;800px&#x27;</span> : <span class="string">&#x27;auto&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-DOM-优化"><a href="#2-DOM-优化" class="headerlink" title="2. DOM 优化"></a>2. DOM 优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 减少 DOM 操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 每次循环都操作 DOM</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="property">innerHTML</span> += <span class="string">`&lt;li&gt;Item <span class="subst">$&#123;i&#125;</span>&lt;/li&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 使用 DocumentFragment</span></span><br><span class="line"><span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> li = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">  li.<span class="property">textContent</span> = <span class="string">`Item <span class="subst">$&#123;i&#125;</span>`</span>;</span><br><span class="line">  fragment.<span class="title function_">appendChild</span>(li);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="title function_">appendChild</span>(fragment);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 一次性更新 DOM</span></span><br><span class="line"><span class="keyword">const</span> listItems = <span class="title class_">Array</span>(<span class="number">1000</span>).<span class="title function_">fill</span>(<span class="number">0</span>)</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="string">`&lt;li&gt;Item <span class="subst">$&#123;i&#125;</span>&lt;/li&gt;`</span>)</span><br><span class="line">  .<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="property">innerHTML</span> = listItems;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 批量 DOM 更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateElement</span>(<span class="params">el, styles</span>) &#123;</span><br><span class="line">  <span class="comment">// ❌ 多次重排</span></span><br><span class="line">  <span class="comment">// el.style.width = &#x27;100px&#x27;;</span></span><br><span class="line">  <span class="comment">// el.style.height = &#x27;100px&#x27;;</span></span><br><span class="line">  <span class="comment">// el.style.margin = &#x27;10px&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 一次性修改，只触发一次重排</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">assign</span>(el.<span class="property">style</span>, &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;100px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;100px&#x27;</span>,</span><br><span class="line">    <span class="attr">margin</span>: <span class="string">&#x27;10px&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用虚拟 DOM（React 自动优化）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items.map(item =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-图片懒加载"><a href="#3-图片懒加载" class="headerlink" title="3. 图片懒加载"></a>3. 图片懒加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 Intersection Observer API</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyImage</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">img</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">img</span> = img;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">src</span> = img.<span class="property">dataset</span>.<span class="property">src</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">      entries.<span class="title function_">forEach</span>(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">load</span>();</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">unobserve</span>(<span class="variable language_">this</span>.<span class="property">img</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">rootMargin</span>: <span class="string">&#x27;50px&#x27;</span>  <span class="comment">// 提前50px加载</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">observe</span>(<span class="variable language_">this</span>.<span class="property">img</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">img</span>.<span class="property">src</span> = <span class="variable language_">this</span>.<span class="property">src</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">img</span>.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;loaded&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;img[data-src]&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">img</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">LazyImage</span>(img);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// React Hook 版本</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLazyImage</span>(<span class="params">src</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [imageSrc, setImageSrc] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> imgRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(</span><br><span class="line">      <span class="function">(<span class="params">[entry]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">          <span class="title function_">setImageSrc</span>(src);</span><br><span class="line">          observer.<span class="title function_">disconnect</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">rootMargin</span>: <span class="string">&#x27;100px&#x27;</span> &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imgRef.<span class="property">current</span>) &#123;</span><br><span class="line">      observer.<span class="title function_">observe</span>(imgRef.<span class="property">current</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> observer.<span class="title function_">disconnect</span>();</span><br><span class="line">  &#125;, [src]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [imgRef, imageSrc];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LazyImage</span>(<span class="params">&#123; src, alt &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [imgRef, imageSrc] = <span class="title function_">useLazyImage</span>(src);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">ref</span>=<span class="string">&#123;imgRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&#123;imageSrc</span> || &#x27;<span class="attr">placeholder.jpg</span>&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&#123;alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络优化"><a href="#网络优化" class="headerlink" title="网络优化"></a>网络优化</h2><h3 id="1-HTTP-缓存"><a href="#1-HTTP-缓存" class="headerlink" title="1. HTTP 缓存"></a>1. HTTP 缓存</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Express.js 设置缓存</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源缓存</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">maxAge</span>: <span class="string">&#x27;1y&#x27;</span>,           <span class="comment">// 1年</span></span><br><span class="line">  <span class="attr">etag</span>: <span class="literal">true</span>,             <span class="comment">// 启用 ETag</span></span><br><span class="line">  <span class="attr">lastModified</span>: <span class="literal">true</span>,     <span class="comment">// 启用 Last-Modified</span></span><br><span class="line">  <span class="attr">setHeaders</span>: <span class="function">(<span class="params">res, path</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// HTML 文件不缓存</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">endsWith</span>(<span class="string">&#x27;.html&#x27;</span>)) &#123;</span><br><span class="line">      res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;no-cache&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// API 响应缓存</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=300&#x27;</span>); <span class="comment">// 5分钟</span></span><br><span class="line">  res.<span class="title function_">json</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Service Worker 缓存</span></span><br><span class="line"><span class="comment">// sw.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CACHE_NAME</span> = <span class="string">&#x27;v1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> urlsToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/styles/main.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/scripts/main.js&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">open</span>(<span class="variable constant_">CACHE_NAME</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">cache</span>) =&gt;</span> cache.<span class="title function_">addAll</span>(urlsToCache))</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">respondWith</span>(</span><br><span class="line">    caches.<span class="title function_">match</span>(event.<span class="property">request</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 缓存命中则返回缓存，否则发起网络请求</span></span><br><span class="line">        <span class="keyword">return</span> response || <span class="title function_">fetch</span>(event.<span class="property">request</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-CDN-加速"><a href="#2-CDN-加速" class="headerlink" title="2. CDN 加速"></a>2. CDN 加速</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 CDN 加载第三方库</span></span><br><span class="line"><span class="comment">// ❌ 从自己的服务器加载</span></span><br><span class="line">&lt;script src=<span class="string">&quot;/js/react.production.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 从 CDN 加载</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 webpack externals</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;react&#x27;</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;react-dom&#x27;</span>: <span class="string">&#x27;ReactDOM&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个 CDN 源（容错）</span></span><br><span class="line"><span class="keyword">const</span> cdnUrls = [</span><br><span class="line">  <span class="string">&#x27;https://cdn.jsdelivr.net/npm/package@version/file.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/package/version/file.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https://unpkg.com/package@version/file.js&#x27;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-API-优化"><a href="#3-API-优化" class="headerlink" title="3. API 优化"></a>3. API 优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 请求合并</span></span><br><span class="line"><span class="comment">// ❌ 多次请求</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/user&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> posts = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/posts&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> comments = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/comments&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 合并为一次请求</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/data?include=user,posts,comments&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用 GraphQL</span></span><br><span class="line"><span class="keyword">const</span> query = <span class="string">`</span></span><br><span class="line"><span class="string">  query &#123;</span></span><br><span class="line"><span class="string">    user &#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">      email</span></span><br><span class="line"><span class="string">      posts &#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">        comments &#123;</span></span><br><span class="line"><span class="string">          content</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/graphql&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; query &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 响应压缩</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> compression = <span class="built_in">require</span>(<span class="string">&#x27;compression&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">compression</span>());  <span class="comment">// 启用 gzip 压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. HTTP/2 推送</span></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http2 = <span class="built_in">require</span>(<span class="string">&#x27;http2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http2.<span class="title function_">createSecureServer</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;private-key.pem&#x27;</span>),</span><br><span class="line">  <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;certificate.pem&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;stream&#x27;</span>, <span class="function">(<span class="params">stream, headers</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 推送关键资源</span></span><br><span class="line">  <span class="keyword">if</span> (headers[<span class="string">&#x27;:path&#x27;</span>] === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    stream.<span class="title function_">pushStream</span>(&#123; <span class="string">&#x27;:path&#x27;</span>: <span class="string">&#x27;/styles/main.css&#x27;</span> &#125;, <span class="function">(<span class="params">pushStream</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 发送 CSS 文件</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="监控和分析"><a href="#监控和分析" class="headerlink" title="监控和分析"></a>监控和分析</h2><h3 id="1-性能监控"><a href="#1-性能监控" class="headerlink" title="1. 性能监控"></a>1. 性能监控</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 Performance API</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">measurePerformance</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 页面加载性能</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> perfData = performance.<span class="property">timing</span>;</span><br><span class="line">    <span class="keyword">const</span> pageLoadTime = perfData.<span class="property">loadEventEnd</span> - perfData.<span class="property">navigationStart</span>;</span><br><span class="line">    <span class="keyword">const</span> domReadyTime = perfData.<span class="property">domContentLoadedEventEnd</span> - perfData.<span class="property">navigationStart</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面加载时间:&#x27;</span>, pageLoadTime);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DOM 就绪时间:&#x27;</span>, domReadyTime);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Core Web Vitals</span></span><br><span class="line">  <span class="keyword">import</span> &#123; getCLS, getFID, getFCP, getLCP, getTTFB &#125; <span class="keyword">from</span> <span class="string">&#x27;web-vitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getCLS</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line">  <span class="title function_">getFID</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line">  <span class="title function_">getFCP</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line">  <span class="title function_">getLCP</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line">  <span class="title function_">getTTFB</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义指标</span></span><br><span class="line">  performance.<span class="title function_">mark</span>(<span class="string">&#x27;feature-start&#x27;</span>);</span><br><span class="line">  <span class="comment">// ... 功能代码</span></span><br><span class="line">  performance.<span class="title function_">mark</span>(<span class="string">&#x27;feature-end&#x27;</span>);</span><br><span class="line">  performance.<span class="title function_">measure</span>(<span class="string">&#x27;feature&#x27;</span>, <span class="string">&#x27;feature-start&#x27;</span>, <span class="string">&#x27;feature-end&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> measure = performance.<span class="title function_">getEntriesByName</span>(<span class="string">&#x27;feature&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;功能执行时间:&#x27;</span>, measure.<span class="property">duration</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送到分析平台</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trackPerformance</span>(<span class="params">metrics</span>) &#123;</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/api/analytics&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(metrics),</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Lighthouse-分析"><a href="#2-Lighthouse-分析" class="headerlink" title="2. Lighthouse 分析"></a>2. Lighthouse 分析</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令行使用 Lighthouse</span></span><br><span class="line">npx lighthouse https://example.com --output html --output-path report.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># CI/CD 集成</span></span><br><span class="line">npm install --save-dev lighthouse</span><br><span class="line"></span><br><span class="line"><span class="comment"># package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lighthouse&quot;</span>: <span class="string">&quot;lighthouse https://example.com --output json --output-path ./lighthouse.json&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-性能预算"><a href="#3-性能预算" class="headerlink" title="3. 性能预算"></a>3. 性能预算</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack 性能预算</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">performance</span>: &#123;</span><br><span class="line">    <span class="attr">hints</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">    <span class="attr">maxEntrypointSize</span>: <span class="number">512000</span>,  <span class="comment">// 入口文件 &lt; 500KB</span></span><br><span class="line">    <span class="attr">maxAssetSize</span>: <span class="number">512000</span>       <span class="comment">// 资源文件 &lt; 500KB</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">analyzerMode</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">      <span class="attr">openAnalyzer</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 speed-measure-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SpeedMeasurePlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;speed-measure-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> smp = <span class="keyword">new</span> <span class="title class_">SpeedMeasurePlugin</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = smp.<span class="title function_">wrap</span>(&#123;</span><br><span class="line">  <span class="comment">// webpack 配置</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="性能优化清单"><a href="#性能优化清单" class="headerlink" title="性能优化清单"></a>性能优化清单</h2><h3 id="加载性能"><a href="#加载性能" class="headerlink" title="加载性能"></a>加载性能</h3><ul>
<li>✅ 启用 Gzip&#x2F;Brotli 压缩</li>
<li>✅ 代码分割和懒加载</li>
<li>✅ Tree Shaking</li>
<li>✅ 图片优化（WebP、响应式图片）</li>
<li>✅ 预加载关键资源</li>
<li>✅ CDN 加速</li>
<li>✅ HTTP 缓存</li>
</ul>
<h3 id="运行时性能"><a href="#运行时性能" class="headerlink" title="运行时性能"></a>运行时性能</h3><ul>
<li>✅ 虚拟列表</li>
<li>✅ 防抖和节流</li>
<li>✅ React.memo 和 useCallback</li>
<li>✅ 避免长任务</li>
<li>✅ 使用 Web Worker</li>
</ul>
<h3 id="渲染性能"><a href="#渲染性能" class="headerlink" title="渲染性能"></a>渲染性能</h3><ul>
<li>✅ GPU 加速动画</li>
<li>✅ 减少 DOM 操作</li>
<li>✅ 图片懒加载</li>
<li>✅ 优化 CSS 选择器</li>
</ul>
<h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><ul>
<li>✅ Core Web Vitals</li>
<li>✅ 性能监控</li>
<li>✅ Lighthouse 定期检查</li>
<li>✅ 性能预算</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>前端性能优化是一个持续的过程，需要从多个维度综合考虑：</p>
<p><strong>关键要点</strong>：</p>
<ol>
<li>🎯 先测量再优化 - 使用性能工具找到瓶颈</li>
<li>📦 优化加载 - 代码分割、资源压缩、CDN</li>
<li>⚡ 提升运行时 - 虚拟化、防抖节流、避免重排</li>
<li>📊 持续监控 - 建立性能预算和监控体系</li>
</ol>
<p><strong>优先级</strong>：</p>
<ol>
<li><strong>高优先级</strong>：LCP &gt; 2.5s, FID &gt; 100ms, CLS &gt; 0.1</li>
<li><strong>中优先级</strong>：FCP、TTI、TBT</li>
<li><strong>低优先级</strong>：自定义业务指标</li>
</ol>
<p>记住：<strong>性能优化没有银弹，要根据实际场景选择合适的优化策略！</strong></p>
<hr>
<p><em>下一篇将介绍前端工程化和构建优化，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>性能优化</category>
      </categories>
      <tags>
        <tag>性能优化</tag>
        <tag>前端开发</tag>
        <tag>Web性能</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub常用命令完全指南：从入门到精通</title>
    <url>/2026/01/20/github-commands-guide/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Git是目前世界上最先进的分布式版本控制系统，而GitHub是基于Git的代码托管平台。掌握Git和GitHub的常用命令是每个开发者的必备技能。</p>
<p>本文将从基础到高级，全面介绍Git和GitHub的常用命令及实战技巧。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># macOS</span></span><br><span class="line">brew install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line"><span class="comment"># 下载安装包：https://git-scm.com/download/win</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux (Ubuntu/Debian)</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>

<h3 id="初始配置"><a href="#初始配置" class="headerlink" title="初始配置"></a>初始配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置用户名</span></span><br><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置邮箱</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your.email@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认分支名</span></span><br><span class="line">git config --global init.defaultBranch main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看配置</span></span><br><span class="line">git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置编辑器</span></span><br><span class="line">git config --global core.editor vim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置差异比较工具</span></span><br><span class="line">git config --global merge.tool vscode</span><br></pre></td></tr></table></figure>

<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><h3 id="仓库初始化"><a href="#仓库初始化" class="headerlink" title="仓库初始化"></a>仓库初始化</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 初始化新仓库</span></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆远程仓库</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/username/repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆到指定目录</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/username/repo.git my-folder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆指定分支</span></span><br><span class="line">git <span class="built_in">clone</span> -b dev https://github.com/username/repo.git</span><br></pre></td></tr></table></figure>

<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前状态</span></span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">git add file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加所有文件到暂存区</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加所有修改的文件（不包括未跟踪的文件）</span></span><br><span class="line">git add -u</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加所有文件（包括删除的文件）</span></span><br><span class="line">git add -A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销暂存区的文件</span></span><br><span class="line">git restore --staged file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 丢弃工作区的修改</span></span><br><span class="line">git restore file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文件</span></span><br><span class="line">git <span class="built_in">rm</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名文件</span></span><br><span class="line">git <span class="built_in">mv</span> old.txt new.txt</span><br></pre></td></tr></table></figure>

<h3 id="提交更改"><a href="#提交更改" class="headerlink" title="提交更改"></a>提交更改</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区的更改</span></span><br><span class="line">git commit -m <span class="string">&quot;commit message&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加并提交（跳过git add）</span></span><br><span class="line">git commit -am <span class="string">&quot;commit message&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改最后一次提交</span></span><br><span class="line">git commit --amend</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改最后一次提交信息</span></span><br><span class="line">git commit --amend -m <span class="string">&quot;new message&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时跳过钩子</span></span><br><span class="line">git commit --no-verify -m <span class="string">&quot;message&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看差异"><a href="#查看差异" class="headerlink" title="查看差异"></a>查看差异</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看工作区和暂存区的差异</span></span><br><span class="line">git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暂存区和上次提交的差异</span></span><br><span class="line">git diff --staged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看工作区和上次提交的差异</span></span><br><span class="line">git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看两个提交之间的差异</span></span><br><span class="line">git diff commit1 commit2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定文件的差异</span></span><br><span class="line">git diff file.txt</span><br></pre></td></tr></table></figure>

<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><h3 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有分支</span></span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看远程分支</span></span><br><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有分支（包括远程）</span></span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新分支</span></span><br><span class="line">git branch feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换分支</span></span><br><span class="line">git checkout feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并切换到新分支</span></span><br><span class="line">git checkout -b feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地分支</span></span><br><span class="line">git branch -d feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除分支</span></span><br><span class="line">git branch -D feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名分支</span></span><br><span class="line">git branch -m old-branch new-branch</span><br></pre></td></tr></table></figure>

<h3 id="分支合并"><a href="#分支合并" class="headerlink" title="分支合并"></a>分支合并</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">git merge feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用快进合并</span></span><br><span class="line">git merge --no-ff feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用squash合并（合并为一个提交）</span></span><br><span class="line">git merge --squash feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变基（将当前分支变基到指定分支）</span></span><br><span class="line">git rebase main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续变基</span></span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过当前提交</span></span><br><span class="line">git rebase --skip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 放弃变基</span></span><br><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure>

<h3 id="分支最佳实践"><a href="#分支最佳实践" class="headerlink" title="分支最佳实践"></a>分支最佳实践</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">主分支结构:</span><br><span class="line">├── main (生产环境)</span><br><span class="line">│   └── 始终保持稳定，可部署</span><br><span class="line">├── develop (开发环境)</span><br><span class="line">│   └── 开发集成分支</span><br><span class="line">└── feature/* (功能分支)</span><br><span class="line">    ├── feature/user-auth</span><br><span class="line">    ├── feature-payment</span><br><span class="line">    └── feature-search</span><br></pre></td></tr></table></figure>

<h2 id="远程操作"><a href="#远程操作" class="headerlink" title="远程操作"></a>远程操作</h2><h3 id="远程仓库管理"><a href="#远程仓库管理" class="headerlink" title="远程仓库管理"></a>远程仓库管理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看远程仓库</span></span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加远程仓库</span></span><br><span class="line">git remote add origin https://github.com/username/repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程仓库</span></span><br><span class="line">git remote remove origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改远程仓库URL</span></span><br><span class="line">git remote set-url origin https://github.com/username/new-repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看远程仓库信息</span></span><br><span class="line">git remote show origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名远程分支</span></span><br><span class="line">git remote rename origin upstream</span><br></pre></td></tr></table></figure>

<h3 id="拉取和推送"><a href="#拉取和推送" class="headerlink" title="拉取和推送"></a>拉取和推送</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拉取远程更改并合并</span></span><br><span class="line">git pull origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取远程更改但不合并</span></span><br><span class="line">git fetch origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取所有远程分支</span></span><br><span class="line">git fetch --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取远程更改并变基</span></span><br><span class="line">git pull --rebase origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送到远程仓库</span></span><br><span class="line">git push origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支</span></span><br><span class="line">git push --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送标签</span></span><br><span class="line">git push --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送并建立上游分支</span></span><br><span class="line">git push -u origin feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制推送（谨慎使用）</span></span><br><span class="line">git push --force origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制推送更安全的方式</span></span><br><span class="line">git push --force-with-lease origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">git push origin --delete feature-branch</span><br></pre></td></tr></table></figure>

<h2 id="日志和查看"><a href="#日志和查看" class="headerlink" title="日志和查看"></a>日志和查看</h2><h3 id="查看提交历史"><a href="#查看提交历史" class="headerlink" title="查看提交历史"></a>查看提交历史</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看提交历史</span></span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看简洁的提交历史</span></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分支图</span></span><br><span class="line">git <span class="built_in">log</span> --graph --oneline --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最近N次提交</span></span><br><span class="line">git <span class="built_in">log</span> -n 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定文件的提交历史</span></span><br><span class="line">git <span class="built_in">log</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看提交统计</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 美化输出</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">&quot;%h - %an, %ar : %s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定作者的提交</span></span><br><span class="line">git <span class="built_in">log</span> --author=<span class="string">&quot;John&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看文件内容"><a href="#查看文件内容" class="headerlink" title="查看文件内容"></a>查看文件内容</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看指定提交的文件内容</span></span><br><span class="line">git show commit_hash:file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看提交详情</span></span><br><span class="line">git show commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某次提交的修改</span></span><br><span class="line">git show HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看文件的每一行是谁修改的</span></span><br><span class="line">git blame file.txt</span><br></pre></td></tr></table></figure>

<h2 id="撤销操作"><a href="#撤销操作" class="headerlink" title="撤销操作"></a>撤销操作</h2><h3 id="撤销更改"><a href="#撤销更改" class="headerlink" title="撤销更改"></a>撤销更改</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 撤销工作区的修改</span></span><br><span class="line">git restore file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销暂存区的修改</span></span><br><span class="line">git restore --staged file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回退到指定提交（保留工作区修改）</span></span><br><span class="line">git reset --soft HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回退到指定提交（撤销暂存区修改）</span></span><br><span class="line">git reset --mixed HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回退到指定提交（撤销工作区和暂存区修改）</span></span><br><span class="line">git reset --hard HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回退到指定提交（危险操作）</span></span><br><span class="line">git reset --hard commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复指定提交的文件</span></span><br><span class="line">git checkout commit_hash -- file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新的提交来撤销指定提交</span></span><br><span class="line">git revert commit_hash</span><br></pre></td></tr></table></figure>

<h3 id="reset-vs-revert"><a href="#reset-vs-revert" class="headerlink" title="reset vs revert"></a>reset vs revert</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># reset - 删除历史（适用于本地）</span></span><br><span class="line">git reset --hard HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># revert - 创建新提交来撤销（适用于公共分支）</span></span><br><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure>

<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><h3 id="标签操作"><a href="#标签操作" class="headerlink" title="标签操作"></a>标签操作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有标签</span></span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建轻量标签</span></span><br><span class="line">git tag v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建附注标签</span></span><br><span class="line">git tag -a v1.0.0 -m <span class="string">&quot;Version 1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给指定提交打标签</span></span><br><span class="line">git tag -a v0.9.0 commit_hash -m <span class="string">&quot;Version 0.9.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看标签信息</span></span><br><span class="line">git show v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地标签</span></span><br><span class="line">git tag -d v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送标签到远程</span></span><br><span class="line">git push origin v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有标签</span></span><br><span class="line">git push origin --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程标签</span></span><br><span class="line">git push origin --delete v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检出标签</span></span><br><span class="line">git checkout v1.0.0</span><br></pre></td></tr></table></figure>

<h2 id="储藏（Stash）"><a href="#储藏（Stash）" class="headerlink" title="储藏（Stash）"></a>储藏（Stash）</h2><h3 id="临时保存工作"><a href="#临时保存工作" class="headerlink" title="临时保存工作"></a>临时保存工作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 储藏当前工作</span></span><br><span class="line">git stash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 储藏并添加说明</span></span><br><span class="line">git stash save <span class="string">&quot;work in progress&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看储藏列表</span></span><br><span class="line">git stash list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用最新的储藏</span></span><br><span class="line">git stash pop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用指定储藏</span></span><br><span class="line">git stash apply stash@&#123;1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除储藏</span></span><br><span class="line">git stash drop stash@&#123;0&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空所有储藏</span></span><br><span class="line">git stash clear</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看储藏内容</span></span><br><span class="line">git stash show -p</span><br></pre></td></tr></table></figure>

<h2 id="实战场景"><a href="#实战场景" class="headerlink" title="实战场景"></a>实战场景</h2><h3 id="场景1：开始新功能开发"><a href="#场景1：开始新功能开发" class="headerlink" title="场景1：开始新功能开发"></a>场景1：开始新功能开发</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 切换到主分支并更新</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建功能分支</span></span><br><span class="line">git checkout -b feature/new-feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 开发并提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;feat: add new feature&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 推送到远程</span></span><br><span class="line">git push -u origin feature/new-feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 创建Pull Request</span></span><br><span class="line"><span class="comment"># 在GitHub网页上操作</span></span><br></pre></td></tr></table></figure>

<h3 id="场景2：解决合并冲突"><a href="#场景2：解决合并冲突" class="headerlink" title="场景2：解决合并冲突"></a>场景2：解决合并冲突</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 拉取最新代码</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 合并功能分支</span></span><br><span class="line">git merge feature/new-feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 如果有冲突，标记冲突文件</span></span><br><span class="line"><span class="comment"># Auto-merging file.txt</span></span><br><span class="line"><span class="comment"># CONFLICT (content): Merge conflict in file.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 手动解决冲突</span></span><br><span class="line"><span class="comment"># 编辑文件，删除冲突标记</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 添加解决后的文件</span></span><br><span class="line">git add file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 完成合并</span></span><br><span class="line">git commit -m <span class="string">&quot;merge: resolve merge conflicts&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="场景3：修改历史提交"><a href="#场景3：修改历史提交" class="headerlink" title="场景3：修改历史提交"></a>场景3：修改历史提交</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 交互式变基修改最近的3次提交</span></span><br><span class="line">git rebase -i HEAD~3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在编辑器中：</span></span><br><span class="line"><span class="comment"># pick -&gt; reword = 修改提交信息</span></span><br><span class="line"><span class="comment"># pick -&gt; edit = 修改提交内容</span></span><br><span class="line"><span class="comment"># pick -&gt; drop = 删除提交</span></span><br><span class="line"><span class="comment"># pick -&gt; squash = 合并到前一个提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存后按提示操作</span></span><br></pre></td></tr></table></figure>

<h3 id="场景4：回滚错误的提交"><a href="#场景4：回滚错误的提交" class="headerlink" title="场景4：回滚错误的提交"></a>场景4：回滚错误的提交</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法1：revert（推荐）</span></span><br><span class="line">git revert bad_commit_hash</span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：reset（仅本地或团队协作）</span></span><br><span class="line">git reset --hard good_commit_hash</span><br><span class="line">git push --force-with-lease</span><br></pre></td></tr></table></figure>

<h3 id="场景5：同步上游仓库"><a href="#场景5：同步上游仓库" class="headerlink" title="场景5：同步上游仓库"></a>场景5：同步上游仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 添加上游仓库</span></span><br><span class="line">git remote add upstream https://github.com/original/repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 拉取上游更改</span></span><br><span class="line">git fetch upstream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 合并上游主分支</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge upstream/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 推送到你的仓库</span></span><br><span class="line">git push origin main</span><br></pre></td></tr></table></figure>

<h2 id="GitHub特定操作"><a href="#GitHub特定操作" class="headerlink" title="GitHub特定操作"></a>GitHub特定操作</h2><h3 id="GitHub-CLI-gh"><a href="#GitHub-CLI-gh" class="headerlink" title="GitHub CLI (gh)"></a>GitHub CLI (gh)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装GitHub CLI</span></span><br><span class="line">brew install gh  <span class="comment"># macOS</span></span><br><span class="line"><span class="comment"># 或从 https://cli.github.com/ 下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 认证</span></span><br><span class="line">gh auth login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建仓库</span></span><br><span class="line">gh repo create my-repo --public</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆仓库</span></span><br><span class="line">gh repo <span class="built_in">clone</span> username/repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Pull Request</span></span><br><span class="line">gh <span class="built_in">pr</span> create --title <span class="string">&quot;Add feature&quot;</span> --body <span class="string">&quot;Description&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PR列表</span></span><br><span class="line">gh <span class="built_in">pr</span> list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并PR</span></span><br><span class="line">gh <span class="built_in">pr</span> merge 123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Issue</span></span><br><span class="line">gh issue create --title <span class="string">&quot;Bug&quot;</span> --body <span class="string">&quot;Description&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Issues</span></span><br><span class="line">gh issue list</span><br></pre></td></tr></table></figure>

<h3 id="gitignore-最佳实践"><a href="#gitignore-最佳实践" class="headerlink" title=".gitignore 最佳实践"></a>.gitignore 最佳实践</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># .gitignore 示例</span><br><span class="line"></span><br><span class="line"># 依赖目录</span><br><span class="line">node_modules/</span><br><span class="line">vendor/</span><br><span class="line"></span><br><span class="line"># 构建输出</span><br><span class="line">dist/</span><br><span class="line">build/</span><br><span class="line">public/</span><br><span class="line"></span><br><span class="line"># 环境变量</span><br><span class="line">.env</span><br><span class="line">.env.local</span><br><span class="line"></span><br><span class="line"># IDE配置</span><br><span class="line">.vscode/</span><br><span class="line">.idea/</span><br><span class="line">*.swp</span><br><span class="line">*.swo</span><br><span class="line"></span><br><span class="line"># 操作系统文件</span><br><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line"></span><br><span class="line"># 日志文件</span><br><span class="line">*.log</span><br><span class="line">npm-debug.log*</span><br><span class="line"></span><br><span class="line"># 临时文件</span><br><span class="line">*.tmp</span><br><span class="line">*.temp</span><br></pre></td></tr></table></figure>

<h3 id="Git别名配置"><a href="#Git别名配置" class="headerlink" title="Git别名配置"></a>Git别名配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置常用别名</span></span><br><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br><span class="line">git config --global alias.unstage <span class="string">&#x27;reset HEAD --&#x27;</span></span><br><span class="line">git config --global alias.last <span class="string">&#x27;log -1 HEAD&#x27;</span></span><br><span class="line">git config --global alias.lg <span class="string">&quot;log --graph --oneline --all&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用别名</span></span><br><span class="line">git co main        <span class="comment"># git checkout main</span></span><br><span class="line">git br             <span class="comment"># git branch</span></span><br><span class="line">git ci -m <span class="string">&quot;msg&quot;</span>    <span class="comment"># git commit -m &quot;msg&quot;</span></span><br><span class="line">git st             <span class="comment"># git status</span></span><br><span class="line">git lg             <span class="comment"># 美化的日志</span></span><br></pre></td></tr></table></figure>

<h2 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h2><h3 id="Cherry-pick（精选提交）"><a href="#Cherry-pick（精选提交）" class="headerlink" title="Cherry-pick（精选提交）"></a>Cherry-pick（精选提交）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将指定提交应用到当前分支</span></span><br><span class="line">git cherry-pick commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用但不自动提交</span></span><br><span class="line">git cherry-pick -n commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用多个提交</span></span><br><span class="line">git cherry-pick commit1 commit2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用一系列提交</span></span><br><span class="line">git cherry-pick commit1..commit2</span><br></pre></td></tr></table></figure>

<h3 id="Bisect（二分查找）"><a href="#Bisect（二分查找）" class="headerlink" title="Bisect（二分查找）"></a>Bisect（二分查找）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 开始二分查找（用于定位引入bug的提交）</span></span><br><span class="line">git bisect start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记当前为坏的提交</span></span><br><span class="line">git bisect bad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记已知的好的提交</span></span><br><span class="line">git bisect good commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Git会自动切换到中间提交</span></span><br><span class="line"><span class="comment"># 测试后标记good或bad</span></span><br><span class="line">git bisect good  <span class="comment"># 或 git bisect bad</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 完成后回到主分支</span></span><br><span class="line">git bisect reset</span><br></pre></td></tr></table></figure>

<h3 id="Worktree（多工作树）"><a href="#Worktree（多工作树）" class="headerlink" title="Worktree（多工作树）"></a>Worktree（多工作树）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建关联的工作树</span></span><br><span class="line">git worktree add ../feature-branch feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有工作树</span></span><br><span class="line">git worktree list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作树</span></span><br><span class="line">git worktree remove ../feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理工作树</span></span><br><span class="line">git worktree prune</span><br></pre></td></tr></table></figure>

<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 清理无效文件</span></span><br><span class="line">git gc --prune=now</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理未跟踪的文件</span></span><br><span class="line">git clean -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理未跟踪的文件和目录</span></span><br><span class="line">git clean -fd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览要删除的文件</span></span><br><span class="line">git clean -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看仓库大小</span></span><br><span class="line">git count-objects -vH</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用浅克隆（只下载最新历史）</span></span><br><span class="line">git <span class="built_in">clone</span> --depth 1 https://github.com/user/repo.git</span><br></pre></td></tr></table></figure>

<h2 id="安全最佳实践"><a href="#安全最佳实践" class="headerlink" title="安全最佳实践"></a>安全最佳实践</h2><h3 id="保护敏感信息"><a href="#保护敏感信息" class="headerlink" title="保护敏感信息"></a>保护敏感信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 从历史中移除敏感文件</span></span><br><span class="line">git filter-branch --force --index-filter \</span><br><span class="line">  <span class="string">&quot;git rm --cached --ignore-unmatch config/secrets.json&quot;</span> \</span><br><span class="line">  --prune-empty --tag-name-filter <span class="built_in">cat</span> -- --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 使用BFG Repo-Cleaner（更快）</span></span><br><span class="line">brew install bfg</span><br><span class="line">bfg --delete-files secrets.json</span><br><span class="line">git reflog expire --expire=now --all</span><br><span class="line">git gc --prune=now --aggressive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 推送清理后的历史</span></span><br><span class="line">git push origin --force --all</span><br><span class="line">git push origin --force --tags</span><br></pre></td></tr></table></figure>

<h3 id="提交信息规范"><a href="#提交信息规范" class="headerlink" title="提交信息规范"></a>提交信息规范</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用约定式提交格式</span></span><br><span class="line">&lt;<span class="built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;footer&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型（type）:</span></span><br><span class="line">feat:     新功能</span><br><span class="line">fix:      修复bug</span><br><span class="line">docs:     文档更新</span><br><span class="line">style:    代码格式（不影响功能）</span><br><span class="line">refactor: 重构</span><br><span class="line">perf:     性能优化</span><br><span class="line"><span class="built_in">test</span>:     测试相关</span><br><span class="line">chore:    构建/工具链相关</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例:</span></span><br><span class="line">feat(auth): add user login feature</span><br><span class="line">fix(api): resolve <span class="built_in">timeout</span> issue</span><br><span class="line">docs(readme): update installation guide</span><br></pre></td></tr></table></figure>

<h2 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Git引用</span></span><br><span class="line">git show-ref</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看HEAD指向</span></span><br><span class="line">git <span class="built_in">log</span> --oneline -n 1 HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分支关系</span></span><br><span class="line">git <span class="built_in">log</span> --graph --decorate --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看未被跟踪的文件</span></span><br><span class="line">git ls-files --others --exclude-standard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找丢失的提交</span></span><br><span class="line">git fsck --lost-found</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复丢失的提交</span></span><br><span class="line">git reflog</span><br><span class="line">git checkout commit_hash</span><br></pre></td></tr></table></figure>

<h2 id="常见问题解决"><a href="#常见问题解决" class="headerlink" title="常见问题解决"></a>常见问题解决</h2><h3 id="问题1：提交了错误的文件"><a href="#问题1：提交了错误的文件" class="headerlink" title="问题1：提交了错误的文件"></a>问题1：提交了错误的文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 撤销最后一次提交但保留更改</span></span><br><span class="line">git reset --soft HEAD~1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后重新提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;correct message&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="问题2：忘记推送到远程"><a href="#问题2：忘记推送到远程" class="headerlink" title="问题2：忘记推送到远程"></a>问题2：忘记推送到远程</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 直接推送</span></span><br><span class="line">git push origin main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果被别人推送了新的提交</span></span><br><span class="line">git pull --rebase origin main</span><br><span class="line">git push origin main</span><br></pre></td></tr></table></figure>

<h3 id="问题3：合并后后悔了"><a href="#问题3：合并后后悔了" class="headerlink" title="问题3：合并后后悔了"></a>问题3：合并后后悔了</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 回到合并前</span></span><br><span class="line">git merge --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用reflog</span></span><br><span class="line">git reflog</span><br><span class="line">git reset --hard HEAD@&#123;N&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Git和GitHub是现代软件开发不可或缺的工具。掌握这些命令不仅能提高开发效率，还能更好地管理代码版本和协作开发。</p>
<p><strong>学习路径建议：</strong></p>
<ol>
<li>熟练掌握基础命令（add, commit, push, pull）</li>
<li>理解分支管理和合并策略</li>
<li>学习处理冲突和回退操作</li>
<li>掌握高级技巧和最佳实践</li>
<li>使用GitHub协作功能（PR, Issue, Actions）</li>
</ol>
<p><strong>参考资源：</strong></p>
<ul>
<li><a href="https://git-scm.com/doc">Git官方文档</a></li>
<li><a href="https://docs.github.com/">GitHub官方文档</a></li>
<li><a href="https://skills.github.com/">GitHub Skills</a></li>
<li><a href="https://githeroes.com/">Git Hero</a></li>
</ul>
<p>记住：<strong>熟能生巧</strong>，多使用这些命令，自然会越来越熟练！</p>
<hr>
<p><em>下一篇文章将介绍Git Flow工作流和团队协作最佳实践，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
        <tag>版本控制</tag>
        <tag>开发工具</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript深入理解：闭包、原型链与异步编程</title>
    <url>/2026/01/20/javascript-advanced-concepts/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>JavaScript 作为一门动态语言，有一些独特而强大的特性。深入理解闭包、原型链和异步编程，是从会用 JavaScript 到精通 JavaScript 的必经之路。本文将深入剖析这些核心概念。</p>
<h2 id="一、闭包（Closure）"><a href="#一、闭包（Closure）" class="headerlink" title="一、闭包（Closure）"></a>一、闭包（Closure）</h2><h3 id="什么是闭包？"><a href="#什么是闭包？" class="headerlink" title="什么是闭包？"></a>什么是闭包？</h3><p>闭包是指函数能够记住并访问其词法作用域，即使函数在其词法作用域之外执行。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础闭包示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;  <span class="comment">// 私有变量</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      count++;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      count--;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">increment</span>()); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">increment</span>()); <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getCount</span>());  <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="property">count</span>);       <span class="comment">// undefined - 无法直接访问</span></span><br></pre></td></tr></table></figure>

<h3 id="闭包的原理"><a href="#闭包的原理" class="headerlink" title="闭包的原理"></a>闭包的原理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">outerFunction</span>(<span class="params">outerVar</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">innerFunction</span>(<span class="params">innerVar</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;outerVar:&#x27;</span>, outerVar);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;innerVar:&#x27;</span>, innerVar);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myClosure = <span class="title function_">outerFunction</span>(<span class="string">&#x27;outside&#x27;</span>);</span><br><span class="line"><span class="title function_">myClosure</span>(<span class="string">&#x27;inside&#x27;</span>); <span class="comment">// 输出: outerVar: outside, innerVar: inside</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包的作用域链</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scopeChain</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">level1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">level2</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> c = <span class="number">3</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c); <span class="comment">// 1 2 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> level2;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">level1</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> closure = <span class="title function_">scopeChain</span>();</span><br><span class="line"><span class="title function_">closure</span>(); <span class="comment">// 仍然可以访问 a, b, c</span></span><br></pre></td></tr></table></figure>

<h3 id="闭包的常见应用场景"><a href="#闭包的常见应用场景" class="headerlink" title="闭包的常见应用场景"></a>闭包的常见应用场景</h3><h4 id="1-数据私有化"><a href="#1-数据私有化" class="headerlink" title="1. 数据私有化"></a>1. 数据私有化</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createUser</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _name = name;  <span class="comment">// 私有变量</span></span><br><span class="line">  <span class="keyword">let</span> _age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> _age;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">setAge</span>(<span class="params">age</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (age &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        _age = age;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;_name&#125;</span>, <span class="subst">$&#123;_age&#125;</span> years old`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="title function_">createUser</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line">user.<span class="title function_">greet</span>();           <span class="comment">// Hello, I&#x27;m Alice, 0 years old</span></span><br><span class="line">user.<span class="title function_">setAge</span>(<span class="number">25</span>);</span><br><span class="line">user.<span class="title function_">greet</span>();           <span class="comment">// Hello, I&#x27;m Alice, 25 years old</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">_name</span>); <span class="comment">// undefined - 无法直接访问</span></span><br></pre></td></tr></table></figure>

<h4 id="2-函数柯里化（Currying）"><a href="#2-函数柯里化（Currying）" class="headerlink" title="2. 函数柯里化（Currying）"></a>2. 函数柯里化（Currying）</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= fn.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...moreArgs</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args.<span class="title function_">concat</span>(moreArgs));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curriedAdd = <span class="title function_">curry</span>(add);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curriedAdd</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>));    <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curriedAdd</span>(<span class="number">1</span>, <span class="number">2</span>)(<span class="number">3</span>));    <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curriedAdd</span>(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>));    <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curriedAdd</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));    <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际应用：配置复用</span></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="title function_">curry</span>(<span class="function">(<span class="params">baseUrl, endpoint, params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;baseUrl&#125;</span><span class="subst">$&#123;endpoint&#125;</span>`</span>, params);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> githubFetch = <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.github.com&#x27;</span>);</span><br><span class="line"><span class="title function_">githubFetch</span>(<span class="string">&#x27;/users&#x27;</span>, &#123; <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span> &#125;);</span><br><span class="line"><span class="title function_">githubFetch</span>(<span class="string">&#x27;/repos&#x27;</span>, &#123; <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-防抖和节流"><a href="#3-防抖和节流" class="headerlink" title="3. 防抖和节流"></a>3. 防抖和节流</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 防抖</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">executedFunction</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">later</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      timeout = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (!immediate) func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> callNow = immediate &amp;&amp; !timeout;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="built_in">setTimeout</span>(later, wait);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callNow) func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, limit</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> inThrottle;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!inThrottle) &#123;</span><br><span class="line">      func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      inThrottle = <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> inThrottle = <span class="literal">false</span>, limit);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> debouncedSearch = <span class="title function_">debounce</span>(<span class="function">(<span class="params">query</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;搜索:&#x27;</span>, query);</span><br><span class="line">&#125;, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> throttledScroll = <span class="title function_">throttle</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;滚动位置:&#x27;</span>, <span class="variable language_">window</span>.<span class="property">scrollY</span>);</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-模块模式"><a href="#4-模块模式" class="headerlink" title="4. 模块模式"></a>4. 模块模式</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myModule = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 私有变量和函数</span></span><br><span class="line">  <span class="keyword">let</span> privateVar = <span class="string">&#x27;private&#x27;</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">privateFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;私有函数&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 公共API</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">publicMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">privateFunc</span>();</span><br><span class="line">      <span class="keyword">return</span> privateVar;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">publicVar</span>: <span class="string">&#x27;public&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myModule.<span class="title function_">publicMethod</span>()); <span class="comment">// 私有函数 \n private</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myModule.<span class="property">publicVar</span>);       <span class="comment">// public</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myModule.<span class="property">privateVar</span>);     <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="闭包的内存问题"><a href="#闭包的内存问题" class="headerlink" title="闭包的内存问题"></a>闭包的内存问题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ⚠️ 潜在的内存泄漏</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElements</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getArr</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> elements = <span class="title function_">createElements</span>();</span><br><span class="line"><span class="comment">// arr 数组会一直存在于内存中，直到 elements 被销毁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案：及时释放引用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElements</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getArr</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr.<span class="title function_">slice</span>();  <span class="comment">// 返回副本</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 清理大数组</span></span><br><span class="line">      arr.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> elements = <span class="title function_">createElements</span>();</span><br><span class="line"><span class="keyword">const</span> data = elements.<span class="title function_">getArr</span>();</span><br><span class="line">elements.<span class="title function_">destroy</span>();  <span class="comment">// 手动释放内存</span></span><br><span class="line">elements = <span class="literal">null</span>;     <span class="comment">// 解除引用</span></span><br></pre></td></tr></table></figure>

<h3 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 面试题1：循环中的闭包</span></span><br><span class="line"><span class="comment">// ❌ 错误写法</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(i), <span class="number">100</span>); <span class="comment">// 输出: 3, 3, 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案1：使用 let</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(i), <span class="number">100</span>); <span class="comment">// 输出: 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案2：使用闭包</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span>(<span class="params">j</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(j), <span class="number">100</span>); <span class="comment">// 输出: 0, 1, 2</span></span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案3：使用 bind</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, i), <span class="number">100</span>); <span class="comment">// 输出: 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 面试题2：实现单例</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Singleton</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> instance;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Singleton&#x27;</span>,</span><br><span class="line">      <span class="title function_">method</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Singleton method&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">        instance = <span class="title function_">createInstance</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance1 = <span class="title class_">Singleton</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">const</span> instance2 = <span class="title class_">Singleton</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1 === instance2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="二、原型链（Prototype-Chain）"><a href="#二、原型链（Prototype-Chain）" class="headerlink" title="二、原型链（Prototype Chain）"></a>二、原型链（Prototype Chain）</h2><h3 id="理解原型"><a href="#理解原型" class="headerlink" title="理解原型"></a>理解原型</h3><p>JavaScript 没有传统的类继承，而是使用原型链实现继承。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原型链示例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型链关系</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);             <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span>);              <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性查找过程</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);      <span class="comment">// &#x27;Alice&#x27; - 从实例找到</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">sayHello</span>);  <span class="comment">// Function - 从原型找到</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">toString</span>);  <span class="comment">// Function - 从 Object.prototype 找到</span></span><br></pre></td></tr></table></figure>

<h3 id="原型链示意图"><a href="#原型链示意图" class="headerlink" title="原型链示意图"></a>原型链示意图</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">person (实例)</span><br><span class="line">  ↓ __proto__</span><br><span class="line">Person.prototype</span><br><span class="line">  ↓ __proto__</span><br><span class="line">Object.prototype</span><br><span class="line">  ↓ __proto__</span><br><span class="line">null</span><br></pre></td></tr></table></figure>

<h3 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 构造函数继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is eating`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, breed</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);  <span class="comment">// 调用父类构造函数</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">breed</span> = breed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置原型链</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Dog</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bark</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is barking`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Buddy&#x27;</span>, <span class="string">&#x27;Golden Retriever&#x27;</span>);</span><br><span class="line">dog.<span class="title function_">eat</span>();   <span class="comment">// Buddy is eating</span></span><br><span class="line">dog.<span class="title function_">bark</span>();  <span class="comment">// Buddy is barking</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ES6 class 继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is eating`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, breed</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);  <span class="comment">// 调用父类构造函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breed</span> = breed;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">bark</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is barking`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Buddy&#x27;</span>, <span class="string">&#x27;Golden Retriever&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="原型方法-vs-实例方法"><a href="#原型方法-vs-实例方法" class="headerlink" title="原型方法 vs 实例方法"></a>原型方法 vs 实例方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 低效：每次创建实例都创建新方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;  <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">sayHello</span> === person2.<span class="property">sayHello</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 高效：方法在原型上共享</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;  <span class="comment">// 原型方法</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">sayHello</span> === person2.<span class="property">sayHello</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-create-实现"><a href="#Object-create-实现" class="headerlink" title="Object.create 实现"></a>Object.create 实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简化版 Object.create</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">objectCreate</span>(<span class="params">proto</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">  <span class="title function_">sayHello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> anotherPerson = <span class="title function_">objectCreate</span>(person);</span><br><span class="line">anotherPerson.<span class="property">name</span> = <span class="string">&#x27;Bob&#x27;</span>;</span><br><span class="line">anotherPerson.<span class="title function_">sayHello</span>(); <span class="comment">// Hello, I&#x27;m Bob</span></span><br></pre></td></tr></table></figure>

<h3 id="原型链实用技巧"><a href="#原型链实用技巧" class="headerlink" title="原型链实用技巧"></a>原型链实用技巧</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 方法扩展</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">first</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">last</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">first</span>(); <span class="comment">// 1</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">last</span>();  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 检测原型关系</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>);  <span class="comment">// instanceof</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(instance));  <span class="comment">// isPrototypeOf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 获取对象原型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(instance));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(instance) === <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 设置对象原型</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123; <span class="title function_">protoMethod</span>(<span class="params"></span>) &#123;&#125; &#125;);</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(obj, &#123; <span class="title function_">newMethod</span>(<span class="params"></span>) &#123;&#125; &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="三、异步编程"><a href="#三、异步编程" class="headerlink" title="三、异步编程"></a>三、异步编程</h2><h3 id="回调函数（Callback）"><a href="#回调函数（Callback）" class="headerlink" title="回调函数（Callback）"></a>回调函数（Callback）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;;</span><br><span class="line">    <span class="title function_">callback</span>(data);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到数据:&#x27;</span>, data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调地狱（Callback Hell）</span></span><br><span class="line"><span class="title function_">getData</span>(<span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="title function_">getMoreData</span>(a, <span class="keyword">function</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    <span class="title function_">getMoreData</span>(b, <span class="keyword">function</span>(<span class="params">c</span>) &#123;</span><br><span class="line">      <span class="title function_">getMoreData</span>(c, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="comment">// 嵌套太深！</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础 Promise</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> success = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">if</span> (success) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;请求失败&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 then/catch</span></span><br><span class="line"><span class="title function_">fetchData</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据:&#x27;</span>, data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;错误:&#x27;</span>, error))</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;完成&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise 链式调用</span></span><br><span class="line"><span class="title function_">fetchData</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;第一步:&#x27;</span>, data);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetchMoreData</span>(data.<span class="property">id</span>);  <span class="comment">// 返回新的 Promise</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">moreData</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;第二步:&#x27;</span>, moreData);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetchEvenMoreData</span>(moreData.<span class="property">id</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">evenMoreData</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;第三步:&#x27;</span>, evenMoreData);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;任何步骤出错:&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Promise-实用方法"><a href="#Promise-实用方法" class="headerlink" title="Promise 实用方法"></a>Promise 实用方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Promise.all - 所有成功才算成功</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="title function_">fetchUser</span>(<span class="number">1</span>),</span><br><span class="line">  <span class="title function_">fetchPosts</span>(<span class="number">1</span>),</span><br><span class="line">  <span class="title function_">fetchComments</span>(<span class="number">1</span>)</span><br><span class="line">])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">[user, posts, comments]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;所有数据:&#x27;</span>, &#123; user, posts, comments &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;任何一个失败:&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise.race - 谁快用谁</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">  <span class="title function_">fetchFromServer1</span>(),</span><br><span class="line">  <span class="title function_">fetchFromServer2</span>()</span><br><span class="line">])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;最快返回的结果:&#x27;</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise.allSettled - 返回所有结果（无论成功失败）</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([</span><br><span class="line">  <span class="title function_">fetchTask1</span>(),</span><br><span class="line">  <span class="title function_">fetchTask2</span>(),</span><br><span class="line">  <span class="title function_">fetchTask3</span>()</span><br><span class="line">])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">forEach</span>(<span class="function">(<span class="params">result, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`任务<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>成功:`</span>, result.<span class="property">value</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`任务<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>失败:`</span>, result.<span class="property">reason</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise.any - 第一个成功的结果</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">any</span>([</span><br><span class="line">  <span class="title function_">fetchFromMirror1</span>(),</span><br><span class="line">  <span class="title function_">fetchFromMirror2</span>(),</span><br><span class="line">  <span class="title function_">fetchFromMirror3</span>()</span><br><span class="line">])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;第一个成功的:&#x27;</span>, data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;全部失败:&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="async-await"><a href="#async-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// async/await 让异步代码看起来像同步代码</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchAllData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title function_">fetchUser</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户:&#x27;</span>, user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> posts = <span class="keyword">await</span> <span class="title function_">fetchPosts</span>(user.<span class="property">id</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文章:&#x27;</span>, posts);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> comments = <span class="keyword">await</span> <span class="title function_">fetchComments</span>(posts[<span class="number">0</span>].<span class="property">id</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;评论:&#x27;</span>, comments);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; user, posts, comments &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;错误:&#x27;</span>, error);</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchAllDataParallel</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [user, posts, comments] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">      <span class="title function_">fetchUser</span>(<span class="number">1</span>),</span><br><span class="line">      <span class="title function_">fetchPosts</span>(<span class="number">1</span>),</span><br><span class="line">      <span class="title function_">fetchComments</span>(<span class="number">1</span>)</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; user, posts, comments &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;错误:&#x27;</span>, error);</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顺序执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">processItems</span>(<span class="params">items</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">processItem</span>(item);</span><br><span class="line">    results.<span class="title function_">push</span>(result);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行执行（批量）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">processItems</span>(<span class="params">items, batchSize = <span class="number">5</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; items.<span class="property">length</span>; i += batchSize) &#123;</span><br><span class="line">    <span class="keyword">const</span> batch = items.<span class="title function_">slice</span>(i, i + batchSize);</span><br><span class="line">    <span class="keyword">const</span> batchResults = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">      batch.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">processItem</span>(item))</span><br><span class="line">    );</span><br><span class="line">    results.<span class="title function_">push</span>(...batchResults);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="事件循环（Event-Loop）"><a href="#事件循环（Event-Loop）" class="headerlink" title="事件循环（Event Loop）"></a>事件循环（Event Loop）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 理解事件循环</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1. 开始&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2. setTimeout (宏任务)&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3. Promise (微任务)&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4. 结束&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出顺序：</span></span><br><span class="line"><span class="comment">// 1. 开始</span></span><br><span class="line"><span class="comment">// 4. 结束</span></span><br><span class="line"><span class="comment">// 3. Promise (微任务)</span></span><br><span class="line"><span class="comment">// 2. setTimeout (宏任务)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整示例</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout1&#x27;</span>);</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout2&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;end&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// start</span></span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// promise2</span></span><br><span class="line"><span class="comment">// timeout1</span></span><br><span class="line"><span class="comment">// promise1</span></span><br><span class="line"><span class="comment">// timeout2</span></span><br></pre></td></tr></table></figure>

<h3 id="实战：串行和并行控制"><a href="#实战：串行和并行控制" class="headerlink" title="实战：串行和并行控制"></a>实战：串行和并行控制</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 串行执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">series</span>(<span class="params">tasks</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> task <span class="keyword">of</span> tasks) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">task</span>();</span><br><span class="line">    results.<span class="title function_">push</span>(result);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">parallel</span>(<span class="params">tasks</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(tasks.<span class="title function_">map</span>(<span class="function"><span class="params">task</span> =&gt;</span> <span class="title function_">task</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制并发数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">parallelLimit</span>(<span class="params">tasks, limit = <span class="number">2</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">const</span> executing = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> task <span class="keyword">of</span> tasks) &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="title function_">task</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      executing.<span class="title function_">splice</span>(executing.<span class="title function_">indexOf</span>(promise), <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    results.<span class="title function_">push</span>(promise);</span><br><span class="line">    executing.<span class="title function_">push</span>(promise);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executing.<span class="property">length</span> &gt;= limit) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>(executing);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(results);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> tasks = [</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">delay</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="string">&#x27;Task 1&#x27;</span>),</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">delay</span>(<span class="number">2000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="string">&#x27;Task 2&#x27;</span>),</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">delay</span>(<span class="number">1500</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="string">&#x27;Task 3&#x27;</span>),</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">delay</span>(<span class="number">800</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="string">&#x27;Task 4&#x27;</span>),</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">delay</span>(<span class="number">1200</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="string">&#x27;Task 5&#x27;</span>),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">parallelLimit</span>(tasks, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 最多同时执行2个任务</span></span><br></pre></td></tr></table></figure>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// try-catch 捕获错误</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleRequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>();</span><br><span class="line">    <span class="keyword">const</span> processed = <span class="keyword">await</span> <span class="title function_">processData</span>(data);</span><br><span class="line">    <span class="keyword">return</span> processed;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败:&#x27;</span>, error);</span><br><span class="line">    <span class="comment">// 可以选择：</span></span><br><span class="line">    <span class="comment">// 1. 返回默认值</span></span><br><span class="line">    <span class="comment">// return null;</span></span><br><span class="line">    <span class="comment">// 2. 重试</span></span><br><span class="line">    <span class="comment">// return retryRequest();</span></span><br><span class="line">    <span class="comment">// 3. 向上抛出</span></span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局错误处理</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;unhandledrejection&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;未处理的 Promise 拒绝:&#x27;</span>, event.<span class="property">reason</span>);</span><br><span class="line">  event.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止默认处理</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高级：重试机制</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">retry</span>(<span class="params">fn, options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    times = <span class="number">3</span>,</span><br><span class="line">    delay = <span class="number">1000</span>,</span><br><span class="line">    backoff = <span class="number">2</span></span><br><span class="line">  &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> lastError;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; times; i++) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      lastError = error;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; times - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> waitTime = delay * <span class="title class_">Math</span>.<span class="title function_">pow</span>(backoff, i);</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, waitTime));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> lastError;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">retry</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">fetchData</span>(),</span><br><span class="line">  &#123; <span class="attr">times</span>: <span class="number">3</span>, <span class="attr">delay</span>: <span class="number">1000</span>, <span class="attr">backoff</span>: <span class="number">2</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="闭包要点"><a href="#闭包要点" class="headerlink" title="闭包要点"></a>闭包要点</h3><ul>
<li>✅ 函数能够访问其词法作用域</li>
<li>✅ 用于数据私有化、函数柯里化、模块模式</li>
<li>⚠️ 注意内存泄漏问题</li>
</ul>
<h3 id="原型链要点"><a href="#原型链要点" class="headerlink" title="原型链要点"></a>原型链要点</h3><ul>
<li>✅ JavaScript 使用原型链实现继承</li>
<li>✅ <code>__proto__</code> 指向原型对象</li>
<li>✅ 原型方法比实例方法更高效</li>
</ul>
<h3 id="异步编程要点"><a href="#异步编程要点" class="headerlink" title="异步编程要点"></a>异步编程要点</h3><ul>
<li>✅ 回调 → Promise → async&#x2F;await</li>
<li>✅ 理解事件循环和宏任务&#x2F;微任务</li>
<li>✅ 合理使用并行和串行执行</li>
</ul>
<p><strong>学习建议</strong>：</p>
<ol>
<li>多写代码实践这些概念</li>
<li>阅读优秀开源代码</li>
<li>做项目巩固知识</li>
</ol>
<hr>
<p><em>下一篇将深入讲解 Vue3 组合式 API 和响应式原理，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>JavaScript</tag>
        <tag>闭包</tag>
        <tag>原型链</tag>
        <tag>异步编程</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScript完全指南：从基础到高级类型系统</title>
    <url>/2026/01/21/typescript-advanced-guide/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>TypeScript 为 JavaScript 添加了强大的类型系统，让代码更健壮、更易维护。本文将深入讲解 TypeScript 的核心概念，从基础类型到高级特性。</p>
<h2 id="一、基础类型"><a href="#一、基础类型" class="headerlink" title="一、基础类型"></a>一、基础类型</h2><h3 id="基本类型注解"><a href="#基本类型注解" class="headerlink" title="基本类型注解"></a>基本类型注解</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">username</span>: <span class="built_in">string</span> = <span class="string">&#x27;Alice&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">isActive</span>: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">nothing</span>: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">notDefined</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">numbers</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strings</span>: <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组（固定长度和类型）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">user</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>];</span><br><span class="line">user[<span class="number">0</span>]; <span class="comment">// &#x27;Alice&#x27;</span></span><br><span class="line">user[<span class="number">1</span>]; <span class="comment">// 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">  <span class="title class_">Up</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="title class_">Down</span>,</span><br><span class="line">  <span class="title class_">Left</span>,</span><br><span class="line">  <span class="title class_">Right</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">dir</span>: <span class="title class_">Direction</span> = <span class="title class_">Direction</span>.<span class="property">Up</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">LogLevel</span> &#123;</span><br><span class="line">  <span class="variable constant_">INFO</span> = <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">WARN</span> = <span class="string">&#x27;WARN&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">ERROR</span> = <span class="string">&#x27;ERROR&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// any - 任意类型（尽量避免）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">anything</span>: <span class="built_in">any</span> = <span class="number">42</span>;</span><br><span class="line">anything = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">anything = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unknown - 类型安全的 any</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">value</span>: <span class="built_in">unknown</span> = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value * <span class="number">2</span>); <span class="comment">// ✅ TypeScript 知道它是 number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// void - 无返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// never - 永不返回</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// object - 非原始类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>: <span class="built_in">object</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">better</span>: &#123; <span class="attr">name</span>: <span class="built_in">string</span> &#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TypeScript 会自动推断类型</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// 推断为 number</span></span><br><span class="line">count = <span class="string">&#x27;hello&#x27;</span>; <span class="comment">// ❌ 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数返回类型推断</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"><span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b; <span class="comment">// 推断返回类型为 number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最佳通用类型</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="literal">null</span>]; <span class="comment">// 推断为 (number | null)[]</span></span><br></pre></td></tr></table></figure>

<h2 id="二、对象类型"><a href="#二、对象类型" class="headerlink" title="二、对象类型"></a>二、对象类型</h2><h3 id="接口（Interface）"><a href="#接口（Interface）" class="headerlink" title="接口（Interface）"></a>接口（Interface）</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">email</span>?: <span class="built_in">string</span>; <span class="comment">// 可选属性</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">number</span>; <span class="comment">// 只读属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// user.id = 2; // ❌ 错误：只读</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SearchFunc</span> &#123;</span><br><span class="line">  (<span class="attr">source</span>: <span class="built_in">string</span>, <span class="attr">subString</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">mySearch</span>: <span class="title class_">SearchFunc</span> = <span class="keyword">function</span>(<span class="params">src, sub</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> src.<span class="title function_">includes</span>(sub);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 索引签名</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StringArray</span> &#123;</span><br><span class="line">  [<span class="attr">index</span>: <span class="built_in">number</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">myArray</span>: <span class="title class_">StringArray</span> = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StringDictionary</span> &#123;</span><br><span class="line">  [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">myDict</span>: <span class="title class_">StringDictionary</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="类型别名（Type-Alias）"><a href="#类型别名（Type-Alias）" class="headerlink" title="类型别名（Type Alias）"></a>类型别名（Type Alias）</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础类型别名</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">ID</span> = <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserId</span> = <span class="variable constant_">ID</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ProductId</span> = <span class="variable constant_">ID</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Status</span> = <span class="string">&#x27;pending&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleStatus</span>(<span class="params"><span class="attr">status</span>: <span class="title class_">Status</span></span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pending&#x27;</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;error&#x27;</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交叉类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Employee</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">employeeId</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Manager</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">department</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EmployeeManager</span> = <span class="title class_">Employee</span> &amp; <span class="title class_">Manager</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: <span class="title class_">EmployeeManager</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">  <span class="attr">employeeId</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="attr">department</span>: <span class="string">&#x27;Engineering&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">AsyncReturnType</span>&lt;T <span class="title function_">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&gt;</span><br><span class="line">  = T <span class="title function_">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; <span class="title class_">Promise</span>&lt;infer R&gt; ? R : <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NonNullable</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="literal">null</span> | <span class="literal">undefined</span> ? <span class="built_in">never</span> : T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">NonNullable</span>&lt;<span class="built_in">string</span> | <span class="literal">null</span>&gt;; <span class="comment">// string</span></span><br></pre></td></tr></table></figure>

<h3 id="类类型"><a href="#类类型" class="headerlink" title="类类型"></a>类类型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类实现接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ClockInterface</span> &#123;</span><br><span class="line">  <span class="attr">currentTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">  <span class="title function_">setTime</span>(<span class="attr">d</span>: <span class="title class_">Date</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="keyword">implements</span> <span class="title class_">ClockInterface</span> &#123;</span><br><span class="line">  <span class="attr">currentTime</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setTime</span>(<span class="params"><span class="attr">d</span>: <span class="title class_">Date</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentTime</span> = d;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问修饰符</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>;      <span class="comment">// 公开（默认）</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">age</span>: <span class="built_in">number</span>;      <span class="comment">// 私有</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">email</span>: <span class="built_in">string</span>;  <span class="comment">// 受保护</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">number</span>;      <span class="comment">// 只读</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span>, <span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">getAge</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">makeSound</span>(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">move</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Moving...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">makeSound</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Woof!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类作为接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Point3</span>d <span class="keyword">extends</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">z</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、泛型（Generics）"><a href="#三、泛型（Generics）" class="headerlink" title="三、泛型（Generics）"></a>三、泛型（Generics）</h2><h3 id="基础泛型"><a href="#基础泛型" class="headerlink" title="基础泛型"></a>基础泛型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型函数</span></span><br><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> num = identity&lt;<span class="built_in">number</span>&gt;(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">const</span> str = <span class="title function_">identity</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型推断</span></span><br><span class="line"><span class="keyword">const</span> num = <span class="title function_">identity</span>(<span class="number">42</span>); <span class="comment">// 推断 T 为 number</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="title function_">identity</span>(<span class="string">&#x27;hello&#x27;</span>); <span class="comment">// 推断 T 为 string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">value</span>: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">box</span>: <span class="title class_">Box</span>&lt;<span class="built_in">number</span>&gt; = &#123; <span class="attr">value</span>: <span class="number">42</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GenericNumber</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">zeroValue</span>: T;</span><br><span class="line">  <span class="attr">add</span>: <span class="function">(<span class="params"><span class="attr">x</span>: T, <span class="attr">y</span>: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myGenericNumber = <span class="keyword">new</span> <span class="title class_">GenericNumber</span>&lt;<span class="built_in">number</span>&gt;();</span><br><span class="line">myGenericNumber.<span class="property">zeroValue</span> = <span class="number">0</span>;</span><br><span class="line">myGenericNumber.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="泛型约束"><a href="#泛型约束" class="headerlink" title="泛型约束"></a>泛型约束</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 约束 T 必须有 length 属性</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Lengthwise</span> &#123;</span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> logLength&lt;T <span class="keyword">extends</span> <span class="title class_">Lengthwise</span>&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="property">length</span>);</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">logLength</span>(&#123; <span class="attr">length</span>: <span class="number">10</span>, <span class="attr">value</span>: <span class="string">&#x27;hello&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 约束 T 必须是 U 的子类型</span></span><br><span class="line"><span class="keyword">function</span> getProperty&lt;T, K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">key</span>: K) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> name = <span class="title function_">getProperty</span>(user, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// string</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="title function_">getProperty</span>(user, <span class="string">&#x27;age&#x27;</span>); <span class="comment">// number</span></span><br><span class="line"><span class="comment">// const invalid = getProperty(user, &#x27;email&#x27;); // ❌ 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在约束中使用类型参数</span></span><br><span class="line"><span class="keyword">function</span> getOwnProperty&lt;T, K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">key</span>: K) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高级泛型"><a href="#高级泛型" class="headerlink" title="高级泛型"></a>高级泛型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型默认类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FormData</span>&lt;T = <span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">textData</span>: <span class="title class_">FormData</span> = &#123; <span class="attr">data</span>: <span class="string">&#x27;hello&#x27;</span>, <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">numberData</span>: <span class="title class_">FormData</span>&lt;<span class="built_in">number</span>&gt; = &#123; <span class="attr">data</span>: <span class="number">42</span>, <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NonNullable</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="literal">null</span> | <span class="literal">undefined</span> ? <span class="built_in">never</span> : T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TypeName</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">  ? <span class="string">&#x27;string&#x27;</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="built_in">number</span></span><br><span class="line">  ? <span class="string">&#x27;number&#x27;</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="built_in">boolean</span></span><br><span class="line">  ? <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="literal">undefined</span></span><br><span class="line">  ? <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="title class_">Function</span></span><br><span class="line">  ? <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  : <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T0</span> = <span class="title class_">TypeName</span>&lt;<span class="built_in">string</span>&gt;; <span class="comment">// &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T1</span> = <span class="title class_">TypeName</span>&lt;<span class="built_in">string</span>[]&gt;; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 映射类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Required</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReadonlyUser</span> = <span class="title class_">Readonly</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PartialUser</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件映射类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Getters</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> <span class="string">`get<span class="subst">$&#123;Capitalize&lt;P &amp; <span class="built_in">string</span>&gt;&#125;</span>`</span>]: <span class="function">() =&gt;</span> T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LazyPerson</span> = <span class="title class_">Getters</span>&lt;<span class="title class_">Person</span>&gt;;</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   getName: () =&gt; string;</span></span><br><span class="line"><span class="comment">//   getAge: () =&gt; number;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、工具类型"><a href="#四、工具类型" class="headerlink" title="四、工具类型"></a>四、工具类型</h2><h3 id="内置工具类型"><a href="#内置工具类型" class="headerlink" title="内置工具类型"></a>内置工具类型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Partial&lt;T&gt; - 所有属性变为可选</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PartialUser</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"><span class="comment">// &#123; id?: number; name?: string; email?: string; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Required&lt;T&gt; - 所有属性变为必需</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">RequiredUser</span> = <span class="title class_">Required</span>&lt;<span class="title class_">PartialUser</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Readonly&lt;T&gt; - 所有属性变为只读</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReadonlyUser</span> = <span class="title class_">Readonly</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Record&lt;K, T&gt; - 构建对象类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PageInfo</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Page</span> = <span class="string">&#x27;home&#x27;</span> | <span class="string">&#x27;about&#x27;</span> | <span class="string">&#x27;contact&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">nav</span>: <span class="title class_">Record</span>&lt;<span class="title class_">Page</span>, <span class="title class_">PageInfo</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">home</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;Home&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">about</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;About&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">contact</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;Contact&#x27;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pick&lt;T, K&gt; - 选择部分属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserPreview</span> = <span class="title class_">Pick</span>&lt;<span class="title class_">User</span>, <span class="string">&#x27;id&#x27;</span> | <span class="string">&#x27;name&#x27;</span>&gt;;</span><br><span class="line"><span class="comment">// &#123; id: number; name: string; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Omit&lt;T, K&gt; - 排除部分属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserWithoutEmail</span> = <span class="title class_">Omit</span>&lt;<span class="title class_">User</span>, <span class="string">&#x27;email&#x27;</span>&gt;;</span><br><span class="line"><span class="comment">// &#123; id: number; name: string; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exclude&lt;T, U&gt; - 从 T 中排除可赋值给 U 的类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T0</span> = <span class="title class_">Exclude</span>&lt;<span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>&gt;; <span class="comment">// &#x27;b&#x27; | &#x27;c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Extract&lt;T, U&gt; - 提取 T 中可赋值给 U 的类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T1</span> = <span class="title class_">Extract</span>&lt;<span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;f&#x27;</span>&gt;; <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NonNullable&lt;T&gt; - 排除 null 和 undefined</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T2</span> = <span class="title class_">NonNullable</span>&lt;<span class="built_in">string</span> | <span class="literal">null</span> | <span class="literal">undefined</span>&gt;; <span class="comment">// string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReturnType&lt;T&gt; - 获取函数返回类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> P = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> f&gt;; <span class="comment">// &#123; x: number; y: number; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// InstanceType&lt;T&gt; - 获取类实例类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">  x = <span class="number">0</span>;</span><br><span class="line">  y = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T3</span> = <span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> C&gt;; <span class="comment">// C</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Parameters&lt;T&gt; - 获取函数参数类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T4</span> = <span class="title class_">Parameters</span>&lt;<span class="keyword">typeof</span> f&gt;; <span class="comment">// []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Uppercase/Lowercase/Capitalize/Uncapitalize</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T5</span> = <span class="title class_">Uppercase</span>&lt;<span class="string">&#x27;hello&#x27;</span>&gt;; <span class="comment">// &#x27;HELLO&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T6</span> = <span class="title class_">Lowercase</span>&lt;<span class="string">&#x27;HELLO&#x27;</span>&gt;; <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T7</span> = <span class="title class_">Capitalize</span>&lt;<span class="string">&#x27;hello&#x27;</span>&gt;; <span class="comment">// &#x27;Hello&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T8</span> = <span class="title class_">Uncapitalize</span>&lt;<span class="string">&#x27;Hello&#x27;</span>&gt;; <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义工具类型"><a href="#自定义工具类型" class="headerlink" title="自定义工具类型"></a>自定义工具类型</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 深度 Readonly</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DeepReadonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P] <span class="keyword">extends</span> <span class="built_in">object</span></span><br><span class="line">    ? <span class="title class_">DeepReadonly</span>&lt;T[P]&gt;</span><br><span class="line">    : T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 深度 Partial</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DeepPartial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P] <span class="keyword">extends</span> <span class="built_in">object</span></span><br><span class="line">    ? <span class="title class_">DeepPartial</span>&lt;T[P]&gt;</span><br><span class="line">    : T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 深度 Required</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DeepRequired</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P] <span class="keyword">extends</span> <span class="built_in">object</span></span><br><span class="line">    ? <span class="title class_">DeepRequired</span>&lt;T[P]&gt;</span><br><span class="line">    : T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可空类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Nullable</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]: T[P] | <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组转联合</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TupleToUnion</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Tuple</span> = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Union</span> = <span class="title class_">TupleToUnion</span>&lt;<span class="title class_">Tuple</span>&gt;; <span class="comment">// &#x27;a&#x27; | &#x27;b&#x27; | &#x27;c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取函数名</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FunctionPropertyNames</span>&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]: T[K] <span class="keyword">extends</span> <span class="title class_">Function</span> ? K : <span class="built_in">never</span>;</span><br><span class="line">&#125;[keyof T];</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">greet</span>(): <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">farewell</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserMethods</span> = <span class="title class_">FunctionPropertyNames</span>&lt;<span class="title class_">User</span>&gt;; <span class="comment">// &#x27;greet&#x27; | &#x27;farewell&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件类型：Promise 解包</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Awaited</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;infer U&gt; ? U : T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PromiseType</span> = <span class="title class_">Awaited</span>&lt;<span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;&gt;; <span class="comment">// string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Path</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">object</span></span><br><span class="line">  ? &#123;</span><br><span class="line">      [K <span class="keyword">in</span> keyof T]: K <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">        ? K | <span class="string">`<span class="subst">$&#123;K&#125;</span>.<span class="subst">$&#123;Path&lt;T[K]&gt;&#125;</span>`</span></span><br><span class="line">        : <span class="built_in">never</span>;</span><br><span class="line">    &#125;[keyof T]</span><br><span class="line">  : <span class="built_in">never</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">city</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">street</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserPaths</span> = <span class="title class_">Path</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"><span class="comment">// &#x27;name&#x27; | &#x27;address&#x27; | &#x27;address.city&#x27; | &#x27;address.street&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="五、类型守卫与类型收窄"><a href="#五、类型守卫与类型收窄" class="headerlink" title="五、类型守卫与类型收窄"></a>五、类型守卫与类型收窄</h2><h3 id="typeof-类型守卫"><a href="#typeof-类型守卫" class="headerlink" title="typeof 类型守卫"></a>typeof 类型守卫</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">padLeft</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span>, <span class="attr">padding</span>: <span class="built_in">string</span> | <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>(padding + <span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>) + value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> padding + value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Expected string or number, got &#x27;<span class="subst">$&#123;padding&#125;</span>&#x27;.`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="instanceof-类型守卫"><a href="#instanceof-类型守卫" class="headerlink" title="instanceof 类型守卫"></a>instanceof 类型守卫</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="title function_">fly</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Flying...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fish</span> &#123;</span><br><span class="line">  <span class="title function_">swim</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Swimming...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"><span class="attr">pet</span>: <span class="title class_">Bird</span> | <span class="title class_">Fish</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (pet <span class="keyword">instanceof</span> <span class="title class_">Bird</span>) &#123;</span><br><span class="line">    pet.<span class="title function_">fly</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pet <span class="keyword">instanceof</span> <span class="title class_">Fish</span>) &#123;</span><br><span class="line">    pet.<span class="title function_">swim</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义类型守卫"><a href="#自定义类型守卫" class="headerlink" title="自定义类型守卫"></a>自定义类型守卫</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// is 关键字</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isString</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">unknown</span></span>): value is <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isNumber</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">unknown</span></span>): value is <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">process</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">unknown</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value.<span class="title function_">toUpperCase</span>()); <span class="comment">// TypeScript 知道是 string</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value.<span class="title function_">toFixed</span>(<span class="number">2</span>)); <span class="comment">// TypeScript 知道是 number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更复杂的类型守卫</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Admin</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">permissions</span>: <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isAdmin</span>(<span class="params"><span class="attr">user</span>: <span class="title class_">User</span> | <span class="title class_">Admin</span></span>): user is <span class="title class_">Admin</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;permissions&#x27;</span> <span class="keyword">in</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleUser</span>(<span class="params"><span class="attr">user</span>: <span class="title class_">User</span> | <span class="title class_">Admin</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isAdmin</span>(user)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">permissions</span>); <span class="comment">// ✅ Admin</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">email</span>); <span class="comment">// ✅ User</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可辨识联合</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Square</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;square&#x27;</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;rectangle&#x27;</span>;</span><br><span class="line">  <span class="attr">width</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;circle&#x27;</span>;</span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shape</span> = <span class="title class_">Square</span> | <span class="title class_">Rectangle</span> | <span class="title class_">Circle</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">area</span>(<span class="params"><span class="attr">shape</span>: <span class="title class_">Shape</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (shape.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;square&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> shape.<span class="property">size</span> * shape.<span class="property">size</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rectangle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> shape.<span class="property">width</span> * shape.<span class="property">height</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;circle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * shape.<span class="property">radius</span> * shape.<span class="property">radius</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完全覆盖检查</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertNever</span>(<span class="params"><span class="attr">x</span>: <span class="built_in">never</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unexpected object: &#x27;</span> + x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">area2</span>(<span class="params"><span class="attr">shape</span>: <span class="title class_">Shape</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (shape.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;square&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> shape.<span class="property">size</span> * shape.<span class="property">size</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rectangle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> shape.<span class="property">width</span> * shape.<span class="property">height</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;circle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * shape.<span class="property">radius</span> * shape.<span class="property">radius</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">assertNever</span>(shape); <span class="comment">// 如果有遗漏会报错</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、装饰器（Decorators）"><a href="#六、装饰器（Decorators）" class="headerlink" title="六、装饰器（Decorators）"></a>六、装饰器（Decorators）</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sealed</span>(<span class="params"><span class="attr">constructor</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">seal</span>(constructor);</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">seal</span>(constructor.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@sealed</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">any</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> originalMethod = descriptor.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  descriptor.<span class="property">value</span> = <span class="keyword">function</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Calling <span class="subst">$&#123;propertyKey&#125;</span> with`</span>, args);</span><br><span class="line">    <span class="keyword">const</span> result = originalMethod.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;propertyKey&#125;</span> returned`</span>, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">  <span class="meta">@log</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器工厂</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">format</span>(<span class="params"><span class="attr">formatString</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">any</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> originalMethod = descriptor.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = originalMethod.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      <span class="keyword">return</span> formatString.<span class="title function_">replace</span>(<span class="string">&#x27;%s&#x27;</span>, result);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> descriptor;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  <span class="meta">@format</span>(<span class="string">&#x27;Hello, %s!&#x27;</span>)</span><br><span class="line">  <span class="title function_">greet</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、模块与命名空间"><a href="#七、模块与命名空间" class="headerlink" title="七、模块与命名空间"></a>七、模块与命名空间</h2><h3 id="ES6-模块"><a href="#ES6-模块" class="headerlink" title="ES6 模块"></a>ES6 模块</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"><span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Calculator</span>, &#123; add, <span class="variable constant_">PI</span>, <span class="title class_">User</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> utils <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">MyNamespace</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createUser</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>): <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; name &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">MyNamespace</span>.<span class="property">User</span> = <span class="title class_">MyNamespace</span>.<span class="title function_">createUser</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套命名空间</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">MyNamespace</span>.<span class="property">SubNamespace</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跨文件命名空间</span></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">MyNamespace</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// utils.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;types.ts&quot; /&gt;</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">MyNamespace</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createUser</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>): <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; name &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、实战示例"><a href="#八、实战示例" class="headerlink" title="八、实战示例"></a>八、实战示例</h2><h3 id="API-请求类型定义"><a href="#API-请求类型定义" class="headerlink" title="API 请求类型定义"></a>API 请求类型定义</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">  <span class="attr">status</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">content</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">authorId</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ApiResponse</span>&lt;<span class="title class_">User</span>&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchPosts</span>(<span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ApiResponse</span>&lt;<span class="title class_">Post</span>[]&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/posts&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: user &#125; = <span class="keyword">await</span> <span class="title function_">fetchUser</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>

<h3 id="React-TypeScript"><a href="#React-TypeScript" class="headerlink" title="React + TypeScript"></a>React + TypeScript</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Props</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">onIncrement</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Counter</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">&#123; title, count, onIncrement &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [localCount, setLocalCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onIncrement&#125;</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hooks 类型</span></span><br><span class="line"><span class="keyword">function</span> useFetch&lt;T&gt;(<span class="attr">url</span>: <span class="built_in">string</span>): &#123;</span><br><span class="line">  <span class="attr">data</span>: T | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">loading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">Error</span> | <span class="literal">null</span>;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState&lt;T | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="title class_">Error</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(url)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(setData)</span><br><span class="line">      .<span class="title function_">catch</span>(setError)</span><br><span class="line">      .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> <span class="title function_">setLoading</span>(<span class="literal">false</span>));</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; data, loading, error &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="TypeScript-核心优势"><a href="#TypeScript-核心优势" class="headerlink" title="TypeScript 核心优势"></a>TypeScript 核心优势</h3><ul>
<li>✅ 静态类型检查</li>
<li>✅ 更好的 IDE 支持</li>
<li>✅ 代码自文档化</li>
<li>✅ 重构更安全</li>
<li>✅ 减少运行时错误</li>
</ul>
<h3 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h3><ol>
<li>基础类型和注解</li>
<li>接口和类型别名</li>
<li>泛型编程</li>
<li>高级类型技巧</li>
<li>实战项目应用</li>
</ol>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li>优先使用 interface 而不是 type</li>
<li>避免使用 any，使用 unknown</li>
<li>使用类型守卫收窄类型</li>
<li>合理使用泛型提高复用性</li>
<li>严格的 tsconfig 配置</li>
</ol>
<p>TypeScript 让 JavaScript 开发更安全、更高效！</p>
<hr>
<p><em>下一篇将介绍微前端架构，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>TypeScript</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>TypeScript</tag>
        <tag>类型系统</tag>
        <tag>泛型</tag>
      </tags>
  </entry>
  <entry>
    <title>微前端架构实战：qiankun与single-spa完全指南</title>
    <url>/2026/01/21/micro-frontend-architecture/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着前端应用规模的增长，单体前端应用面临维护困难、部署缓慢、技术栈固化等问题。微前端架构应运而生，它允许我们将大型前端应用拆分成多个小型、独立的应用。</p>
<p>本文将深入讲解微前端架构的两种主流方案：qiankun 和 single-spa。</p>
<h2 id="一、微前端架构概述"><a href="#一、微前端架构概述" class="headerlink" title="一、微前端架构概述"></a>一、微前端架构概述</h2><h3 id="什么是微前端？"><a href="#什么是微前端？" class="headerlink" title="什么是微前端？"></a>什么是微前端？</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">微前端概念：</span><br><span class="line">┌─────────────────────────────────────────┐</span><br><span class="line">│          微前端应用架构                   │</span><br><span class="line">├─────────────────────────────────────────┤</span><br><span class="line">│  主应用（Base App）                      │</span><br><span class="line">│  - 路由管理                              │</span><br><span class="line">│  - 应用加载                              │</span><br><span class="line">│  - 状态共享                              │</span><br><span class="line">│  - 通信协调                              │</span><br><span class="line">├─────────────────────────────────────────┤</span><br><span class="line">│  微应用（Micro Apps）                    │</span><br><span class="line">│  ┌────────┬────────┬────────┬────────┐ │</span><br><span class="line">│  │ App 1  │ App 2  │ App 3  │ App 4  │ │</span><br><span class="line">│  │ React  │ Vue    │ Angular│ Svelte │ │</span><br><span class="line">│  └────────┴────────┴────────┴────────┘ │</span><br><span class="line">│  - 独立开发                              │</span><br><span class="line">│  - 独立部署                              │</span><br><span class="line">│  - 独立运行                              │</span><br><span class="line">└─────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="微前端的优势"><a href="#微前端的优势" class="headerlink" title="微前端的优势"></a>微前端的优势</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">技术优势：</span></span><br><span class="line"><span class="comment">✅ 团队自治 - 不同团队可以独立开发</span></span><br><span class="line"><span class="comment">✅ 技术栈无关 - React/Vue/Angular 共存</span></span><br><span class="line"><span class="comment">✅ 独立部署 - 微应用可独立发布</span></span><br><span class="line"><span class="comment">✅ 增量升级 - 逐步迁移旧系统</span></span><br><span class="line"><span class="comment">✅ 故障隔离 - 一个应用崩溃不影响其他</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">业务优势：</span></span><br><span class="line"><span class="comment">✅ 快速交付 - 并行开发，加快迭代</span></span><br><span class="line"><span class="comment">✅ 灵活扩展 - 按需添加功能模块</span></span><br><span class="line"><span class="comment">✅ 降低风险 - 分布式开发降低单点风险</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="主流微前端方案对比"><a href="#主流微前端方案对比" class="headerlink" title="主流微前端方案对比"></a>主流微前端方案对比</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">方案对比：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">┌──────────┬──────────┬──────────┬──────────┐</span></span><br><span class="line"><span class="comment">│          │ qiankun  │single-spa│  Module   │</span></span><br><span class="line"><span class="comment">│          │          │          │ Federation│</span></span><br><span class="line"><span class="comment">├──────────┼──────────┼──────────┼──────────┤</span></span><br><span class="line"><span class="comment">│上手难度  │   ⭐⭐   │   ⭐⭐⭐  │   ⭐⭐⭐⭐ │</span></span><br><span class="line"><span class="comment">│功能丰富度│   ⭐⭐⭐⭐ │   ⭐⭐⭐  │   ⭐⭐⭐  │</span></span><br><span class="line"><span class="comment">│生态成熟度│   ⭐⭐⭐⭐ │   ⭐⭐⭐⭐ │   ⭐⭐   │</span></span><br><span class="line"><span class="comment">│社区活跃度│   ⭐⭐⭐⭐ │   ⭐⭐⭐⭐ │   ⭐⭐⭐  │</span></span><br><span class="line"><span class="comment">│适用场景  │  企业级  │ 通用场景  │  现代浏览器│</span></span><br><span class="line"><span class="comment">└──────────┴──────────┴──────────┴──────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="二、qiankun-完全指南"><a href="#二、qiankun-完全指南" class="headerlink" title="二、qiankun 完全指南"></a>二、qiankun 完全指南</h2><h3 id="主应用配置"><a href="#主应用配置" class="headerlink" title="主应用配置"></a>主应用配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 主应用安装 qiankun</span></span><br><span class="line"><span class="comment">// npm install qiankun</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerMicroApps, start &#125; <span class="keyword">from</span> <span class="string">&#x27;qiankun&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册微应用</span></span><br><span class="line"><span class="title function_">registerMicroApps</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;react-app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;//localhost:7100&#x27;</span>,</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#subapp-container&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/react&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">routerBase</span>: <span class="string">&#x27;/react&#x27;</span>,</span><br><span class="line">      <span class="attr">token</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vue-app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;//localhost:7200&#x27;</span>,</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#subapp-container&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/vue&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">routerBase</span>: <span class="string">&#x27;/vue&#x27;</span>,</span><br><span class="line">      <span class="attr">store</span>: &#123;&#125; <span class="comment">// 传递全局状态</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;angular-app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;//localhost:7300&#x27;</span>,</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#subapp-container&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/angular&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动 qiankun</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">sandbox</span>: &#123;</span><br><span class="line">    <span class="attr">strictStyleIsolation</span>: <span class="literal">false</span>, <span class="comment">// 样式隔离</span></span><br><span class="line">    <span class="attr">experimentalStyleIsolation</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">prefetch</span>: <span class="literal">true</span>, <span class="comment">// 预加载</span></span><br><span class="line">  <span class="attr">singular</span>: <span class="literal">false</span>, <span class="comment">// 是否单实例</span></span><br><span class="line">  <span class="attr">fetch</span>: <span class="variable language_">window</span>.<span class="property">fetch</span> <span class="comment">// 自定义 fetch</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="React-微应用配置"><a href="#React-微应用配置" class="headerlink" title="React 微应用配置"></a>React 微应用配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 微应用：React (webpack.config.js)</span></span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./package.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">library</span>: <span class="string">`<span class="subst">$&#123;name&#125;</span>-[name]`</span>,</span><br><span class="line">    <span class="attr">libraryTarget</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="attr">globalObject</span>: <span class="string">&#x27;window&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">7100</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/public-path.js</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line">  __webpack_public_path__ = <span class="variable language_">window</span>.<span class="property">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./public-path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> root = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">props = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(</span><br><span class="line">    container ? container.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>) : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>)</span><br><span class="line">  );</span><br><span class="line">  root.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 独立运行</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line">  <span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;React app bootstraped&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;React app mounted&#x27;</span>, props);</span><br><span class="line">  <span class="title function_">render</span>(props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;React app unmounted&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  root.<span class="title function_">unmount</span>(</span><br><span class="line">    container ? container.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>) : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Vue3-微应用配置"><a href="#Vue3-微应用配置" class="headerlink" title="Vue3 微应用配置"></a>Vue3 微应用配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 微应用：Vue3 (vite.config.js)</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> qiankun <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-qiankun&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">qiankun</span>(<span class="string">&#x27;vue-app&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">useDevMode</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">7200</span>,</span><br><span class="line">    <span class="attr">origin</span>: <span class="string">&#x27;http://localhost:7200&#x27;</span>,</span><br><span class="line">    <span class="attr">cors</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">props = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">  app.<span class="title function_">use</span>(router);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> containerElement = container</span><br><span class="line">    ? container.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">    : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">mount</span>(containerElement);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line">  <span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Vue app bootstraped&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Vue app mounted&#x27;</span>, props);</span><br><span class="line">  <span class="title function_">render</span>(props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Vue app unmounted&#x27;</span>);</span><br><span class="line">  app.<span class="title function_">unmount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Angular-微应用配置"><a href="#Angular-微应用配置" class="headerlink" title="Angular 微应用配置"></a>Angular 微应用配置</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 微应用：Angular (src/main.ts)</span></span><br><span class="line"><span class="keyword">import</span> &#123; platformBrowserDynamic &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser-dynamic&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModuleRef</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.module&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">app</span>: <span class="built_in">void</span> | <span class="title class_">NgModuleRef</span>&lt;<span class="title class_">AppModule</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getProps</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="variable language_">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">__PROVIDED_QIANKUN_DEPS__</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params"><span class="attr">props</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; container &#125; = props;</span><br><span class="line">  app = <span class="title function_">platformBrowserDynamic</span>()</span><br><span class="line">    .<span class="title function_">bootstrapModule</span>(<span class="title class_">AppModule</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">moduleRef</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> rootElement = container</span><br><span class="line">        ? container.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app-root&#x27;</span>)</span><br><span class="line">        : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app-root&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      rootElement.<span class="title function_">appendChild</span>(moduleRef.<span class="property">instance</span>.<span class="property">elementRef</span>.<span class="property">nativeElement</span>);</span><br><span class="line">      <span class="keyword">return</span> moduleRef;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (app) &#123;</span><br><span class="line">    app.<span class="title function_">then</span>(<span class="function">(<span class="params">moduleRef</span>) =&gt;</span> &#123;</span><br><span class="line">      moduleRef.<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 独立运行</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable language_">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line">  <span class="title function_">mount</span>(&#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Angular app bootstraped&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Angular app mounted&#x27;</span>, props);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">mount</span>(props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Angular app unmounted&#x27;</span>);</span><br><span class="line">  <span class="title function_">unmount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生命周期详解"><a href="#生命周期详解" class="headerlink" title="生命周期详解"></a>生命周期详解</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">qiankun 生命周期流程：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">微应用加载流程：</span></span><br><span class="line"><span class="comment">┌──────────────┐</span></span><br><span class="line"><span class="comment">│  1. Bootstrap │ 初始化（只执行一次）</span></span><br><span class="line"><span class="comment">└──────┬───────┘</span></span><br><span class="line"><span class="comment">       │</span></span><br><span class="line"><span class="comment">       ▼</span></span><br><span class="line"><span class="comment">┌──────────────┐</span></span><br><span class="line"><span class="comment">│  2. Mount     │ 挂载（每次激活）</span></span><br><span class="line"><span class="comment">└──────┬───────┘</span></span><br><span class="line"><span class="comment">       │</span></span><br><span class="line"><span class="comment">       ▼</span></span><br><span class="line"><span class="comment">┌──────────────┐</span></span><br><span class="line"><span class="comment">│  3. Unmount   │ 卸载（每次失活）</span></span><br><span class="line"><span class="comment">└──────────────┘</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">生命周期最佳实践：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">export async function bootstrap() &#123;</span></span><br><span class="line"><span class="comment">  // 初始化全局配置</span></span><br><span class="line"><span class="comment">  // 建立连接（WebSocket、数据库等）</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">export async function mount(props) &#123;</span></span><br><span class="line"><span class="comment">  // 接收主应用传递的 props</span></span><br><span class="line"><span class="comment">  // 初始化路由</span></span><br><span class="line"><span class="comment">  // 渲染组件</span></span><br><span class="line"><span class="comment">  // 订阅全局状态</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">export async function unmount(props) &#123;</span></span><br><span class="line"><span class="comment">  // 清理订阅</span></span><br><span class="line"><span class="comment">  // 销毁连接</span></span><br><span class="line"><span class="comment">  // 清空状态</span></span><br><span class="line"><span class="comment">  // 移除 DOM</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="三、样式隔离"><a href="#三、样式隔离" class="headerlink" title="三、样式隔离"></a>三、样式隔离</h2><h3 id="CSS-隔离方案"><a href="#CSS-隔离方案" class="headerlink" title="CSS 隔离方案"></a>CSS 隔离方案</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方案1: 严格样式隔离（Shadow DOM）</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">sandbox</span>: &#123;</span><br><span class="line">    <span class="attr">strictStyleIsolation</span>: <span class="literal">true</span> <span class="comment">// 开启 Shadow DOM</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案2: 实验性样式隔离（推荐）</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">sandbox</span>: &#123;</span><br><span class="line">    <span class="attr">experimentalStyleIsolation</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">方案对比：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">strictStyleIsolation:</span></span><br><span class="line"><span class="comment">✅ 完全隔离</span></span><br><span class="line"><span class="comment">✅ 样式不冲突</span></span><br><span class="line"><span class="comment">❌ 部分样式库失效（antd）</span></span><br><span class="line"><span class="comment">❌ 弹窗组件样式问题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">experimentalStyleIsolation:</span></span><br><span class="line"><span class="comment">✅ 基本隔离</span></span><br><span class="line"><span class="comment">✅ 兼容性好</span></span><br><span class="line"><span class="comment">⚠️ 可能存在样式泄漏</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="Scoped-CSS"><a href="#Scoped-CSS" class="headerlink" title="Scoped CSS"></a>Scoped CSS</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Vue Scoped CSS */</span></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 自动添加属性选择器 */</span></span><br><span class="line"><span class="selector-class">.container</span><span class="selector-attr">[data-v-xxx]</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* React CSS Modules */</span></span><br><span class="line"><span class="comment">/* styles.module.css */</span></span><br><span class="line">.<span class="property">container</span> &#123;</span><br><span class="line">  <span class="attr">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Component.jsx */</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./styles.module.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="样式冲突解决"><a href="#样式冲突解决" class="headerlink" title="样式冲突解决"></a>样式冲突解决</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方案1: CSS 命名空间</span></span><br><span class="line"><span class="comment">// 主应用</span></span><br><span class="line">.<span class="property">main</span>-app-button &#123;</span><br><span class="line">  <span class="comment">/* 主应用样式 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微应用</span></span><br><span class="line">.<span class="property">subapp</span>-button &#123;</span><br><span class="line">  <span class="comment">/* 微应用样式 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案2: CSS-in-JS</span></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">&#x27;styled-components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span> = styled.<span class="property">button</span><span class="string">`</span></span><br><span class="line"><span class="string">  color: red;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案3: 动态添加/移除样式</span></span><br><span class="line"><span class="comment">// qiankun 自动处理微应用样式挂载和卸载</span></span><br></pre></td></tr></table></figure>

<h2 id="四、JS-沙箱"><a href="#四、JS-沙箱" class="headerlink" title="四、JS 沙箱"></a>四、JS 沙箱</h2><h3 id="快照沙箱（开发环境）"><a href="#快照沙箱（开发环境）" class="headerlink" title="快照沙箱（开发环境）"></a>快照沙箱（开发环境）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// qiankun 在开发环境使用快照沙箱</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SnapshotSandbox</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">proxy</span> = <span class="variable language_">window</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&#x27;Snapshot&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">windowSnapshot</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">active</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 记录当前状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">windowSnapshot</span> = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">windowSnapshot</span>[prop] = <span class="variable language_">window</span>[prop];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 恢复上次修改</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">prop</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>[prop] = <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>[prop];</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">inactive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">window</span>[prop] !== <span class="variable language_">this</span>.<span class="property">windowSnapshot</span>[prop]) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>[prop] = <span class="variable language_">window</span>[prop];</span><br><span class="line">        <span class="variable language_">window</span>[prop] = <span class="variable language_">this</span>.<span class="property">windowSnapshot</span>[prop];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代理沙箱（生产环境）"><a href="#代理沙箱（生产环境）" class="headerlink" title="代理沙箱（生产环境）"></a>代理沙箱（生产环境）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// qiankun 在生产环境使用代理沙箱（不支持 IE）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxySandbox</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fakeWindow = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(fakeWindow, &#123;</span><br><span class="line">      <span class="attr">set</span>: <span class="function">(<span class="params">target, prop, value</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sandboxRunning</span>) &#123;</span><br><span class="line">          target[prop] = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">get</span>: <span class="function">(<span class="params">target, prop</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> target[prop] || <span class="variable language_">window</span>[prop];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">proxy</span> = proxy;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&#x27;Proxy&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">active</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">inactive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、应用间通信"><a href="#五、应用间通信" class="headerlink" title="五、应用间通信"></a>五、应用间通信</h2><h3 id="主应用传递-props"><a href="#主应用传递-props" class="headerlink" title="主应用传递 props"></a>主应用传递 props</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 主应用</span></span><br><span class="line"><span class="title function_">registerMicroApps</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vue-app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;//localhost:7200&#x27;</span>,</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#subapp&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/vue&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>: &#123; <span class="attr">userId</span>: <span class="number">123</span> &#125;,</span><br><span class="line">      <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="attr">onGlobalStateChange</span>: <span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;主应用状态变化&#x27;</span>, state, prev);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微应用接收</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">data</span>); <span class="comment">// &#123; userId: 123 &#125;</span></span><br><span class="line">  props.<span class="property">actions</span>.<span class="title function_">onGlobalStateChange</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全局状态管理"><a href="#全局状态管理" class="headerlink" title="全局状态管理"></a>全局状态管理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装 qiankun 状态管理</span></span><br><span class="line"><span class="comment">// npm install qiankun</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主应用</span></span><br><span class="line"><span class="keyword">import</span> &#123; initGlobalState &#125; <span class="keyword">from</span> <span class="string">&#x27;qiankun&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">token</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">language</span>: <span class="string">&#x27;zh-CN&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">initGlobalState</span>(initialState);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听状态变化</span></span><br><span class="line">actions.<span class="title function_">onGlobalStateChange</span>(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;主应用:&#x27;</span>, state, prev);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改状态</span></span><br><span class="line">actions.<span class="title function_">setGlobalState</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// offGlobalStateChange 取消监听</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微应用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="comment">// 监听全局状态</span></span><br><span class="line">  props.<span class="title function_">onGlobalStateChange</span>(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微应用:&#x27;</span>, state, prev);</span><br><span class="line">  &#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改全局状态</span></span><br><span class="line">  props.<span class="title function_">setGlobalState</span>(&#123;</span><br><span class="line">    <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义事件总线"><a href="#自定义事件总线" class="headerlink" title="自定义事件总线"></a>自定义事件总线</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// event-bus.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">on</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[event]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[event] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[event].<span class="title function_">push</span>(callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">off</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[event]) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[event] = <span class="variable language_">this</span>.<span class="property">events</span>[event].<span class="title function_">filter</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb !== callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">event, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[event]) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[event].<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">callback</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出单例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> eventBus = <span class="keyword">new</span> <span class="title class_">EventBus</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主应用</span></span><br><span class="line"><span class="keyword">import</span> &#123; eventBus &#125; <span class="keyword">from</span> <span class="string">&#x27;./event-bus&#x27;</span>;</span><br><span class="line"></span><br><span class="line">eventBus.<span class="title function_">on</span>(<span class="string">&#x27;user-login&#x27;</span>, <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户登录&#x27;</span>, user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微应用</span></span><br><span class="line"><span class="keyword">import</span> &#123; eventBus &#125; <span class="keyword">from</span> <span class="string">&#x27;./event-bus&#x27;</span>;</span><br><span class="line"></span><br><span class="line">eventBus.<span class="title function_">emit</span>(<span class="string">&#x27;user-login&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="六、路由管理"><a href="#六、路由管理" class="headerlink" title="六、路由管理"></a>六、路由管理</h2><h3 id="主应用路由配置"><a href="#主应用路由配置" class="headerlink" title="主应用路由配置"></a>主应用路由配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React Router v6</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span>, <span class="title class_">Routes</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/react&quot;</span>&gt;</span>React应用<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/vue&quot;</span>&gt;</span>Vue应用<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/react/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span> <span class="attr">id</span>=<span class="string">&quot;subapp-container&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/vue/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span> <span class="attr">id</span>=<span class="string">&quot;subapp-container&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由拦截</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> location = <span class="title function_">useLocation</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 路由守卫</span></span><br><span class="line">    <span class="keyword">if</span> (location.<span class="property">pathname</span>.<span class="title function_">includes</span>(<span class="string">&#x27;/admin&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">        <span class="comment">// 跳转到登录页</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [location]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="微应用路由配置"><a href="#微应用路由配置" class="headerlink" title="微应用路由配置"></a>微应用路由配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React 微应用路由</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span>, <span class="title class_">Routes</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123; routerBase &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span> <span class="attr">basename</span>=<span class="string">&#123;routerBase&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 微应用路由</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">About</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span> ? <span class="string">&#x27;/vue&#x27;</span> : <span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<h2 id="七、性能优化"><a href="#七、性能优化" class="headerlink" title="七、性能优化"></a>七、性能优化</h2><h3 id="预加载策略"><a href="#预加载策略" class="headerlink" title="预加载策略"></a>预加载策略</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预加载所有微应用</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">prefetch</span>: <span class="literal">true</span> <span class="comment">// 默认，会在第一个微应用挂载后预加载其他</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预加载指定微应用</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">prefetch</span>: [<span class="string">&#x27;app1&#x27;</span>, <span class="string">&#x27;app2&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用预加载</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">prefetch</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义预加载策略</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">prefetch</span>: <span class="function">(<span class="params">apps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// apps: 所有已注册的微应用</span></span><br><span class="line">    <span class="keyword">return</span> apps.<span class="title function_">filter</span>(<span class="function"><span class="params">app</span> =&gt;</span> [<span class="string">&#x27;app1&#x27;</span>, <span class="string">&#x27;app2&#x27;</span>].<span class="title function_">includes</span>(app.<span class="property">name</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 按需加载微应用</span></span><br><span class="line"><span class="title function_">registerMicroApps</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;heavy-app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./heavy-app/entry&#x27;</span>), <span class="comment">// 动态 entry</span></span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#container&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/heavy&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 应用缓存</span></span><br><span class="line"><span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadApp</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (cache[name]) &#123;</span><br><span class="line">    <span class="keyword">return</span> cache[name];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`./apps/<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  cache[name] = app;</span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、single-spa-方案"><a href="#八、single-spa-方案" class="headerlink" title="八、single-spa 方案"></a>八、single-spa 方案</h2><h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装 single-spa</span></span><br><span class="line"><span class="comment">// npm install single-spa</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// root-config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerApplication, start &#125; <span class="keyword">from</span> <span class="string">&#x27;single-spa&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册微应用</span></span><br><span class="line"><span class="title function_">registerApplication</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;@org/react-app&#x27;</span>,</span><br><span class="line">  <span class="attr">main</span>: <span class="function">() =&gt;</span> <span class="title class_">System</span>.<span class="keyword">import</span>(<span class="string">&#x27;@org/react-app&#x27;</span>),</span><br><span class="line">  <span class="attr">activeWhen</span>: <span class="string">&#x27;/react&#x27;</span>,</span><br><span class="line">  <span class="attr">customProps</span>: &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerApplication</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;@org/vue-app&#x27;</span>,</span><br><span class="line">  <span class="attr">main</span>: <span class="function">() =&gt;</span> <span class="title class_">System</span>.<span class="keyword">import</span>(<span class="string">&#x27;@org/vue-app&#x27;</span>),</span><br><span class="line">  <span class="attr">activeWhen</span>: <span class="function">(<span class="params">location</span>) =&gt;</span> location.<span class="property">pathname</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/vue&#x27;</span>),</span><br><span class="line">  <span class="attr">customProps</span>: &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">urlRerouteOnly</span>: <span class="literal">true</span> <span class="comment">// 只在 URL 变化时重新路由</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="SystemJS-配置"><a href="#SystemJS-配置" class="headerlink" title="SystemJS 配置"></a>SystemJS 配置</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/systemjs/dist/system.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/systemjs/dist/extras/amd.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/systemjs/dist/exposables/use-default.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">System</span>.<span class="keyword">import</span>(<span class="string">&#x27;@org/root-config&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// system-import-map.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;imports&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;single-spa&quot;</span>: <span class="string">&quot;https://cdn.jsdelivr.net/npm/single-spa/lib/system/single-spa.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react&quot;</span>: <span class="string">&quot;https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@org/react-app&quot;</span>: <span class="string">&quot;http://localhost:7100/org-react-app.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@org/vue-app&quot;</span>: <span class="string">&quot;http://localhost:7200/org-vue-app.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、最佳实践"><a href="#九、最佳实践" class="headerlink" title="九、最佳实践"></a>九、最佳实践</h2><h3 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 应用边界</span></span><br><span class="line"><span class="comment">   - 按业务领域划分（用户、订单、商品）</span></span><br><span class="line"><span class="comment">   - 按功能模块划分（管理后台、用户端）</span></span><br><span class="line"><span class="comment">   - 按团队划分（前端组A、前端组B）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 依赖管理</span></span><br><span class="line"><span class="comment">   - 避免共享依赖</span></span><br><span class="line"><span class="comment">   - 版本锁定</span></span><br><span class="line"><span class="comment">   - 使用 peerDependencies</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3. 样式规范</span></span><br><span class="line"><span class="comment">   - 使用 CSS Modules / Scoped CSS</span></span><br><span class="line"><span class="comment">   - 统一设计系统</span></span><br><span class="line"><span class="comment">   - 样式隔离</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4. 通信规范</span></span><br><span class="line"><span class="comment">   - 使用 props 传递基础数据</span></span><br><span class="line"><span class="comment">   - 使用 qiankun 状态管理全局状态</span></span><br><span class="line"><span class="comment">   - 事件总线用于跨应用通信</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5. 部署规范</span></span><br><span class="line"><span class="comment">   - 独立 CI/CD</span></span><br><span class="line"><span class="comment">   - 灰度发布</span></span><br><span class="line"><span class="comment">   - 版本管理</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React 错误边界</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, errorInfo</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;微应用错误:&#x27;</span>, error, errorInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">&lt;<span class="title class_">ErrorBoundary</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;subapp-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">ErrorBoundary</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="监控与日志"><a href="#监控与日志" class="headerlink" title="监控与日志"></a>监控与日志</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局错误捕获</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;全局错误:&#x27;</span>, event.<span class="property">error</span>);</span><br><span class="line">  <span class="comment">// 上报监控平台</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;unhandledrejection&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;未处理的 Promise 拒绝:&#x27;</span>, event.<span class="property">reason</span>);</span><br><span class="line">  <span class="comment">// 上报监控平台</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// qiankun 生命周期错误捕获</span></span><br><span class="line"><span class="title function_">registerMicroApps</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;//localhost:7100&#x27;</span>,</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#container&#x27;</span>,</span><br><span class="line">    <span class="attr">activeRule</span>: <span class="string">&#x27;/app&#x27;</span>,</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;#container&#x27;</span>,</span><br><span class="line">    <span class="attr">errorBoundary</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;微应用加载失败:&#x27;</span>, err);</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>加载失败，请刷新重试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="qiankun-vs-single-spa"><a href="#qiankun-vs-single-spa" class="headerlink" title="qiankun vs single-spa"></a>qiankun vs single-spa</h3><p><strong>选择 qiankun 如果：</strong></p>
<ul>
<li>✅ 需要开箱即用的解决方案</li>
<li>✅ 团队对微前端不太熟悉</li>
<li>✅ 需要完善的样式隔离和 JS 沙箱</li>
<li>✅ 使用 Vue&#x2F;React&#x2F;Angular</li>
</ul>
<p><strong>选择 single-spa 如果：</strong></p>
<ul>
<li>✅ 需要更灵活的控制</li>
<li>✅ 使用 SystemJS 模块联邦</li>
<li>✅ 需要与其他框架集成</li>
</ul>
<h3 id="实施建议"><a href="#实施建议" class="headerlink" title="实施建议"></a>实施建议</h3><ol>
<li><strong>渐进式迁移</strong> - 从边缘功能开始，逐步迁移</li>
<li><strong>统一规范</strong> - 制定开发、部署、监控规范</li>
<li><strong>稳定优先</strong> - 保证用户体验，做好降级方案</li>
<li><strong>持续优化</strong> - 监控性能，优化加载策略</li>
</ol>
<p>微前端架构是大型前端应用的解决方案，根据实际需求选择合适的方案！</p>
<hr>
<p><em>微前端系列文章完结，感谢阅读！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>架构</category>
      </categories>
      <tags>
        <tag>微前端</tag>
        <tag>qiankun</tag>
        <tag>single-spa</tag>
        <tag>前端架构</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3完全指南：组合式API与响应式原理深度解析</title>
    <url>/2026/01/21/vue3-composition-api/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Vue3 带来了全新的 Composition API（组合式 API），相比 Options API 提供了更好的逻辑复用和类型推断。同时，Vue3 的响应式系统也从 Object 升级到了 Proxy，性能和功能都有了显著提升。</p>
<p>本文将深入解析 Vue3 的核心特性。</p>
<h2 id="一、Composition-API-基础"><a href="#一、Composition-API-基础" class="headerlink" title="一、Composition API 基础"></a>一、Composition API 基础</h2><h3 id="setup-函数"><a href="#setup-函数" class="headerlink" title="setup 函数"></a>setup 函数</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, computed, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 响应式状态</span></span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      count.<span class="property">value</span>++;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生命周期钩子</span></span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件已挂载&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回给模板使用</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      user,</span><br><span class="line">      doubleCount,</span><br><span class="line">      increment</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="语法糖"><a href="#语法糖" class="headerlink" title="&lt;script setup&gt; 语法糖"></a><code>&lt;script setup&gt;</code> 语法糖</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, computed, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// 自动注册的响应式状态</span><br><span class="line">const count = ref(0);</span><br><span class="line">const user = reactive(&#123; name: &#x27;Alice&#x27;, age: 25 &#125;);</span><br><span class="line"></span><br><span class="line">// 自动暴露给模板</span><br><span class="line">const doubleCount = computed(() =&gt; count.value * 2);</span><br><span class="line"></span><br><span class="line">function increment() &#123;</span><br><span class="line">  count.value++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;组件已挂载&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double: &#123;&#123; doubleCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;增加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="二、响应式系统"><a href="#二、响应式系统" class="headerlink" title="二、响应式系统"></a>二、响应式系统</h2><h3 id="ref-vs-reactive"><a href="#ref-vs-reactive" class="headerlink" title="ref vs reactive"></a>ref vs reactive</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ref - 用于基本类型和对象</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问值需要 .value</span></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">value</span>.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive - 只用于对象</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接访问属性</span></span><br><span class="line">state.<span class="property">count</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">user</span>.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ⚠️ reactive 解构失去响应性</span></span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = state;</span><br><span class="line">count++; <span class="comment">// 不会触发更新</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 使用 toRefs 保持响应性</span></span><br><span class="line"><span class="keyword">import</span> &#123; toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = <span class="title function_">toRefs</span>(state);</span><br><span class="line">count.<span class="property">value</span>++; <span class="comment">// ✅ 响应式</span></span><br></pre></td></tr></table></figure>

<h3 id="响应式转换工具"><a href="#响应式转换工具" class="headerlink" title="响应式转换工具"></a>响应式转换工具</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, toRef, toRefs, readonly, isRef, isReactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// toRef - 为响应式对象的属性创建 ref</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> countRef = <span class="title function_">toRef</span>(state, <span class="string">&#x27;count&#x27;</span>);</span><br><span class="line">countRef.<span class="property">value</span>++; <span class="comment">// ✅ 会更新 state.count</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// toRefs - 将响应式对象转换为普通对象，每个属性都是 ref</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Vue&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> &#123; count, name &#125; = <span class="title function_">toRefs</span>(state);</span><br><span class="line"></span><br><span class="line"><span class="comment">// readonly - 创建只读的响应式对象</span></span><br><span class="line"><span class="keyword">const</span> original = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">readonly</span>(original);</span><br><span class="line"></span><br><span class="line">copy.<span class="property">count</span>++; <span class="comment">// ⚠️ 警告：不能修改只读对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isRef</span>(<span class="title function_">ref</span>(<span class="number">0</span>)));         <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isReactive</span>(<span class="title function_">reactive</span>(&#123;&#125;))); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="computed-计算属性"><a href="#computed-计算属性" class="headerlink" title="computed 计算属性"></a>computed 计算属性</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读计算属性</span></span><br><span class="line"><span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可写计算属性</span></span><br><span class="line"><span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(&#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> count.<span class="property">value</span> * <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    count.<span class="property">value</span> = value / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">doubleCount.<span class="property">value</span> = <span class="number">10</span>; <span class="comment">// 会设置 count.value = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算属性缓存</span></span><br><span class="line"><span class="keyword">const</span> expensiveValue = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;计算中...&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">heavyComputation</span>(count.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有 count 改变时才重新计算</span></span><br></pre></td></tr></table></figure>

<h3 id="watch-和-watchEffect"><a href="#watch-和-watchEffect" class="headerlink" title="watch 和 watchEffect"></a>watch 和 watchEffect</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// watchEffect - 自动追踪依赖，立即执行</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count is: <span class="subst">$&#123;count.value&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// watch - 明确指定源，懒执行</span></span><br><span class="line"><span class="title function_">watch</span>(count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`count changed from <span class="subst">$&#123;oldValue&#125;</span> to <span class="subst">$&#123;newValue&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听多个源</span></span><br><span class="line"><span class="title function_">watch</span>([count, <span class="function">() =&gt;</span> user.<span class="property">name</span>], <span class="function">(<span class="params">[newCount, newName]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`count: <span class="subst">$&#123;newCount&#125;</span>, name: <span class="subst">$&#123;newName&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 深度监听</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> user,</span><br><span class="line">  <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;user changed:&#x27;</span>, newValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125; <span class="comment">// 深度监听</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  count,</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count:&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// watchEffect 停止监听</span></span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 stop 停止监听</span></span><br><span class="line"><span class="title function_">stop</span>();</span><br></pre></td></tr></table></figure>

<h2 id="三、生命周期钩子"><a href="#三、生命周期钩子" class="headerlink" title="三、生命周期钩子"></a>三、生命周期钩子</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  onBeforeMount,</span><br><span class="line">  onMounted,</span><br><span class="line">  onBeforeUpdate,</span><br><span class="line">  onUpdated,</span><br><span class="line">  onBeforeUnmount,</span><br><span class="line">  onUnmounted,</span><br><span class="line">  onErrorCaptured,</span><br><span class="line">  onRenderTracked,</span><br><span class="line">  onRenderTriggered</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;挂载之前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已挂载&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onBeforeUpdate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新之前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已更新&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;卸载之前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已卸载&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 错误捕获</span></span><br><span class="line">    <span class="title function_">onErrorCaptured</span>(<span class="function">(<span class="params">err, instance, info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;错误:&#x27;</span>, err);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 阻止错误继续传播</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调试钩子</span></span><br><span class="line">    <span class="title function_">onRenderTracked</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;跟踪:&#x27;</span>, e);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onRenderTriggered</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;触发:&#x27;</span>, e);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Options API vs Composition API 生命周期对照</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Options API           | Composition API</span></span><br><span class="line"><span class="comment">---------------------|---------------------</span></span><br><span class="line"><span class="comment">beforeCreate         | setup()</span></span><br><span class="line"><span class="comment">created              | setup()</span></span><br><span class="line"><span class="comment">beforeMount          | onBeforeMount</span></span><br><span class="line"><span class="comment">mounted              | onMounted</span></span><br><span class="line"><span class="comment">beforeUpdate         | onBeforeUpdate</span></span><br><span class="line"><span class="comment">updated              | onUpdated</span></span><br><span class="line"><span class="comment">beforeUnmount        | onBeforeUnmount</span></span><br><span class="line"><span class="comment">unmounted            | onUnmounted</span></span><br><span class="line"><span class="comment">errorCaptured        | onErrorCaptured</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="四、组件通信"><a href="#四、组件通信" class="headerlink" title="四、组件通信"></a>四、组件通信</h2><h3 id="Props-和-Emits"><a href="#Props-和-Emits" class="headerlink" title="Props 和 Emits"></a>Props 和 Emits</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 Parent.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import Child from &#x27;./Child.vue&#x27;;</span><br><span class="line"></span><br><span class="line">const count = ref(0);</span><br><span class="line">const message = ref(&#x27;Hello from parent&#x27;);</span><br><span class="line"></span><br><span class="line">function receiveFromChild(data) &#123;</span><br><span class="line">  console.log(&#x27;来自子组件:&#x27;, data);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child</span><br><span class="line">    :count=&quot;count&quot;</span><br><span class="line">    :message=&quot;message&quot;</span><br><span class="line">    @update=&quot;receiveFromChild&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件 Child.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">// 定义 props</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  count: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;,</span><br><span class="line">  message: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;Default message&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 定义 emits</span><br><span class="line">const emit = defineEmits([&#x27;update&#x27;]);</span><br><span class="line"></span><br><span class="line">function sendToParent() &#123;</span><br><span class="line">  emit(&#x27;update&#x27;, &#123; data: &#x27;Hello from child&#x27; &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; props.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Message: &#123;&#123; props.message &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;sendToParent&quot;&gt;发送给父组件&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h3 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide&#x2F;inject"></a>provide&#x2F;inject</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 祖先组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide, ref, readonly &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = <span class="title function_">ref</span>(<span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">provide</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="title function_">readonly</span>(theme)); <span class="comment">// 提供只读主题</span></span><br><span class="line"><span class="title function_">provide</span>(<span class="string">&#x27;updateTheme&#x27;</span>, <span class="function">(<span class="params">newTheme</span>) =&gt;</span> &#123;</span><br><span class="line">  theme.<span class="property">value</span> = newTheme;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后代组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = <span class="title function_">inject</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>); <span class="comment">// 默认值 &#x27;light&#x27;</span></span><br><span class="line"><span class="keyword">const</span> updateTheme = <span class="title function_">inject</span>(<span class="string">&#x27;updateTheme&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 TypeScript</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义注入键</span></span><br><span class="line">interface <span class="title class_">Theme</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">themeKey</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">Theme</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&#x27;theme&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提供</span></span><br><span class="line"><span class="title function_">provide</span>(themeKey, theme);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入</span></span><br><span class="line"><span class="keyword">const</span> theme = <span class="title function_">inject</span>(themeKey);</span><br></pre></td></tr></table></figure>

<h3 id="expose-和-ref"><a href="#expose-和-ref" class="headerlink" title="expose 和 ref"></a>expose 和 ref</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 子组件 Child.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const count = ref(0);</span><br><span class="line"></span><br><span class="line">function increment() &#123;</span><br><span class="line">  count.value++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 暴露给父组件</span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  count,</span><br><span class="line">  increment</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 父组件 Parent.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import Child from &#x27;./Child.vue&#x27;;</span><br><span class="line"></span><br><span class="line">const childRef = ref(null);</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  console.log(childRef.value.count);  // 访问子组件数据</span><br><span class="line">  childRef.value.increment();         // 调用子组件方法</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child ref=&quot;childRef&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import Child from &#x27;./Child.vue&#x27;;</span><br><span class="line"></span><br><span class="line">const message = ref(&#x27;Hello&#x27;);</span><br><span class="line"></span><br><span class="line">// 等同于：</span><br><span class="line">// &lt;Child :modelValue=&quot;message&quot; @update:modelValue=&quot;message = $event&quot; /&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child v-model=&quot;message&quot; /&gt;</span><br><span class="line">  &lt;p&gt;Message: &#123;&#123; message &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件 --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps([&#x27;modelValue&#x27;]);</span><br><span class="line">const emit = defineEmits([&#x27;update:modelValue&#x27;]);</span><br><span class="line"></span><br><span class="line">function update(e) &#123;</span><br><span class="line">  emit(&#x27;update:modelValue&#x27;, e.target.value);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input :value=&quot;props.modelValue&quot; @input=&quot;update&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 多个 v-model --&gt;</span><br><span class="line">&lt;UserName</span><br><span class="line">  v-model:first-name=&quot;first&quot;</span><br><span class="line">  v-model:last-name=&quot;last&quot;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps([&#x27;firstName&#x27;, &#x27;lastName&#x27;]);</span><br><span class="line">const emit = defineEmits([&#x27;update:firstName&#x27;, &#x27;update:lastName&#x27;]);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="五、Composition-API-高级用法"><a href="#五、Composition-API-高级用法" class="headerlink" title="五、Composition API 高级用法"></a>五、Composition API 高级用法</h2><h3 id="自定义组合式函数（Composables）"><a href="#自定义组合式函数（Composables）" class="headerlink" title="自定义组合式函数（Composables）"></a>自定义组合式函数（Composables）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// useMouse.js - 鼠标位置追踪</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useMouse</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> y = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    x.<span class="property">value</span> = event.<span class="property">pageX</span>;</span><br><span class="line">    y.<span class="property">value</span> = event.<span class="property">pageY</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, update);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, update);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; x, y &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useMouse &#125; <span class="keyword">from</span> <span class="string">&#x27;./useMouse&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; x, y &#125; = <span class="title function_">useMouse</span>();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Mouse position: &#123;&#123; x &#125;&#125;, &#123;&#123; y &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// useLocalStorage.js - 本地存储</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useLocalStorage</span>(<span class="params">key, defaultValue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> storedValue = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">ref</span>(storedValue ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(storedValue) : defaultValue);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(value, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newValue));</span><br><span class="line">  &#125;, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">useLocalStorage</span>(<span class="string">&#x27;count&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// useFetch.js - 数据获取</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFetch</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> error = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    error.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">      data.<span class="property">value</span> = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      error.<span class="property">value</span> = err;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      loading.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; data, error, loading, <span class="attr">refresh</span>: fetchData &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> &#123; data, error, loading, refresh &#125; = <span class="title function_">useFetch</span>(<span class="string">&#x27;/api/user&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="响应式工具函数"><a href="#响应式工具函数" class="headerlink" title="响应式工具函数"></a>响应式工具函数</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 防抖</span></span><br><span class="line"><span class="keyword">import</span> &#123; watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">fn, delay = <span class="number">300</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeoutId = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeoutId);</span><br><span class="line">    timeoutId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应式防抖</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">watchDebounce</span>(<span class="params">source, cb, delay = <span class="number">300</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeoutId = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">watch</span>(</span><br><span class="line">    source,</span><br><span class="line">    <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timeoutId);</span><br><span class="line">      timeoutId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">cb</span>(...args);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 节流</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useThrottle</span>(<span class="params">fn, delay = <span class="number">300</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> lastCall = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">if</span> (now - lastCall &gt;= delay) &#123;</span><br><span class="line">      lastCall = now;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. useArray - 数组操作</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useArray</span>(<span class="params">initial = []</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> array = <span class="title function_">ref</span>(initial);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">push</span> = (<span class="params">item</span>) =&gt; array.<span class="property">value</span>.<span class="title function_">push</span>(item);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">pop</span> = (<span class="params"></span>) =&gt; array.<span class="property">value</span>.<span class="title function_">pop</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">shift</span> = (<span class="params"></span>) =&gt; array.<span class="property">value</span>.<span class="title function_">shift</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">unshift</span> = (<span class="params">item</span>) =&gt; array.<span class="property">value</span>.<span class="title function_">unshift</span>(item);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">remove</span> = (<span class="params">index</span>) =&gt; array.<span class="property">value</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    array,</span><br><span class="line">    push,</span><br><span class="line">    pop,</span><br><span class="line">    shift,</span><br><span class="line">    unshift,</span><br><span class="line">    remove</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. useCounter - 计数器</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useCounter</span>(<span class="params">initial = <span class="number">0</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(initial);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>--;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span> = initial;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setValue</span> = (<span class="params">value</span>) =&gt; count.<span class="property">value</span> = value;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    count,</span><br><span class="line">    increment,</span><br><span class="line">    decrement,</span><br><span class="line">    reset,</span><br><span class="line">    setValue</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、响应式原理深度解析"><a href="#六、响应式原理深度解析" class="headerlink" title="六、响应式原理深度解析"></a>六、响应式原理深度解析</h2><h3 id="Proxy-vs-Object-defineProperty"><a href="#Proxy-vs-Object-defineProperty" class="headerlink" title="Proxy vs Object.defineProperty"></a>Proxy vs Object.defineProperty</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue2 - Object.defineProperty</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dep = []; <span class="comment">// 依赖收集</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      dep.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>()); <span class="comment">// 收集依赖</span></span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (newVal !== val) &#123;</span><br><span class="line">        val = newVal;</span><br><span class="line">        dep.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>()); <span class="comment">// 触发更新</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ⚠️ Vue2 的限制</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="title function_">defineReactive</span>(obj, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;Bob&#x27;</span>; <span class="comment">// ✅ 可以检测到</span></span><br><span class="line">obj.<span class="property">age</span> = <span class="number">25</span>;     <span class="comment">// ❌ 无法检测新增属性</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">name</span>;  <span class="comment">// ❌ 无法检测删除</span></span><br><span class="line">obj.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="number">1</span>);  <span class="comment">// ❌ 无法检测数组索引变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue3 - Proxy</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> handlers = &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">      <span class="comment">// 依赖收集</span></span><br><span class="line">      <span class="title function_">track</span>(target, key);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver);</span><br><span class="line">      <span class="keyword">if</span> (oldValue !== value) &#123;</span><br><span class="line">        <span class="comment">// 触发更新</span></span><br><span class="line">        <span class="title function_">trigger</span>(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, handlers);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ Vue3 可以检测所有操作</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;);</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;Bob&#x27;</span>;  <span class="comment">// ✅ 可以检测</span></span><br><span class="line">obj.<span class="property">age</span> = <span class="number">25</span>;      <span class="comment">// ✅ 可以检测</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">name</span>;   <span class="comment">// ✅ 可以检测</span></span><br></pre></td></tr></table></figure>

<h3 id="简化的响应式系统实现"><a href="#简化的响应式系统实现" class="headerlink" title="简化的响应式系统实现"></a>简化的响应式系统实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 依赖收集</span></span><br><span class="line"><span class="keyword">let</span> activeEffect = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    targetMap.<span class="title function_">set</span>(target, depsMap);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dep = depsMap.<span class="title function_">get</span>(key);</span><br><span class="line">  <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    dep = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">    depsMap.<span class="title function_">set</span>(key, dep);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dep.<span class="title function_">add</span>(activeEffect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.<span class="title function_">get</span>(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dep = depsMap.<span class="title function_">get</span>(key);</span><br><span class="line">  <span class="keyword">if</span> (dep) &#123;</span><br><span class="line">    dep.<span class="title function_">forEach</span>(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">effect</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应式对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">      <span class="title function_">track</span>(target, key);</span><br><span class="line">      <span class="comment">// 嵌套对象递归代理</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reactive</span>(result);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver);</span><br><span class="line">      <span class="keyword">if</span> (oldValue !== value) &#123;</span><br><span class="line">        <span class="title function_">trigger</span>(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ref 实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_value</span> = newValue;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">_value</span>: value</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// effect 实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  activeEffect = fn;</span><br><span class="line">  <span class="title function_">fn</span>();</span><br><span class="line">  activeEffect = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Count is:&#x27;</span>, state.<span class="property">count</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">state.<span class="property">count</span>++; <span class="comment">// 自动触发 effect</span></span><br></pre></td></tr></table></figure>

<h3 id="computed-实现"><a href="#computed-实现" class="headerlink" title="computed 实现"></a>computed 实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">computed</span>(<span class="params">getter</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _value;</span><br><span class="line">  <span class="keyword">let</span> _dirty = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    _value = <span class="title function_">getter</span>();</span><br><span class="line">    _dirty = <span class="literal">false</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (_dirty) &#123;</span><br><span class="line">        <span class="title function_">effectFn</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> _value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(doubleCount.<span class="property">value</span>); <span class="comment">// 0</span></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(doubleCount.<span class="property">value</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h2 id="七、性能优化"><a href="#七、性能优化" class="headerlink" title="七、性能优化"></a>七、性能优化</h2><h3 id="虚拟DOM和Diff算法"><a href="#虚拟DOM和Diff算法" class="headerlink" title="虚拟DOM和Diff算法"></a>虚拟DOM和Diff算法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue3 使用最长递增子序列算法优化 diff</span></span><br><span class="line"><span class="comment">// 时间复杂度从 O(n³) 降低到 O(n)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchKeyedChildren</span>(<span class="params">c1, c2, container</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> e1 = c1.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> e2 = c2.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 从前往后同步</span></span><br><span class="line">  <span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) &#123;</span><br><span class="line">    <span class="keyword">const</span> n1 = c1[i];</span><br><span class="line">    <span class="keyword">const</span> n2 = c2[i];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isSameVNodeType</span>(n1, n2)) &#123;</span><br><span class="line">      <span class="title function_">patch</span>(n1, n2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 从后往前同步</span></span><br><span class="line">  <span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) &#123;</span><br><span class="line">    <span class="keyword">const</span> n1 = c1[e1];</span><br><span class="line">    <span class="keyword">const</span> n2 = c2[e2];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isSameVNodeType</span>(n1, n2)) &#123;</span><br><span class="line">      <span class="title function_">patch</span>(n1, n2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    e1--;</span><br><span class="line">    e2--;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 处理新增节点</span></span><br><span class="line">  <span class="keyword">if</span> (i &gt; e1) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt;= e2) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextPos = e2 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> anchor = nextPos &lt; c2.<span class="property">length</span> ? c2[nextPos] : <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">while</span> (i &lt;= e2) &#123;</span><br><span class="line">        <span class="title function_">patch</span>(<span class="literal">null</span>, c2[i], anchor);</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 处理删除节点</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (i &gt; e2) &#123;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= e1) &#123;</span><br><span class="line">      <span class="title function_">unmount</span>(c1[i]);</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. 处理未知序列（使用最长递增子序列）</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> s1 = i;</span><br><span class="line">    <span class="keyword">const</span> s2 = i;</span><br><span class="line">    <span class="keyword">const</span> keyToNewIndexMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = s2; i &lt;= e2; i++) &#123;</span><br><span class="line">      keyToNewIndexMap.<span class="title function_">set</span>(c2[i].<span class="property">key</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> j;</span><br><span class="line">    <span class="keyword">let</span> patched = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> toBePatched = e2 - s2 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> newIndexToOldIndexMap = <span class="keyword">new</span> <span class="title class_">Array</span>(toBePatched).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = s1; i &lt;= e1; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (patched &gt;= toBePatched) &#123;</span><br><span class="line">        <span class="title function_">unmount</span>(c1[i]);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> newIndex;</span><br><span class="line">      <span class="keyword">if</span> (c1[i].<span class="property">key</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        newIndex = keyToNewIndexMap.<span class="title function_">get</span>(c1[i].<span class="property">key</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = s2; j &lt;= e2; j++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isSameVNodeType</span>(c1[i], c2[j])) &#123;</span><br><span class="line">            newIndex = j;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (newIndex === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">unmount</span>(c1[i]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newIndexToOldIndexMap[newIndex - s2] = i + <span class="number">1</span>;</span><br><span class="line">        <span class="title function_">patch</span>(c1[i], c2[newIndex]);</span><br><span class="line">        patched++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> increasingNewIndexSequence = <span class="title function_">getSequence</span>(newIndexToOldIndexMap);</span><br><span class="line">    j = increasingNewIndexSequence.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = toBePatched - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextIndex = s2 + i;</span><br><span class="line">      <span class="keyword">const</span> nextChild = c2[nextIndex];</span><br><span class="line">      <span class="keyword">const</span> anchor = nextIndex + <span class="number">1</span> &lt; c2.<span class="property">length</span> ? c2[nextIndex + <span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (newIndexToOldIndexMap[i] === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">patch</span>(<span class="literal">null</span>, nextChild, anchor);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (j &lt; <span class="number">0</span> || i !== increasingNewIndexSequence[j]) &#123;</span><br><span class="line">          <span class="title function_">move</span>(nextChild, anchor);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          j--;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组件优化技巧"><a href="#组件优化技巧" class="headerlink" title="组件优化技巧"></a>组件优化技巧</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 1. 使用 v-once 只渲染一次 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div v-once&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; title &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; staticContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; dynamicContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 2. 使用 v-memo 跳过不必要的更新 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div v-for=&quot;item in list&quot; :key=&quot;item.id&quot; v-memo=&quot;[item.id, item.selected]&quot;&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; item.name &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;span v-if=&quot;item.selected&quot;&gt;Selected&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 3. 异步组件 --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; defineAsyncComponent &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const AsyncComponent = defineAsyncComponent(() =&gt;</span><br><span class="line">  import(&#x27;./HeavyComponent.vue&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 带配置的异步组件</span><br><span class="line">const AsyncComponentWithOptions = defineAsyncComponent(&#123;</span><br><span class="line">  loader: () =&gt; import(&#x27;./HeavyComponent.vue&#x27;),</span><br><span class="line">  loadingComponent: LoadingSpinner,</span><br><span class="line">  errorComponent: ErrorComponent,</span><br><span class="line">  delay: 200,</span><br><span class="line">  timeout: 3000</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 4. keep-alive 缓存组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;keep-alive :include=&quot;[&#x27;Home&#x27;, &#x27;About&#x27;]&quot; :max=&quot;10&quot;&gt;</span><br><span class="line">    &lt;component :is=&quot;currentComponent&quot; /&gt;</span><br><span class="line">  &lt;/keep-alive&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="八、TypeScript-支持"><a href="#八、TypeScript-支持" class="headerlink" title="八、TypeScript 支持"></a>八、TypeScript 支持</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为 props 定义类型</span></span><br><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">User</span>;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带默认值</span></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">user</span>?: <span class="title class_">User</span>;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;(), &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为 emits 定义类型</span></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;update&#x27;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;delete&#x27;</span>, <span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ref 添加类型</span></span><br><span class="line"><span class="keyword">const</span> count = ref&lt;<span class="built_in">number</span>&gt;(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> user = ref&lt;<span class="title class_">User</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive 添加类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">User</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> state = reactive&lt;<span class="title class_">State</span>&gt;(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="literal">null</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// computed 添加类型</span></span><br><span class="line"><span class="keyword">const</span> doubleCount = computed&lt;<span class="built_in">number</span>&gt;(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合式函数添加类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useMouse</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> y = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="title class_">Readonly</span>&lt;<span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;&gt;,</span><br><span class="line">    <span class="attr">y</span>: <span class="title class_">Readonly</span>&lt;<span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;&gt;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="Vue3-核心优势"><a href="#Vue3-核心优势" class="headerlink" title="Vue3 核心优势"></a>Vue3 核心优势</h3><ul>
<li>✅ Composition API 提供更好的逻辑复用</li>
<li>✅ Proxy 响应式系统更强大</li>
<li>✅ 更好的 TypeScript 支持</li>
<li>✅ 性能提升（更小的包，更快的渲染）</li>
<li>✅ Tree-shaking 友好</li>
</ul>
<h3 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h3><ol>
<li>掌握 setup 和基础 API</li>
<li>理解响应式原理</li>
<li>学习组合式函数</li>
<li>实战项目巩固</li>
<li>性能优化</li>
</ol>
<h3 id="推荐资源"><a href="#推荐资源" class="headerlink" title="推荐资源"></a>推荐资源</h3><ul>
<li><a href="https://cn.vuejs.org/">Vue3 官方文档</a></li>
<li><a href="https://github.com/vuejs/core">Vue3 源码解析</a></li>
</ul>
<p>Vue3 的 Composition API 让代码更易维护和测试，是现代 Vue 开发的首选方式！</p>
<hr>
<p><em>下一篇将深入前端工程化和构建优化，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>Vue3</tag>
        <tag>Composition API</tag>
        <tag>响应式</tag>
      </tags>
  </entry>
  <entry>
    <title>机器学习实战：从线性回归到神经网络</title>
    <url>/2026/01/20/machine-learning-basics/</url>
    <content><![CDATA[<h2 id="机器学习概述"><a href="#机器学习概述" class="headerlink" title="机器学习概述"></a>机器学习概述</h2><p>机器学习（Machine Learning, ML）是人工智能的核心技术之一，它使计算机能够从数据中学习，而不是通过显式编程。</p>
<h3 id="机器学习的三种主要类型"><a href="#机器学习的三种主要类型" class="headerlink" title="机器学习的三种主要类型"></a>机器学习的三种主要类型</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────┐</span><br><span class="line">│              机器学习分类图                       │</span><br><span class="line">├─────────────────────────────────────────────────┤</span><br><span class="line">│  监督学习          无监督学习        强化学习    │</span><br><span class="line">│  (有标签数据)      (无标签数据)      (奖励机制)  │</span><br><span class="line">│     ↓                ↓                ↓         │</span><br><span class="line">│  分类/回归         聚类/降维       游戏AI       │</span><br><span class="line">│  图像识别         异常检测         机器人控制   │</span><br><span class="line">│  语音识别         关联规则         推荐系统     │</span><br><span class="line">└─────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>首先，让我们安装必要的Python库：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install numpy pandas scikit-learn matplotlib jupyter</span><br></pre></td></tr></table></figure>

<h2 id="1-线性回归-最简单的机器学习算法"><a href="#1-线性回归-最简单的机器学习算法" class="headerlink" title="1. 线性回归 - 最简单的机器学习算法"></a>1. 线性回归 - 最简单的机器学习算法</h2><p>线性回归用于预测连续值。让我们用一个简单的房价预测例子：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error, r2_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成示例数据</span></span><br><span class="line">np.random.seed(<span class="number">42</span>)</span><br><span class="line">n_samples = <span class="number">100</span></span><br><span class="line">X = np.random.randn(n_samples, <span class="number">1</span>) * <span class="number">10</span> + <span class="number">50</span>  <span class="comment"># 房屋面积 (50-150平米)</span></span><br><span class="line">y = <span class="number">2</span> * X.flatten() + <span class="number">10</span> + np.random.randn(n_samples) * <span class="number">20</span>  <span class="comment"># 房价</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分训练集和测试集</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并训练模型</span></span><br><span class="line">model = LinearRegression()</span><br><span class="line">model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">y_pred = model.predict(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 评估</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;系数: <span class="subst">&#123;model.coef_[<span class="number">0</span>]:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;截距: <span class="subst">&#123;model.intercept_:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;R²分数: <span class="subst">&#123;r2_score(y_test, y_pred):<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;均方误差: <span class="subst">&#123;mean_squared_error(y_test, y_pred):<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化</span></span><br><span class="line">plt.scatter(X_test, y_test, color=<span class="string">&#x27;blue&#x27;</span>, alpha=<span class="number">0.5</span>, label=<span class="string">&#x27;实际值&#x27;</span>)</span><br><span class="line">plt.plot(X_test, y_pred, color=<span class="string">&#x27;red&#x27;</span>, linewidth=<span class="number">2</span>, label=<span class="string">&#x27;预测线&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;房屋面积 (㎡)&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;房价 (万元)&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;线性回归：房屋面积 vs 房价&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><strong>输出示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">系数: 2.01</span><br><span class="line">截距: 9.87</span><br><span class="line">R²分数: 0.91</span><br><span class="line">均方误差: 376.42</span><br></pre></td></tr></table></figure>

<h2 id="2-逻辑回归-二分类问题"><a href="#2-逻辑回归-二分类问题" class="headerlink" title="2. 逻辑回归 - 二分类问题"></a>2. 逻辑回归 - 二分类问题</h2><p>逻辑回归用于分类任务，例如判断邮件是否为垃圾邮件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report, confusion_matrix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成二分类数据</span></span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_classification</span><br><span class="line">X, y = make_classification(</span><br><span class="line">    n_samples=<span class="number">1000</span>,</span><br><span class="line">    n_features=<span class="number">20</span>,</span><br><span class="line">    n_informative=<span class="number">15</span>,</span><br><span class="line">    n_redundant=<span class="number">5</span>,</span><br><span class="line">    random_state=<span class="number">42</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">lr_model = LogisticRegression(max_iter=<span class="number">1000</span>)</span><br><span class="line">lr_model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">y_pred = lr_model.predict(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 评估</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;分类报告:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(classification_report(y_test, y_pred))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n混淆矩阵:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(confusion_matrix(y_test, y_pred))</span><br></pre></td></tr></table></figure>

<h2 id="3-决策树-可解释性强的分类器"><a href="#3-决策树-可解释性强的分类器" class="headerlink" title="3. 决策树 - 可解释性强的分类器"></a>3. 决策树 - 可解释性强的分类器</h2><p>决策树易于理解和解释，适合可视化展示：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier, plot_tree</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用经典鸢尾花数据集</span></span><br><span class="line">iris = load_iris()</span><br><span class="line">X, y = iris.data, iris.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练决策树</span></span><br><span class="line">tree_model = DecisionTreeClassifier(max_depth=<span class="number">3</span>, random_state=<span class="number">42</span>)</span><br><span class="line">tree_model.fit(X, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化决策树</span></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>, <span class="number">8</span>))</span><br><span class="line">plot_tree(tree_model,</span><br><span class="line">          feature_names=iris.feature_names,</span><br><span class="line">          class_names=iris.target_names,</span><br><span class="line">          filled=<span class="literal">True</span>,</span><br><span class="line">          rounded=<span class="literal">True</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;决策树：鸢尾花分类&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="4-随机森林-集成学习的威力"><a href="#4-随机森林-集成学习的威力" class="headerlink" title="4. 随机森林 - 集成学习的威力"></a>4. 随机森林 - 集成学习的威力</h2><p>随机森林结合多个决策树，提供更好的泛化能力：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line">rf_model = RandomForestClassifier(</span><br><span class="line">    n_estimators=<span class="number">100</span>,</span><br><span class="line">    max_depth=<span class="number">5</span>,</span><br><span class="line">    random_state=<span class="number">42</span></span><br><span class="line">)</span><br><span class="line">rf_model.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征重要性</span></span><br><span class="line">feature_importance = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;Feature&#x27;</span>: iris.feature_names,</span><br><span class="line">    <span class="string">&#x27;Importance&#x27;</span>: rf_model.feature_importances_</span><br><span class="line">&#125;).sort_values(<span class="string">&#x27;Importance&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;特征重要性:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(feature_importance)</span><br></pre></td></tr></table></figure>

<h2 id="5-K-Means聚类-无监督学习"><a href="#5-K-Means聚类-无监督学习" class="headerlink" title="5. K-Means聚类 - 无监督学习"></a>5. K-Means聚类 - 无监督学习</h2><p>K-Means用于将数据分成K个组：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成聚类数据</span></span><br><span class="line">X_blob, y_blob = make_blobs(</span><br><span class="line">    n_samples=<span class="number">300</span>,</span><br><span class="line">    centers=<span class="number">4</span>,</span><br><span class="line">    cluster_std=<span class="number">0.60</span>,</span><br><span class="line">    random_state=<span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># K-Means聚类</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">4</span>, random_state=<span class="number">42</span>)</span><br><span class="line">y_kmeans = kmeans.fit_predict(X_blob)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化</span></span><br><span class="line">plt.scatter(X_blob[:, <span class="number">0</span>], X_blob[:, <span class="number">1</span>], c=y_kmeans, s=<span class="number">50</span>, cmap=<span class="string">&#x27;viridis&#x27;</span>)</span><br><span class="line">centers = kmeans.cluster_centers_</span><br><span class="line">plt.scatter(centers[:, <span class="number">0</span>], centers[:, <span class="number">1</span>],</span><br><span class="line">            c=<span class="string">&#x27;red&#x27;</span>, s=<span class="number">200</span>, alpha=<span class="number">0.5</span>, marker=<span class="string">&#x27;X&#x27;</span>, label=<span class="string">&#x27;聚类中心&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;K-Means聚类结果&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="6-神经网络入门-深度学习基础"><a href="#6-神经网络入门-深度学习基础" class="headerlink" title="6. 神经网络入门 - 深度学习基础"></a>6. 神经网络入门 - 深度学习基础</h2><p>使用多层神经网络处理复杂问题：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.neural_network <span class="keyword">import</span> MLPClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据标准化（对神经网络很重要）</span></span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">X_train_scaled = scaler.fit_transform(X_train)</span><br><span class="line">X_test_scaled = scaler.transform(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建神经网络</span></span><br><span class="line">mlp = MLPClassifier(</span><br><span class="line">    hidden_layer_sizes=(<span class="number">100</span>, <span class="number">50</span>),</span><br><span class="line">    activation=<span class="string">&#x27;relu&#x27;</span>,</span><br><span class="line">    solver=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">    max_iter=<span class="number">500</span>,</span><br><span class="line">    random_state=<span class="number">42</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练</span></span><br><span class="line">mlp.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 评估</span></span><br><span class="line">train_score = mlp.score(X_train_scaled, y_train)</span><br><span class="line">test_score = mlp.score(X_test_scaled, y_test)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;训练集准确率: <span class="subst">&#123;train_score:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;测试集准确率: <span class="subst">&#123;test_score:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制学习曲线</span></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">5</span>))</span><br><span class="line">plt.plot(mlp.loss_curve_, linewidth=<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;神经网络训练损失曲线&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;迭代次数&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;损失值&#x27;</span>)</span><br><span class="line">plt.grid(<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="模型评估指标"><a href="#模型评估指标" class="headerlink" title="模型评估指标"></a>模型评估指标</h2><table>
<thead>
<tr>
<th>任务类型</th>
<th>评估指标</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>回归</td>
<td>MSE, RMSE, MAE, R²</td>
<td>衡量预测值与实际值的差距</td>
</tr>
<tr>
<td>分类</td>
<td>准确率, 精确率, 召回率, F1</td>
<td>衡量分类效果</td>
</tr>
<tr>
<td>聚类</td>
<td>轮廓系数, Davies-Bouldin</td>
<td>衡量聚类质量</td>
</tr>
</tbody></table>
<h2 id="实战项目建议"><a href="#实战项目建议" class="headerlink" title="实战项目建议"></a>实战项目建议</h2><h3 id="初级项目"><a href="#初级项目" class="headerlink" title="初级项目"></a>初级项目</h3><ol>
<li><strong>房价预测</strong> - 使用波士顿房价数据集</li>
<li><strong>泰坦尼克号生存预测</strong> - 二分类问题</li>
<li><strong>手写数字识别</strong> - MNIST数据集</li>
</ol>
<h3 id="中级项目"><a href="#中级项目" class="headerlink" title="中级项目"></a>中级项目</h3><ol start="4">
<li><strong>客户细分</strong> - K-Means聚类</li>
<li><strong>情感分析</strong> - 自然语言处理</li>
<li><strong>股票价格预测</strong> - 时间序列分析</li>
</ol>
<h3 id="高级项目"><a href="#高级项目" class="headerlink" title="高级项目"></a>高级项目</h3><ol start="7">
<li><strong>图像分类</strong> - CNN卷积神经网络</li>
<li><strong>推荐系统</strong> - 协同过滤</li>
<li><strong>文本生成</strong> - RNN&#x2F;LSTM</li>
</ol>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="1-数据预处理"><a href="#1-数据预处理" class="headerlink" title="1. 数据预处理"></a>1. 数据预处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 处理缺失值</span></span><br><span class="line">df.fillna(df.mean(), inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征缩放</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">X_scaled = scaler.fit_transform(X)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编码分类变量</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">le = LabelEncoder()</span><br><span class="line">y_encoded = le.fit_transform(y)</span><br></pre></td></tr></table></figure>

<h3 id="2-交叉验证"><a href="#2-交叉验证" class="headerlink" title="2. 交叉验证"></a>2. 交叉验证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"></span><br><span class="line">scores = cross_val_score(model, X, y, cv=<span class="number">5</span>, scoring=<span class="string">&#x27;accuracy&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;交叉验证准确率: <span class="subst">&#123;scores.mean():<span class="number">.2</span>%&#125;</span> (+/- <span class="subst">&#123;scores.std() * <span class="number">2</span>:<span class="number">.2</span>%&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-超参数调优"><a href="#3-超参数调优" class="headerlink" title="3. 超参数调优"></a>3. 超参数调优</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">param_grid = &#123;</span><br><span class="line">    <span class="string">&#x27;n_estimators&#x27;</span>: [<span class="number">50</span>, <span class="number">100</span>, <span class="number">200</span>],</span><br><span class="line">    <span class="string">&#x27;max_depth&#x27;</span>: [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="literal">None</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">grid_search = GridSearchCV(</span><br><span class="line">    RandomForestClassifier(),</span><br><span class="line">    param_grid,</span><br><span class="line">    cv=<span class="number">5</span></span><br><span class="line">)</span><br><span class="line">grid_search.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最佳参数: <span class="subst">&#123;grid_search.best_params_&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>机器学习是一个广阔的领域，从简单的线性回归到复杂的深度神经网络，每种算法都有其适用场景。</p>
<p><strong>学习路径建议：</strong></p>
<ol>
<li>掌握基础算法（线性回归、逻辑回归）</li>
<li>理解模型评估和验证方法</li>
<li>学习集成学习方法（随机森林、GBDT）</li>
<li>进入深度学习领域</li>
<li>在实际项目中应用所学知识</li>
</ol>
<p>记住：<strong>实践是最好的老师！</strong> 选择感兴趣的数据集，动手实现你的第一个机器学习项目吧！</p>
<hr>
<p><em>下一篇将深入讲解深度学习和神经网络，敬请期待！</em></p>
]]></content>
      <categories>
        <category>后端</category>
        <category>AI</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>Python</tag>
        <tag>实战教程</tag>
        <tag>Scikit-learn</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks完全指南：深入理解现代React开发</title>
    <url>/2026/01/20/react-hooks-deep-dive/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>React Hooks 自 React 16.8 版本引入以来，彻底改变了我们编写 React 组件的方式。它让函数组件拥有了状态管理和副作用处理的能力，同时提供了更优雅的代码组织方式。</p>
<p>本文将深入探讨 React Hooks 的核心概念、使用技巧和最佳实践。</p>
<h2 id="为什么需要-Hooks？"><a href="#为什么需要-Hooks？" class="headerlink" title="为什么需要 Hooks？"></a>为什么需要 Hooks？</h2><h3 id="Hooks-解决的问题"><a href="#Hooks-解决的问题" class="headerlink" title="Hooks 解决的问题"></a>Hooks 解决的问题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 旧方式：类组件的痛点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserProfile</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: <span class="literal">null</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">fetchUser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevProps.<span class="property">userId</span> !== <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">userId</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">fetchUser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">loading</span>: <span class="literal">true</span>, <span class="attr">error</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;<span class="variable language_">this</span>.props.userId&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> user = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; user, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; error, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// JSX 渲染逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 新方式：使用 Hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchUser</span>();</span><br><span class="line">  &#125;, [userId]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setLoading</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_">setError</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="title function_">setUser</span>(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="title function_">setError</span>(err);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// JSX 渲染逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Hooks 的优势</strong>：</p>
<ul>
<li>✅ 代码更简洁，逻辑更清晰</li>
<li>✅ 相关逻辑组织在一起，而不是分散在不同生命周期方法中</li>
<li>✅ 复用状态逻辑更容易</li>
<li>✅ 没有 <code>this</code> 绑定问题</li>
</ul>
<h2 id="核心-Hooks-详解"><a href="#核心-Hooks-详解" class="headerlink" title="核心 Hooks 详解"></a>核心 Hooks 详解</h2><h3 id="1-useState-状态管理"><a href="#1-useState-状态管理" class="headerlink" title="1. useState - 状态管理"></a>1. useState - 状态管理</h3><h4 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 声明一个叫 count 的状态变量，初始值为 0</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了 &#123;count&#125; 次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        点击我</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="惰性初始化"><a href="#惰性初始化" class="headerlink" title="惰性初始化"></a>惰性初始化</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 如果初始状态需要复杂计算，使用函数避免重复计算</span></span><br><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> initialState = <span class="title function_">someExpensiveComputation</span>(props);</span><br><span class="line">  <span class="keyword">return</span> initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="函数式更新"><a href="#函数式更新" class="headerlink" title="函数式更新"></a>函数式更新</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当新状态依赖于旧状态时，使用函数式更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ✅ 正确：使用函数式更新</span></span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">prev</span> =&gt;</span> prev + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">prev</span> =&gt;</span> prev + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">prev</span> =&gt;</span> prev + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 结果：count + 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ❌ 错误：直接使用值</span></span><br><span class="line">    <span class="comment">// setCount(count + 1);</span></span><br><span class="line">    <span class="comment">// setCount(count + 1);</span></span><br><span class="line">    <span class="comment">// setCount(count + 1);</span></span><br><span class="line">    <span class="comment">// 结果：只增加 1，因为 count 没有更新</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="对象和数组状态"><a href="#对象和数组状态" class="headerlink" title="对象和数组状态"></a>对象和数组状态</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">UserForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">0</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">updateField</span> = (<span class="params">field, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ✅ 正确：创建新对象</span></span><br><span class="line">    <span class="title function_">setUser</span>(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123;</span><br><span class="line">      ...prev,</span><br><span class="line">      [field]: value</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">updateName</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setUser</span>(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123; ...prev, name &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;user.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> updateField(&#x27;name&#x27;, e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;user.email&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> updateField(&#x27;email&#x27;, e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-useEffect-副作用处理"><a href="#2-useEffect-副作用处理" class="headerlink" title="2. useEffect - 副作用处理"></a>2. useEffect - 副作用处理</h3><h4 id="基础用法-1"><a href="#基础用法-1" class="headerlink" title="基础用法"></a>基础用法</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 类似于 componentDidMount 和 componentDidUpdate</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 副作用：获取用户数据</span></span><br><span class="line">    <span class="title function_">fetchUser</span>(userId).<span class="title function_">then</span>(setUser);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可选的清理函数：类似于 componentWillUnmount</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件卸载或重新渲染前&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [userId]); <span class="comment">// 依赖数组：只有 userId 改变时才重新执行</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> user ? <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useEffect-的执行时机"><a href="#useEffect-的执行时机" class="headerlink" title="useEffect 的执行时机"></a>useEffect 的执行时机</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">EffectDemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 每次渲染后都执行（不推荐）</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;每次渲染后执行&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 只在挂载时执行一次</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;只在挂载时执行&#x27;</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 当 count 改变时执行</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count 改变:&#x27;</span>, count);</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 带清理函数</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;定时器执行&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer); <span class="comment">// 清理</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;&#123;count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="常见使用场景"><a href="#常见使用场景" class="headerlink" title="常见使用场景"></a>常见使用场景</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 场景1：数据获取</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DataFetcher</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cancelled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setData</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      cancelled = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [userId]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景2：订阅事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">WindowSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleResize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setSize</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      窗口大小: &#123;size.width&#125; x &#123;size.height&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景3：手动修改 DOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FocusInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-useContext-跨组件状态共享"><a href="#3-useContext-跨组件状态共享" class="headerlink" title="3. useContext - 跨组件状态共享"></a>3. useContext - 跨组件状态共享</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext, useContext, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 Context</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建 Provider 组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ThemeProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">toggleTheme</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setTheme</span>(<span class="function"><span class="params">prev</span> =&gt;</span> prev === <span class="string">&#x27;light&#x27;</span> ? <span class="string">&#x27;dark&#x27;</span> : <span class="string">&#x27;light&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">theme</span>, <span class="attr">toggleTheme</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建自定义 Hook</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useTheme</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">if</span> (!context) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;useTheme must be used within ThemeProvider&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 使用 Context</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Content</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; theme, toggleTheme &#125; = <span class="title function_">useTheme</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggleTheme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      当前主题: &#123;theme&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-useReducer-复杂状态管理"><a href="#4-useReducer-复杂状态管理" class="headerlink" title="4. useReducer - 复杂状态管理"></a>4. useReducer - 复杂状态管理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reducer 函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">counterReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;reset&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: action.<span class="property">payload</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Unknown action: <span class="subst">$&#123;action.type&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(counterReducer, &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>计数: &#123;state.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;increment&#x27; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        增加</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;decrement&#x27; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        减少</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;reset&#x27;, payload: 0 &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        重置</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂示例：Todo 应用</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">todos</span>: [],</span><br><span class="line">  <span class="attr">filter</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">todoReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">todos</span>: [</span><br><span class="line">          ...state.<span class="property">todos</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">            <span class="attr">text</span>: action.<span class="property">payload</span>,</span><br><span class="line">            <span class="attr">completed</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;toggle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">todos</span>: state.<span class="property">todos</span>.<span class="title function_">map</span>(<span class="function"><span class="params">todo</span> =&gt;</span></span><br><span class="line">          todo.<span class="property">id</span> === action.<span class="property">payload</span></span><br><span class="line">            ? &#123; ...todo, <span class="attr">completed</span>: !todo.<span class="property">completed</span> &#125;</span><br><span class="line">            : todo</span><br><span class="line">        )</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;delete&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">todos</span>: state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> !== action.<span class="property">payload</span>)</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;setFilter&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">filter</span>: action.<span class="property">payload</span></span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-useRef-访问-DOM-和保存可变值"><a href="#5-useRef-访问-DOM-和保存可变值" class="headerlink" title="5. useRef - 访问 DOM 和保存可变值"></a>5. useRef - 访问 DOM 和保存可变值</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法1：访问 DOM 元素</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TextInputWithFocusButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// `current` 指向已挂载到 DOM 上的文本输入元素</span></span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onButtonClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        聚焦输入框</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法2：保存可变值（不触发重新渲染）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> intervalRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    intervalRef.<span class="property">current</span> = id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(intervalRef.<span class="property">current</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">stopTimer</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(intervalRef.<span class="property">current</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>计数: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;stopTimer&#125;</span>&gt;</span>停止<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法3：获取上一次的值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">usePrevious</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ref.<span class="property">current</span> = value;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ref.<span class="property">current</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> prevCount = <span class="title function_">usePrevious</span>(count);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>上一次: &#123;prevCount&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-useMemo-性能优化"><a href="#6-useMemo-性能优化" class="headerlink" title="6. useMemo - 性能优化"></a>6. useMemo - 性能优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存昂贵的计算</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ExpensiveComponent</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ❌ 每次渲染都重新计算</span></span><br><span class="line">  <span class="comment">// const sorted = items.sort((a, b) =&gt; a - b);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 只在 items 改变时重新计算</span></span><br><span class="line">  <span class="keyword">const</span> sorted = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;排序计算&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> items.<span class="title function_">slice</span>().<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">  &#125;, [items]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;sorted.join(&#x27;, &#x27;)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存复杂对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetchUser</span>(userId);</span><br><span class="line">  &#125;, [userId]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免不必要的子组件渲染</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ParentComponent</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sorted = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> items.<span class="title function_">slice</span>().<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">id</span> - b.<span class="property">id</span>),</span><br><span class="line">    [items]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">items</span>=<span class="string">&#123;sorted&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-useCallback-函数缓存"><a href="#7-useCallback-函数缓存" class="headerlink" title="7. useCallback - 函数缓存"></a>7. useCallback - 函数缓存</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础用法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ❌ 每次渲染都创建新函数</span></span><br><span class="line">  <span class="comment">// const handleChange = (e) =&gt; setValue(e.target.value);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 只有依赖改变时才创建新函数</span></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setValue</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;, []); <span class="comment">// 空依赖数组，函数永远不会改变</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配合 useMemo 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ProductList</span>(<span class="params">&#123; products, addToCart &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 缓存计算结果</span></span><br><span class="line">  <span class="keyword">const</span> sortedProducts = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> products.<span class="title function_">slice</span>().<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">price</span> - b.<span class="property">price</span>);</span><br><span class="line">  &#125;, [products]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 缓存回调函数</span></span><br><span class="line">  <span class="keyword">const</span> handleAddToCart = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">product</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">addToCart</span>(product);</span><br><span class="line">  &#125;, [addToCart]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;sortedProducts.map(product =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Product</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">key</span>=<span class="string">&#123;product.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">product</span>=<span class="string">&#123;product&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onAddToCart</span>=<span class="string">&#123;handleAddToCart&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义-Hooks"><a href="#自定义-Hooks" class="headerlink" title="自定义 Hooks"></a>自定义 Hooks</h2><p>自定义 Hooks 是复用逻辑的强大方式。</p>
<h3 id="基础自定义-Hook"><a href="#基础自定义-Hook" class="headerlink" title="基础自定义 Hook"></a>基础自定义 Hook</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 封装数据获取逻辑</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useFetch</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cancelled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">setError</span>(<span class="literal">null</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setData</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setError</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      cancelled = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; data, loading, error &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: user, loading, error &#125; = <span class="title function_">useFetch</span>(</span><br><span class="line">    <span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>错误: &#123;error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 封装本地存储</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLocalStorage</span>(<span class="params">key, initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [storedValue, setStoredValue] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> item = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">      <span class="keyword">return</span> item ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item) : initialValue;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> initialValue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setValue = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> valueToStore =</span><br><span class="line">        value <span class="keyword">instanceof</span> <span class="title class_">Function</span> ? <span class="title function_">value</span>(storedValue) : value;</span><br><span class="line">      <span class="title function_">setStoredValue</span>(valueToStore);</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(valueToStore));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [key, storedValue]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [storedValue, setValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = <span class="title function_">useLocalStorage</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Guest&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setName(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 封装 debounce</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">value, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [debouncedValue, setDebouncedValue] = <span class="title function_">useState</span>(value);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setDebouncedValue</span>(value);</span><br><span class="line">    &#125;, delay);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(handler);</span><br><span class="line">  &#125;, [value, delay]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> debouncedValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用：搜索框防抖</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [searchTerm, setSearchTerm] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> debouncedSearchTerm = <span class="title function_">useDebounce</span>(searchTerm, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用防抖后的搜索词进行搜索</span></span><br><span class="line">    <span class="keyword">if</span> (debouncedSearchTerm) &#123;</span><br><span class="line">      <span class="title function_">performSearch</span>(debouncedSearchTerm);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [debouncedSearchTerm]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;searchTerm&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setSearchTerm(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      placeholder=&quot;搜索...&quot;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 封装窗口大小</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useWindowSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleResize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setSize</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 封装表单验证</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useForm</span>(<span class="params">initialValues, validate</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = <span class="title function_">useState</span>(initialValues);</span><br><span class="line">  <span class="keyword">const</span> [errors, setErrors] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [touched, setTouched] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, value &#125; = e.<span class="property">target</span>;</span><br><span class="line">    <span class="title function_">setValues</span>(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123; ...prev, [name]: value &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (touched[name]) &#123;</span><br><span class="line">      <span class="title function_">setErrors</span>(<span class="title function_">validate</span>(&#123; ...values, [name]: value &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleBlur</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name &#125; = e.<span class="property">target</span>;</span><br><span class="line">    <span class="title function_">setTouched</span>(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123; ...prev, [name]: <span class="literal">true</span> &#125;));</span><br><span class="line">    <span class="title function_">setErrors</span>(<span class="title function_">validate</span>(values));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setValues</span>(initialValues);</span><br><span class="line">    <span class="title function_">setErrors</span>(&#123;&#125;);</span><br><span class="line">    <span class="title function_">setTouched</span>(&#123;&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    values,</span><br><span class="line">    errors,</span><br><span class="line">    touched,</span><br><span class="line">    handleChange,</span><br><span class="line">    handleBlur,</span><br><span class="line">    reset,</span><br><span class="line">    <span class="attr">isValid</span>: <span class="title class_">Object</span>.<span class="title function_">keys</span>(errors).<span class="property">length</span> === <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; values, errors, handleChange, handleBlur, isValid &#125; = <span class="title function_">useForm</span>(</span><br><span class="line">    &#123; <span class="attr">email</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> errors = &#123;&#125;;</span><br><span class="line">      <span class="keyword">if</span> (!values.<span class="property">email</span>) errors.<span class="property">email</span> = <span class="string">&#x27;邮箱必填&#x27;</span>;</span><br><span class="line">      <span class="keyword">if</span> (!values.<span class="property">password</span>) errors.<span class="property">password</span> = <span class="string">&#x27;密码必填&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> errors;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSubmit</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">      <span class="comment">// 提交表单</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;values.email&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onBlur</span>=<span class="string">&#123;handleBlur&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;errors.email &amp;&amp; <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;errors.email&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;values.password&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onBlur</span>=<span class="string">&#123;handleBlur&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;errors.password &amp;&amp; <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;errors.password&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span>=<span class="string">&#123;!isValid&#125;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Hooks-最佳实践"><a href="#Hooks-最佳实践" class="headerlink" title="Hooks 最佳实践"></a>Hooks 最佳实践</h2><h3 id="1-遵循-Hooks-规则"><a href="#1-遵循-Hooks-规则" class="headerlink" title="1. 遵循 Hooks 规则"></a>1. 遵循 Hooks 规则</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ✅ 正确：只在顶层调用 Hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">GoodComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">useFetch</span>(<span class="string">&#x27;/api/user&#x27;</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 副作用</span></span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误：在条件语句中使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">BadComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>); <span class="comment">// ❌ 错误</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误：在循环中使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">BadComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">  items.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(item); <span class="comment">// ❌ 错误</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：提前返回</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">GoodComponent</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Early return<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// OK：所有 Hooks 都在 return 之前调用</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-合理使用依赖数组"><a href="#2-合理使用依赖数组" class="headerlink" title="2. 合理使用依赖数组"></a>2. 合理使用依赖数组</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ✅ 指定所有依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = props.<span class="property">source</span>.<span class="title function_">subscribe</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    subscription.<span class="title function_">unsubscribe</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [props.<span class="property">source</span>]); <span class="comment">// ✅ 正确</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 缺少依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = props.<span class="property">source</span>.<span class="title function_">subscribe</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    subscription.<span class="title function_">unsubscribe</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []); <span class="comment">// ❌ 警告：props.source 缺失</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 使用 ESLint 插件检查依赖</span></span><br><span class="line"><span class="comment">// npm install eslint-plugin-react-hooks --save-dev</span></span><br></pre></td></tr></table></figure>

<h3 id="3-避免过度的优化"><a href="#3-避免过度的优化" class="headerlink" title="3. 避免过度的优化"></a>3. 避免过度的优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 过度优化：简单计算不需要 useMemo</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SimpleComponent</span>(<span class="params">&#123; a, b &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sum = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> a + b, [a, b]); <span class="comment">// ❌ 不必要</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;sum&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 直接计算</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SimpleComponent</span>(<span class="params">&#123; a, b &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;a + b&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 合理使用：昂贵的计算</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ExpensiveComponent</span>(<span class="params">&#123; data &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">value</span> &gt; <span class="number">100</span>)</span><br><span class="line">               .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line">               .<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b, <span class="number">0</span>);</span><br><span class="line">  &#125;, [data]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;result&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-组织自定义-Hooks"><a href="#4-组织自定义-Hooks" class="headerlink" title="4. 组织自定义 Hooks"></a>4. 组织自定义 Hooks</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ✅ 单一职责：一个 Hook 只做一件事</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useFetch</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="comment">// 只负责数据获取</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLocalStorage</span>(<span class="params">key, initialValue</span>) &#123;</span><br><span class="line">  <span class="comment">// 只负责本地存储</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 职责混乱</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useFetchAndStore</span>(<span class="params">url, key</span>) &#123;</span><br><span class="line">  <span class="comment">// 既负责获取数据又负责存储</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 组合使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useFetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">  <span class="title function_">useLocalStorage</span>(<span class="string">`user_<span class="subst">$&#123;userId&#125;</span>`</span>, data);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常见陷阱和解决方案"><a href="#常见陷阱和解决方案" class="headerlink" title="常见陷阱和解决方案"></a>常见陷阱和解决方案</h2><h3 id="1-闭包陷阱"><a href="#1-闭包陷阱" class="headerlink" title="1. 闭包陷阱"></a>1. 闭包陷阱</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 问题：闭包捕获旧值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 总是打印 0</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, []); <span class="comment">// 空依赖数组</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;&#123;count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案1：使用函数式更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案2：使用 useRef</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> countRef = <span class="title function_">useRef</span>(count);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    countRef.<span class="property">current</span> = count;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(countRef.<span class="property">current</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;&#123;count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-无限循环"><a href="#2-无限循环" class="headerlink" title="2. 无限循环"></a>2. 无限循环</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 问题：无限循环</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/api/data&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>()).<span class="title function_">then</span>(setData);</span><br><span class="line">  &#125;); <span class="comment">// ❌ 缺少依赖数组，每次渲染都执行</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案：添加依赖数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/api/data&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>()).<span class="title function_">then</span>(setData);</span><br><span class="line">  &#125;, []); <span class="comment">// ✅ 只在挂载时执行</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 问题：对象作为依赖导致无限循环</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; user &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [token, setToken] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/api/token&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>()).<span class="title function_">then</span>(setToken);</span><br><span class="line">  &#125;, [user]); <span class="comment">// ❌ user 是对象，每次都是新引用</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;token&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案：只依赖具体属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; user &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [token, setToken] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/api/token&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>()).<span class="title function_">then</span>(setToken);</span><br><span class="line">  &#125;, [user.<span class="property">id</span>]); <span class="comment">// ✅ 只依赖 ID</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;token&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-条件渲染中的-Hooks"><a href="#3-条件渲染中的-Hooks" class="headerlink" title="3. 条件渲染中的 Hooks"></a>3. 条件渲染中的 Hooks</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：条件调用 Hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// ❌ 错误</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案1：提前计算</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案2：提取组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ConditionalHook</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> flag ? <span class="language-xml"><span class="tag">&lt;<span class="name">ConditionalHook</span> /&gt;</span></span> : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="性能优化技巧"><a href="#性能优化技巧" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h2><h3 id="1-使用-React-memo-避免不必要的渲染"><a href="#1-使用-React-memo-避免不必要的渲染" class="headerlink" title="1. 使用 React.memo 避免不必要的渲染"></a>1. 使用 React.memo 避免不必要的渲染</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">&#123; name &#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;渲染 MyComponent&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义比较函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">&#123; user &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">prevProps, nextProps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 返回 true 表示不需要重新渲染</span></span><br><span class="line">    <span class="keyword">return</span> prevProps.<span class="property">user</span>.<span class="property">id</span> === nextProps.<span class="property">user</span>.<span class="property">id</span>;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-虚拟化长列表"><a href="#2-虚拟化长列表" class="headerlink" title="2. 虚拟化长列表"></a>2. 虚拟化长列表</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 react-window</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FixedSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Row</span>(<span class="params">&#123; index, style &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      行 &#123;index&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">VirtualizedList</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">FixedSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemCount</span>=<span class="string">&#123;items.length&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemSize</span>=<span class="string">&#123;50&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">FixedSizeList</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-代码分割和懒加载"><a href="#3-代码分割和懒加载" class="headerlink" title="3. 代码分割和懒加载"></a>3. 代码分割和懒加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HeavyComponent</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./HeavyComponent&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">HeavyComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由级别的代码分割</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/About&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Spinner</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>React Hooks 是现代 React 开发的核心，掌握它能让你写出更简洁、更易维护的代码。</p>
<p><strong>核心要点</strong>：</p>
<ol>
<li>✅ 遵循 Hooks 规则（只在顶层调用）</li>
<li>✅ 合理使用依赖数组</li>
<li>✅ 提取自定义 Hooks 复用逻辑</li>
<li>✅ 使用 useMemo 和 useCallback 优化性能</li>
<li>✅ 避免常见的闭包和无限循环陷阱</li>
</ol>
<p><strong>学习路径</strong>：</p>
<ol>
<li>理解基础 Hooks（useState, useEffect）</li>
<li>掌握高级 Hooks（useContext, useReducer）</li>
<li>学习自定义 Hooks</li>
<li>性能优化技巧</li>
<li>实战项目应用</li>
</ol>
<p><strong>推荐资源</strong>：</p>
<ul>
<li><a href="https://react.dev/">React 官方文档</a></li>
<li><a href="https://react.dev/reference/react">Hooks FAQ</a></li>
<li><a href="https://usehooks.com/">useHooks.com</a></li>
<li><a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">Hooks 规则 ESLint 插件</a></li>
</ul>
<p>继续探索 Hooks 的强大功能，构建更优秀的 React 应用！</p>
<hr>
<p><em>下一篇将深入讲解 React 性能优化和并发模式，敬请期待！</em></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>JavaScript</tag>
        <tag>React</tag>
        <tag>Hooks</tag>
      </tags>
  </entry>
</search>
